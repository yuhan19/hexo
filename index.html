<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="呆呆窝">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="呆呆窝">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="呆呆窝">






  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>呆呆窝</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">呆呆窝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/09/Understanding-ES6-Learning-Note/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/09/Understanding-ES6-Learning-Note/" class="post-title-link" itemprop="url">Understanding ES6 Learning Note</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-09 16:58:04 / Modified: 18:37:31" itemprop="dateCreated datePublished" datetime="2019-10-09T16:58:04-06:00">2019-10-09</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Chapter1-Block-Bindings"><a href="#Chapter1-Block-Bindings" class="headerlink" title="Chapter1 Block Bindings"></a>Chapter1 Block Bindings</h1><h2 id="1-1-Var-Declarations-and-Hoisting"><a href="#1-1-Var-Declarations-and-Hoisting" class="headerlink" title="1.1 Var Declarations and Hoisting"></a>1.1 Var Declarations and Hoisting</h2><p>Hoisting for <code>var</code></p>
<ul>
<li>If in function: as if they are at the top of the function </li>
<li>If outside of function: at the top of global scope </li>
<li><strong>Not at the top of block</strong></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertValue</span>(<span class="params">condition</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">        <span class="keyword">var</span> value = <span class="string">"blue"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(value);   <span class="comment">// undefined instead of error</span></span><br><span class="line">    &#125;</span><br><span class="line">    alert(value)        <span class="comment">// undefined instead of error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-2-Block-Level-Declarations"><a href="#1-2-Block-Level-Declarations" class="headerlink" title="1.2 Block-Level Declarations"></a>1.2 Block-Level Declarations</h2><ul>
<li>Block scope is created by:<ul>
<li>Inside a function</li>
<li>Inside of a block (indicated by <code>{</code> and <code>}</code></li>
</ul>
</li>
<li>let (like other language)<ul>
<li>In same scope<ul>
<li>no redeclaration</li>
<li>can revalue</li>
</ul>
</li>
<li>In different scope<ul>
<li>cover</li>
</ul>
</li>
</ul>
</li>
<li><p>const</p>
<ul>
<li>similar as <code>let</code></li>
<li><p>except: cannot re-reference, while update object is fine</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123; <span class="attr">name</span>: <span class="string">"Nicholas"</span>&#125;;</span><br><span class="line">person.name = <span class="string">"Greg"</span>;               <span class="comment">// works</span></span><br><span class="line">person = &#123; <span class="attr">name</span>: <span class="string">"Nicholas"</span> &#125;;      <span class="comment">// error</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>The Temporal Dead Zone</p>
<ul>
<li>var: hoist</li>
<li><p>let/const (in same scope)</p>
<ol>
<li>Places the declaration in the TDZ</li>
<li>Any attempt to access a variable in the TDZ results in a runtime error</li>
<li>That variable is only removed from the TDZ, and therefore safe to use, once execution flows to the variable declaration</li>
<li><p>This even affect <code>typeof</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> value);      <span class="comment">// "undefined"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> value);  <span class="comment">// reference error</span></span><br><span class="line">    <span class="keyword">let</span> value = <span class="string">"blue"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="1-3-Block-Binding-in-Loops"><a href="#1-3-Block-Binding-in-Loops" class="headerlink" title="1.3 Block Binding in Loops"></a>1.3 Block Binding in Loops</h2><ul>
<li><p>declaration in loop</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(i);     <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(j)      <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>const</code> in <code>for-in</code> and <code>for-of</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;&#125;       <span class="comment">// error</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> obj) &#123;&#125;                 <span class="comment">// fine</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>function in loop</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funcs = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    funcs.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;);</span><br><span class="line">&#125;</span><br><span class="line">funcs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    func();     <span class="comment">// outputs the number "10" ten times</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funcs = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    funcs.push(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(i); &#125;);</span><br><span class="line">&#125;</span><br><span class="line">funcs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    func();     <span class="comment">// expect output</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="1-4-Global-Block-Bindings"><a href="#1-4-Global-Block-Bindings" class="headerlink" title="1.4 Global Block Bindings"></a>1.4 Global Block Bindings</h2><ul>
<li><code>var</code> overwrites window attribute</li>
<li><code>let</code>/<code>const</code> declare a new one in scope</li>
</ul>
<p>Question: in global, what’s the difference between </p>
<ul>
<li><code>var a = 123</code> and</li>
<li><code>b = 123</code></li>
</ul>
<h2 id="1-5-Emerging-Best-Practices-for-Block-Bindings"><a href="#1-5-Emerging-Best-Practices-for-Block-Bindings" class="headerlink" title="1.5 Emerging Best Practices for Block Bindings"></a>1.5 Emerging Best Practices for Block Bindings</h2><ul>
<li>default using <code>const</code> if we can</li>
<li>then use <code>let</code> if it might change</li>
</ul>
<h1 id="Chapter2-Strings-and-Regular-Expressions"><a href="#Chapter2-Strings-and-Regular-Expressions" class="headerlink" title="Chapter2 Strings and Regular Expressions"></a>Chapter2 Strings and Regular Expressions</h1><h2 id="2-1-Better-Unicode-Support"><a href="#2-1-Better-Unicode-Support" class="headerlink" title="2.1 Better Unicode Support"></a>2.1 Better Unicode Support</h2><p>Skip</p>
<h2 id="2-2-Other-String-Changes"><a href="#2-2-Other-String-Changes" class="headerlink" title="2.2 Other String Changes"></a>2.2 Other String Changes</h2><ul>
<li>Identifying Substrings<ul>
<li>includes()</li>
<li>startsWith()</li>
<li>endsWith()</li>
<li>repeat()</li>
</ul>
</li>
</ul>
<h2 id="2-3-Other-Regular-Expression-Changes"><a href="#2-3-Other-Regular-Expression-Changes" class="headerlink" title="2.3 Other Regular Expression Changes"></a>2.3 Other Regular Expression Changes</h2><ul>
<li>y Flag: sticky property<ul>
<li>it tells the search to start matching characters in a string at the position specified by the regular expression’s lastIndex property.</li>
<li>lastIndex: <code>pattern.lastIndex</code></li>
<li>sticky: <code>pattern.sticky</code></li>
</ul>
</li>
<li>Duplicating RE: <code>let re = new RegExp(re1, &quot;g&quot;);</code></li>
<li><p><code>flags</code> property</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> re = <span class="regexp">/ab/g</span>;</span><br><span class="line"><span class="built_in">console</span>.log(re.source);</span><br><span class="line"><span class="built_in">console</span>.log(re.flags);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-4-Template-Literals"><a href="#2-4-Template-Literals" class="headerlink" title="2.4 Template Literals"></a>2.4 Template Literals</h2><ul>
<li><p>Multiline strings</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Title&lt;/h1&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;`</span>.trim()</span><br></pre></td></tr></table></figure>
</li>
<li><p>Basic string formatting</p>
<ul>
<li><p>Substitution    </p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">10</span>,</span><br><span class="line">    price = <span class="number">0.25</span>,</span><br><span class="line">    message = <span class="string">`<span class="subst">$&#123;count&#125;</span> items cost $<span class="subst">$&#123;(count * price).toFixed(<span class="number">2</span>)&#125;</span>.`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Tagged Templates: advanced substitution</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">passthru</span>(<span class="params">literals, ...substitutions</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// run the loop only for the substitution count</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; substitutions.length; i++) &#123;</span><br><span class="line">        result += literals[i];</span><br><span class="line">        result += substitutions[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add the last literal</span></span><br><span class="line">    result += literals[literals.length - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">10</span>,</span><br><span class="line">    price = <span class="number">0.25</span>,</span><br><span class="line">    message = passthru<span class="string">`<span class="subst">$&#123;count&#125;</span> items cost $<span class="subst">$&#123;(count * price).toFixed(<span class="number">2</span>)&#125;</span>.`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);       <span class="comment">// "10 items cost $2.50."</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>HTML escaping</p>
<ul>
<li><p><code>String.raw</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> message1 = <span class="string">`Multiline\nstring`</span>,</span><br><span class="line">    message2 = <span class="built_in">String</span>.raw<span class="string">`Multiline\nstring`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message1);          <span class="comment">// "Multiline</span></span><br><span class="line">                                <span class="comment">//  string"</span></span><br><span class="line"><span class="built_in">console</span>.log(message2);          <span class="comment">// "Multiline\nstring"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="Chapter3-Functions"><a href="#Chapter3-Functions" class="headerlink" title="Chapter3 Functions"></a>Chapter3 Functions</h1><h2 id="3-1-Functions-with-Default-Parameter-Values"><a href="#3-1-Functions-with-Default-Parameter-Values" class="headerlink" title="3.1 Functions with Default Parameter Values"></a>3.1 Functions with Default Parameter Values</h2><ul>
<li>example: <code>function makeRequest(url, timeout = 2000, callback){}</code></li>
<li>The arguments object will not reflect changes to the named parameters.</li>
<li>Default Parameter Expressions<ul>
<li><code>function add(first, second = getValue()) { return first + second;}</code></li>
<li><code>function add(first, second = first)</code></li>
<li>Default Parameter Value Temporal Dead Zone<ol>
<li>When executing add(), first, second are added into TDZ</li>
<li>Initialize first then second one by one</li>
<li>if <code>add(first=second, second)</code> will raise exception</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="3-2-Working-with-Unnamed-Parameters"><a href="#3-2-Working-with-Unnamed-Parameters" class="headerlink" title="3.2 Working with Unnamed Parameters"></a>3.2 Working with Unnamed Parameters</h2><ul>
<li><code>function pick(object, ...keys){}</code></li>
</ul>
<h2 id="3-3-Increased-Capabilities-of-the-Function-Constructor"><a href="#3-3-Increased-Capabilities-of-the-Function-Constructor" class="headerlink" title="3.3 Increased Capabilities of the Function Constructor"></a>3.3 Increased Capabilities of the Function Constructor</h2><ul>
<li><code>let add = new Function(&#39;first&#39;, &#39;second&#39;, &#39;return first+second&#39;)</code></li>
</ul>
<h2 id="3-4-The-Spread-Operator"><a href="#3-4-The-Spread-Operator" class="headerlink" title="3.4 The Spread Operator"></a>3.4 The Spread Operator</h2><ul>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Math</span>.max(...values, <span class="number">0</span>));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-5-ECMAScript-6’s-name-Property"><a href="#3-5-ECMAScript-6’s-name-Property" class="headerlink" title="3.5 ECMAScript 6’s name Property"></a>3.5 ECMAScript 6’s name Property</h2><ul>
<li><p>function’s property</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(doSomething.name);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-6-Clarifying-the-Dual-Purpose-of-Functions"><a href="#3-6-Clarifying-the-Dual-Purpose-of-Functions" class="headerlink" title="3.6 Clarifying the Dual Purpose of Functions"></a>3.6 Clarifying the Dual Purpose of Functions</h2><ul>
<li><p>Two different function</p>
<ul>
<li>call function with <code>new</code><ul>
<li>[[Construct]] method is excuted with <code>this</code> set</li>
</ul>
</li>
<li><p>call function without <code>new</code></p>
<ul>
<li><p>[[Call]] method is executed</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>);</span><br><span class="line"><span class="keyword">var</span> notAPerson = Person(<span class="string">"Nicholas"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person);        <span class="comment">// "[Object object]"</span></span><br><span class="line"><span class="built_in">console</span>.log(notAPerson);    <span class="comment">// "undefined"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>The new.target MetaProperty: solve above issue</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">new</span>.target !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"use new"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-7-Block-Level-Functions"><a href="#3-7-Block-Level-Functions" class="headerlink" title="3.7 Block-Level Functions"></a>3.7 Block-Level Functions</h2><ul>
<li><p>Difference between strict mode or not</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> doSomething);        <span class="comment">// function</span></span><br><span class="line">    <span class="keyword">let</span> doSomething = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> doSomething);        <span class="comment">// throw error in strict mode</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> doSomething);        <span class="comment">// function in nonstrict mode</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-8-Arrow-Functions"><a href="#3-8-Arrow-Functions" class="headerlink" title="3.8 Arrow Functions"></a>3.8 Arrow Functions</h2><ul>
<li>No this, super, arguments, and new.target bindings</li>
<li>Cannot be called with new</li>
<li>No prototype </li>
<li>Can’t change this</li>
<li>No arguments object</li>
<li>No duplicate named parameters</li>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;(<span class="string">"Nicholas"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(person.getName());      <span class="comment">// "Nicholas"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-9-Tail-Call-Optimization"><a href="#3-9-Tail-Call-Optimization" class="headerlink" title="3.9 Tail Call Optimization"></a>3.9 Tail Call Optimization</h2><ul>
<li>With this optimization, instead of creating a new stack frame for a tail call, the current stack frame is cleared and reused</li>
<li>pre-conditions<ul>
<li>The tail call does not require access to variables in the current stack frame (meaning the function is not a closure)</li>
<li>The function making the tail call has no further work to do after the tail call returns</li>
<li>The result of the tail call is returned as the function value</li>
</ul>
</li>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// not optimized - must multiply after returning</span></span><br><span class="line">        <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n, p = <span class="number">1</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> * p;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> result = n * p;</span><br><span class="line">        <span class="comment">// optimized</span></span><br><span class="line">        <span class="keyword">return</span> factorial(n - <span class="number">1</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter4-Expanded-Object-Functionality"><a href="#Chapter4-Expanded-Object-Functionality" class="headerlink" title="Chapter4 Expanded Object Functionality"></a>Chapter4 Expanded Object Functionality</h1><h2 id="4-1-Object-Categories"><a href="#4-1-Object-Categories" class="headerlink" title="4.1 Object Categories"></a>4.1 Object Categories</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ordinary objects</td>
<td>Have all the default internal behaviors for objects in JavaScript.</td>
</tr>
<tr>
<td>Exotic objects</td>
<td>Have internal behavior that differs from the default in some way.</td>
</tr>
<tr>
<td>Standard objects</td>
<td>Are those defined by ECMAScript 6, such as Array, Date, and so on. Standard objects may be ordinary or exotic.</td>
</tr>
<tr>
<td>Built-in objects</td>
<td>Are present in a JavaScript execution environment when a script begins to execute. All standard objects are built-in objects.</td>
</tr>
</tbody>
</table>
<h2 id="4-2-Object-Literal-Syntax-Extensions"><a href="#4-2-Object-Literal-Syntax-Extensions" class="headerlink" title="4.2 Object Literal Syntax Extensions"></a>4.2 Object Literal Syntax Extensions</h2><ul>
<li><p>Property Initializer Shorthand</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, age</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">name</span>: name, <span class="attr">age</span>: age&#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, age</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> &#123;name, age&#125;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Concise Methods</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    sayName() &#123; <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Computed Property Names</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// syntax error in ES5</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    <span class="string">"first name"</span>: <span class="string">"Nicholas"</span></span><br><span class="line">&#125;;</span><br><span class="line">person[<span class="string">"first name"</span>] = <span class="string">"John"</span>;</span><br><span class="line">person[<span class="string">"first"</span> + suffix] = <span class="string">"Nicholas"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-3-New-Methods"><a href="#4-3-New-Methods" class="headerlink" title="4.3 New Methods"></a>4.3 New Methods</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Object.is()</td>
<td>Similar as ===, but better for (+0, -0) and (NaN, NaN)</td>
</tr>
<tr>
<td>Object.assign()</td>
<td>one object receives properties and methods from another object</td>
</tr>
</tbody>
</table>
<h2 id="4-4-Duplicate-Object-Literal-Properties"><a href="#4-4-Duplicate-Object-Literal-Properties" class="headerlink" title="4.4 Duplicate Object Literal Properties"></a>4.4 Duplicate Object Literal Properties</h2><ul>
<li><p>No error even in strict mode</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Nicholas"</span>,</span><br><span class="line">    name: <span class="string">"Greg"</span>        <span class="comment">// no error in ES6 strict mode</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person.name);       <span class="comment">// "Greg"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-5-Own-Property-Enumeration-Order"><a href="#4-5-Own-Property-Enumeration-Order" class="headerlink" title="4.5 Own Property Enumeration Order"></a>4.5 Own Property Enumeration Order</h2><ul>
<li>This affects how properties are returned using <ul>
<li>Object.getOwnPropertyNames() </li>
<li>Reflect.ownKeys (Chapter 12)</li>
<li>Object.assign()</li>
</ul>
</li>
<li>Rule<ol>
<li>All numeric keys in ascending order</li>
<li>All string keys in the order in which they were added to the object</li>
<li>All symbol keys (Chapter 6) in the order in which they were added to the object</li>
</ol>
</li>
</ul>
<h2 id="4-6-More-Powerful-Prototypes"><a href="#4-6-More-Powerful-Prototypes" class="headerlink" title="4.6 More Powerful Prototypes"></a>4.6 More Powerful Prototypes</h2><ul>
<li><p>Changing an Object’s Prototype</p>
<ul>
<li><p>No standard way to change an object’s prototype after instantiation in ES5</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">getGreeting() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dog = &#123;</span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Woof"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// prototype is person</span></span><br><span class="line"><span class="keyword">let</span> friend = <span class="built_in">Object</span>.create(person);</span><br><span class="line"><span class="built_in">console</span>.log(friend.getGreeting());                      <span class="comment">// "Hello"</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(friend) === person);  <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// set prototype to dog</span></span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(friend, dog);</span><br><span class="line"><span class="built_in">console</span>.log(friend.getGreeting());                      <span class="comment">// "Woof"</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getPrototypeOf(friend) === dog);     <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Easy Prototype Access with Super References</p>
<ul>
<li><p>Introduce <code>super</code> keyword</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> friend = &#123;</span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.getPrototypeOf(<span class="keyword">this</span>).getGreeting.call(<span class="keyword">this</span>) + <span class="string">", hi!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// the same as</span></span><br><span class="line"><span class="keyword">let</span> friend = &#123;</span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getGreeting() + <span class="string">", hi!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Attempting to use super outside of <strong>concise methods</strong> results in a syntax error</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> friend = &#123;</span><br><span class="line">    getGreeting: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// syntax error</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getGreeting() + <span class="string">", hi!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-7-A-Formal-Method-Definition"><a href="#4-7-A-Formal-Method-Definition" class="headerlink" title="4.7 A Formal Method Definition"></a>4.7 A Formal Method Definition</h2><ul>
<li>ECMAScript 6 formally defines a method as a function</li>
<li>This function has an internal <code>[[HomeObject]]</code> property containing the object to which the method belongs</li>
<li>The <code>[[HomeObject]]</code> for <code>getGreeting()</code> method is <code>person</code>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    <span class="comment">// method</span></span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// not a method: because not in an object</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shareGreeting</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hi!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>Advanced knowledge</strong>: Any reference to <code>super</code> uses the <code>[[HomeObject]]</code> to determine what to do</p>
<ol>
<li>Call <code>Object.getPrototypeOf()</code> on the <code>[[HomeObject]]</code> to retrieve a reference to the prototype. <ul>
<li><code>[[HomeObject]]</code> of <code>friend.getGreeting()</code> is <code>friend</code></li>
</ul>
</li>
<li>the prototype is searched for a function with the same name.<ul>
<li>the prototype of <code>friend</code> is <code>person</code></li>
</ul>
</li>
<li><p>the <code>this</code> binding is set and the method is called.</p>
<ul>
<li>bind <code>this</code> to <code>person</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// prototype is person</span></span><br><span class="line"><span class="keyword">let</span> friend = &#123;</span><br><span class="line">    getGreeting() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getGreeting() + <span class="string">", hi!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">Object</span>.setPrototypeOf(friend, person);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(friend.getGreeting());  <span class="comment">// "Hello, hi!"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h1 id="Chapter5-Destructuring-for-Easier-Data-Access"><a href="#Chapter5-Destructuring-for-Easier-Data-Access" class="headerlink" title="Chapter5 Destructuring for Easier Data Access"></a>Chapter5 Destructuring for Easier Data Access</h1><h2 id="5-1-Why-is-Destructuring-Useful"><a href="#5-1-Why-is-Destructuring-Useful" class="headerlink" title="5.1 Why is Destructuring Useful?"></a>5.1 Why is Destructuring Useful?</h2><p>The ECMAScript 6 implementation actually use syntax for object and array literals.</p>
<h2 id="5-2-Object-Destructuring"><a href="#5-2-Object-Destructuring" class="headerlink" title="5.2 Object Destructuring"></a>5.2 Object Destructuring</h2><ul>
<li><p>Destructuring Assignment</p>
<ul>
<li>All destructuring should be initialized when declaring  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; type, name &#125; = node;</span><br><span class="line">(&#123; type, name &#125; = node);    <span class="comment">//change the values of variables</span></span><br><span class="line">outputInfo(&#123; type, name &#125; = node);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Default Values</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; type, name, value = <span class="literal">true</span> &#125; = node;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Assigning to Different Local Variable Names</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; <span class="attr">type</span>: localType, <span class="attr">name</span>: localName = <span class="string">"bar"</span> &#125; = node;    <span class="comment">// default value</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(localName);     <span class="comment">// "bar"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Nested Object Destructuring</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> node = &#123;</span><br><span class="line">    type: <span class="string">"Identifier"</span>,</span><br><span class="line">    name: <span class="string">"foo"</span>,</span><br><span class="line">    loc: &#123;</span><br><span class="line">        start: &#123;</span><br><span class="line">            line: <span class="number">1</span>,</span><br><span class="line">            column: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        end: &#123;</span><br><span class="line">            line: <span class="number">1</span>,</span><br><span class="line">            column: <span class="number">4</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// extract node.loc.start</span></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">loc</span>: &#123; <span class="attr">start</span>: localStart &#125;&#125; = node;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(localStart.line);   <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(localStart.column); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-3-Array-Destructuring"><a href="#5-3-Array-Destructuring" class="headerlink" title="5.3 Array Destructuring"></a>5.3 Array Destructuring</h2><ul>
<li><p>Destructuring Assignment</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [ <span class="string">"red"</span>, <span class="string">"green"</span>, <span class="string">"blue"</span> ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [ , , thirdColor ] = colors;</span><br><span class="line">[firstColor, secondColor, thirdColor] = colors; <span class="comment">// no bracket compared with obj destruct</span></span><br><span class="line">[ a, b ] = [ b, a ];    <span class="comment">// swap variable</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Default Values</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [ firstColor, secondColor = <span class="string">"green"</span> ] = colors;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Nested Destructuring</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [ <span class="string">"red"</span>, [ <span class="string">"green"</span>, <span class="string">"lightgreen"</span> ], <span class="string">"blue"</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// later</span></span><br><span class="line"><span class="keyword">let</span> [ firstColor, [ secondColor ] ] = colors;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>Rest Items</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [ <span class="string">"red"</span>, <span class="string">"green"</span>, <span class="string">"blue"</span> ];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> [ firstColor, ...restColors ] = colors;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-4-Mixed-Destructuring"><a href="#5-4-Mixed-Destructuring" class="headerlink" title="5.4 Mixed Destructuring"></a>5.4 Mixed Destructuring</h2><ul>
<li>Combination of <code>Object Destructuring</code> and <code>Array Destructuring</code></li>
<li><p>Use case: fetch info from <code>JSON</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> node = &#123;</span><br><span class="line">    type: <span class="string">"Identifier"</span>,</span><br><span class="line">    name: <span class="string">"foo"</span>,</span><br><span class="line">    loc: &#123;</span><br><span class="line">        start: &#123;</span><br><span class="line">            line: <span class="number">1</span>,</span><br><span class="line">            column: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        end: &#123;</span><br><span class="line">            line: <span class="number">1</span>,</span><br><span class="line">            column: <span class="number">4</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    range: [<span class="number">0</span>, <span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">    loc: &#123; start &#125;,</span><br><span class="line">    range: [ startIndex ]</span><br><span class="line">&#125; = node;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(start.line);        <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(start.column);      <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(startIndex);        <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="5-5-Destructured-Parameters"><a href="#5-5-Destructured-Parameters" class="headerlink" title="5.5 Destructured Parameters"></a>5.5 Destructured Parameters</h2><ul>
<li><p>It supports everything in this chapter, including:</p>
<ul>
<li>default values</li>
<li>mix object and array patterns</li>
<li><p>use variable names that differ from the properties</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, &#123; secure, path, domain, expires &#125;</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// code to set the cookie</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCookie</span>(<span class="params">name, value, &#123; </span></span></span><br><span class="line"><span class="function"><span class="params">    secure = false, </span></span></span><br><span class="line"><span class="function"><span class="params">    path = <span class="string">"/"</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    domain = <span class="string">"example.com"</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">    expires = new Date(Date.now(</span>) + 360000000 </span></span><br><span class="line"><span class="function">    &#125;) </span>&#123;</span><br><span class="line">    <span class="comment">// with default value</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setCookie(<span class="string">"type"</span>, <span class="string">"js"</span>, &#123;</span><br><span class="line">    secure: <span class="literal">true</span>,</span><br><span class="line">    expires: <span class="number">60000</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h1 id="Chapter6-Symbols-and-Symbol-Properties"><a href="#Chapter6-Symbols-and-Symbol-Properties" class="headerlink" title="Chapter6 Symbols and Symbol Properties"></a>Chapter6 Symbols and Symbol Properties</h1><p>The <code>private names</code> proposal eventually evolved into ECMAScript 6 <code>symbols</code></p>
<h2 id="6-1-Creating-Symbols"><a href="#6-1-Creating-Symbols" class="headerlink" title="6.1 Creating Symbols"></a>6.1 Creating Symbols</h2><ul>
<li><p>Creating and Typeof</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstName = <span class="built_in">Symbol</span>(<span class="string">"first name"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(firstName); <span class="comment">// print firstName.toString(), which is [[Description]] </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> firstName);  <span class="comment">// "symbol"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-2-Using-Symbols"><a href="#6-2-Using-Symbols" class="headerlink" title="6.2 Using Symbols"></a>6.2 Using Symbols</h2><ul>
<li><p>computed object literal property names</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">[firstName]: <span class="string">"Nicholas"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Object.defineProperty()</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(person, firstName, &#123; <span class="attr">writable</span>: <span class="literal">false</span> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-3-Sharing-Symbols"><a href="#6-3-Sharing-Symbols" class="headerlink" title="6.3 Sharing Symbols"></a>6.3 Sharing Symbols</h2><ul>
<li><p>create a shared symbol</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> uid = <span class="built_in">Symbol</span>.for(<span class="string">"uid"</span>);</span><br><span class="line"><span class="keyword">let</span> uid2 = <span class="built_in">Symbol</span>.for(<span class="string">"uid"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(uid === uid2);      <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>access global shared symbol key</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Symbol</span>.keyFor(uid2));   <span class="comment">// "uid"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-4-Symbol-Coercion"><a href="#6-4-Symbol-Coercion" class="headerlink" title="6.4 Symbol Coercion"></a>6.4 Symbol Coercion</h2><ul>
<li>Don’t do it</li>
</ul>
<h2 id="6-5-Retrieving-Symbol-Properties"><a href="#6-5-Retrieving-Symbol-Properties" class="headerlink" title="6.5 Retrieving Symbol Properties"></a>6.5 Retrieving Symbol Properties</h2><ul>
<li><code>Object.keys()</code> and <code>Object.getOwnPropertyNames()</code> don’t support Symbol property</li>
<li><p>Instead <code>Object.getOwnProperty-Symbols()</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> uid = <span class="built_in">Symbol</span>.for(<span class="string">"uid"</span>);</span><br><span class="line"><span class="keyword">let</span> object = &#123;</span><br><span class="line">    [uid]: <span class="string">"12345"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> symbols = <span class="built_in">Object</span>.getOwnPropertySymbols(object);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(symbols.length);        <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(symbols[<span class="number">0</span>]);            <span class="comment">// "Symbol(uid)"</span></span><br><span class="line"><span class="built_in">console</span>.log(object[symbols[<span class="number">0</span>]]);    <span class="comment">// "12345"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="6-6-Exposing-Internal-Operations-with-Well-Known-Symbols"><a href="#6-6-Exposing-Internal-Operations-with-Well-Known-Symbols" class="headerlink" title="6.6 Exposing Internal Operations with Well-Known Symbols"></a>6.6 Exposing Internal Operations with Well-Known Symbols</h2><ul>
<li><p>An example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="string">"Hello"</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="string">"world"</span>,</span><br><span class="line">    length: <span class="number">2</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.isConcatSpreadable]: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Full list</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Symbol.hasInstance</td>
<td>A method used by instanceof to determine an object’s inheritance.</td>
</tr>
<tr>
<td>Symbol.isConcatSpreadable</td>
<td>A Boolean value indicating that <code>Array.prototype.concat()</code> should flatten the collection’s elements if the collection is passed as a parameter to <code>Array.prototype.concat()</code>.</td>
</tr>
<tr>
<td>Symbol.iterator</td>
<td>A method that returns an iterator. (Chapter 8)</td>
</tr>
<tr>
<td>Symbol.match</td>
<td>Used by <code>String.prototype.match()</code> to compare strings.</td>
</tr>
<tr>
<td>Symbol.replace</td>
<td>Uused by <code>String.prototype.replace()</code> to replace substrings.</td>
</tr>
<tr>
<td>Symbol.search</td>
<td>Used by <code>String.prototype.search()</code> to locate substrings.</td>
</tr>
<tr>
<td>Symbol.species</td>
<td>The constructor for making derived objects. (Chapter 9)</td>
</tr>
<tr>
<td>Symbol.split</td>
<td>Used by <code>String.prototype.split()</code> to split up strings.</td>
</tr>
<tr>
<td>Symbol.toPrimitive</td>
<td>A method that returns a primitive value representation of an object.</td>
</tr>
<tr>
<td>Symbol.toStringTag</td>
<td>Used by <code>Object.prototype.toString()</code> to create an object description.</td>
</tr>
<tr>
<td>Symbol.unscopables</td>
<td>An object whose properties are the names of object properties that should not be included in a with statement.</td>
</tr>
</tbody>
</table>
<h1 id="Chapter7-Sets-and-Maps"><a href="#Chapter7-Sets-and-Maps" class="headerlink" title="Chapter7 Sets and Maps"></a>Chapter7 Sets and Maps</h1><h2 id="7-1-Sets-and-Maps-in-ECMAScript-5"><a href="#7-1-Sets-and-Maps-in-ECMAScript-5" class="headerlink" title="7.1 Sets and Maps in ECMAScript 5"></a>7.1 Sets and Maps in ECMAScript 5</h2><ul>
<li>Example  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">set.foo = <span class="literal">true</span>; <span class="comment">// set</span></span><br><span class="line">set.foo = bar;  <span class="comment">// map</span></span><br><span class="line"><span class="keyword">if</span> (set.foo) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-2-Problems-with-Workarounds"><a href="#7-2-Problems-with-Workarounds" class="headerlink" title="7.2 Problems with Workarounds"></a>7.2 Problems with Workarounds</h2><ul>
<li>a[0] and a[“0”]: different type but as same key</li>
<li>a[{}] and a[{}]: different obj but as same key </li>
</ul>
<h2 id="7-3-Sets-in-ECMAScript-6"><a href="#7-3-Sets-in-ECMAScript-6" class="headerlink" title="7.3 Sets in ECMAScript 6"></a>7.3 Sets in ECMAScript 6</h2><ul>
<li>Init: <code>let a = new Map();</code></li>
<li>Methods:<ul>
<li>add()</li>
<li>size</li>
<li>has()</li>
<li>delete()</li>
<li>clear()</li>
</ul>
</li>
<li><p>forEach(function(next, key, ownerSet), thisArg)</p>
<ul>
<li><code>next</code> always equal to <code>key</code></li>
<li><code>ownerSet</code>: set itself</li>
<li><code>thisArg</code>: defined <code>this</code> in function</li>
<li>Use an arrow function to get the same effect without passing <code>thisArg</code></li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process(dataSet) &#123;</span><br><span class="line">    dataSet.forEach(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">this</span>.output(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process(dataSet) &#123;</span><br><span class="line">    dataSet.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.output(value);</span><br><span class="line">    &#125;, <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Set vs Array  </p>
</li>
</ul>
<table>
<thead>
<tr>
<th>convert</th>
<th>implement</th>
</tr>
</thead>
<tbody>
<tr>
<td>Set -&gt; Array</td>
<td><code>[...set]</code></td>
</tr>
<tr>
<td>Array -&gt; Set</td>
<td><code>new Set(arr);</code></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Weak Set</p>
<ul>
<li><p>Issue with Set: garbage collection</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(),</span><br><span class="line">    key = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">set.add(key);</span><br><span class="line"></span><br><span class="line">key = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(set.size);      <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get the original reference back</span></span><br><span class="line">key = [...set][<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
</li>
<li><p>Init weak set: <code>new WeakSet()</code></p>
</li>
<li>Difference:<ol>
<li><code>add()</code> can only be object</li>
<li>Not iterable: cannot use <code>for-of</code> (link 8.4)</li>
<li>Do not expose iterator: e.g. no <code>keys()</code>, <code>values()</code></li>
<li>No <code>forEach()</code></li>
<li>No <code>size</code> attribute</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="7-4-Maps-in-ECMAScript-6"><a href="#7-4-Maps-in-ECMAScript-6" class="headerlink" title="7.4 Maps in ECMAScript 6"></a>7.4 Maps in ECMAScript 6</h2><ul>
<li>Init: <ul>
<li><code>let a = new Map();</code></li>
<li><code>let a = new Map([[&quot;kk&quot;, &quot;vv&quot;], &quot;kkk&quot;, &quot;vvv&quot;]]);</code></li>
</ul>
</li>
<li>Methods:<ul>
<li>set()</li>
<li>get()</li>
<li>size</li>
<li>has()</li>
<li>delete()</li>
<li>clear()</li>
</ul>
</li>
<li>forEach(): similar as Set, but callback <code>function(key, value, ownerMet)</code></li>
<li><p>Weak Set: similar as Set</p>
<ul>
<li>Only key is weak reference, not value</li>
<li><p>Use case:</p>
<ul>
<li>associated data with DOM elements<ul>
<li>key is removed authomatically while it is removed from DOM</li>
<li>never mind </li>
</ul>
</li>
<li><p>private attribute: amazing !!!</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Person = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> privateData = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        privateData.set(<span class="keyword">this</span>, &#123; <span class="attr">name</span>: name &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> privateData.get(<span class="keyword">this</span>).name;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Person;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Chapter8-Iterators-and-Generators"><a href="#Chapter8-Iterators-and-Generators" class="headerlink" title="Chapter8 Iterators and Generators"></a>Chapter8 Iterators and Generators</h1><p>Use case:</p>
<ul>
<li><code>for-of</code></li>
<li>spread operator: <code>...</code></li>
<li>Asynchronous</li>
</ul>
<h2 id="8-1-The-Loop-Problem"><a href="#8-1-The-Loop-Problem" class="headerlink" title="8.1 The Loop Problem"></a>8.1 The Loop Problem</h2><h2 id="8-2-What-are-Iterators"><a href="#8-2-What-are-Iterators" class="headerlink" title="8.2 What are Iterators?"></a>8.2 What are Iterators?</h2><ul>
<li>Iterators are just objects with a specific interface designed for iteration. </li>
<li>All iterator objects have a next() method that returns<ul>
<li>{value: value, done: bool}</li>
</ul>
</li>
</ul>
<h2 id="8-3-What-Are-Generators"><a href="#8-3-What-Are-Generators" class="headerlink" title="8.3 What Are Generators?"></a>8.3 What Are Generators?</h2><ul>
<li>Definition<ul>
<li>indicated by a star character (*) after the function keyword </li>
<li>use the new <code>yield</code> keyword<ul>
<li><code>yield</code> can only be used in generator or syntax error will show up</li>
</ul>
</li>
<li>fetch value by <code>next()</code></li>
</ul>
</li>
<li><p>Example</p>
<ul>
<li><p>function keyword</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> iterator = createIterator();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next().value);     <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Generator Function Expression</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> createIterator = <span class="function"><span class="keyword">function</span> *(<span class="params">items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> items[i];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Generator Object Methods</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">    createIterator: <span class="function"><span class="keyword">function</span> *(<span class="params">items</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">yield</span> items[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">		</span><br><span class="line"><span class="comment">// method shorthand</span></span><br><span class="line"><span class="keyword">var</span> o = &#123;</span><br><span class="line">    *createIterator(items) &#123;</span><br><span class="line">        <span class="keyword">yield</span> items[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="8-4-Iterables-and-for-of"><a href="#8-4-Iterables-and-for-of" class="headerlink" title="8.4 Iterables and for-of"></a>8.4 Iterables and for-of</h2><ul>
<li><p>Iterables: An iterable is an object with a <code>Symbol.iterator</code> property. </p>
</li>
<li><p>for-of</p>
<ul>
<li>for-of loop first calls the <code>Symbol.iterator</code> method on array/set/map to retrieve an iterator. </li>
<li>for-of loop calls <code>next()</code> on an iterable each time the loop executes</li>
<li><p>stores the value from the result object in a variable</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> values = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> iterator = values[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next());</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>Creating Iterables  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> collection = &#123;</span><br><span class="line">    items: [],</span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">this</span>.items) &#123;</span><br><span class="line">            <span class="keyword">yield</span> item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="8-5-Built-in-Iterators"><a href="#8-5-Built-in-Iterators" class="headerlink" title="8.5 Built-in Iterators"></a>8.5 Built-in Iterators</h2><ul>
<li>entries(): Map default</li>
<li>keys()</li>
<li>values(): Set, Array default</li>
<li><p>Example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> map.entries())&#123;&#125;</span><br><span class="line"><span class="comment">// the same as</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entry <span class="keyword">of</span> map)&#123;&#125;        <span class="comment">// Destructing: for (let [k, v] of map) &#123;&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String</code>, <code>NodeList</code> are also iterable</p>
</li>
</ul>
<h2 id="8-6-The-Spread-Operator-and-Non-Array-Iterables"><a href="#8-6-The-Spread-Operator-and-Non-Array-Iterables" class="headerlink" title="8.6 The Spread Operator and Non-Array Iterables"></a>8.6 The Spread Operator and Non-Array Iterables</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> smallNumbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    bigNumbers = [<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>],</span><br><span class="line">    allNumbers = [<span class="number">0</span>, ...smallNumbers, ...bigNumbers];</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="8-7-Advanced-Iterator-Functionality"><a href="#8-7-Advanced-Iterator-Functionality" class="headerlink" title="8.7 Advanced Iterator Functionality"></a>8.7 Advanced Iterator Functionality</h2><ul>
<li><p>Passing Arguments to Iterators</p>
<ul>
<li>The first call to next() is lost. </li>
<li><p>arguments passed to next() become the values returned by yield</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> first = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">let</span> second = <span class="keyword">yield</span> first + <span class="number">2</span>;       <span class="comment">// 4 + 2</span></span><br><span class="line">    <span class="keyword">yield</span> second + <span class="number">3</span>;                   <span class="comment">// 5 + 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> iterator = createIterator();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next());           <span class="comment">// "&#123; value: 1, done: false &#125;"</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next(<span class="number">4</span>));          <span class="comment">// "&#123; value: 6, done: false &#125;"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Throwing Errors in Iterators</p>
<ul>
<li><code>console.log(iterator.throw(new Error(&quot;Boom&quot;)));</code></li>
<li>can have try-catch in generator</li>
</ul>
</li>
<li><p>Generator Return Statements</p>
<ul>
<li>indicates that all processing is done, so the done property is set to true</li>
<li>the value, if provided, becomes the value field</li>
</ul>
</li>
<li><p>Delegating Generators</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createCombinedIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> *createNumberIterator();</span><br><span class="line">    <span class="keyword">yield</span> *createColorIterator();</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="8-8-Asynchronous-Task-Running"><a href="#8-8-Asynchronous-Task-Running" class="headerlink" title="8.8 Asynchronous Task Running"></a>8.8 Asynchronous Task Running</h2><ul>
<li><p>Use case:</p>
<ul>
<li>run asynchronous task by order</li>
<li>callback for asynchronous task</li>
</ul>
</li>
<li><p>Principle</p>
<ul>
<li>Store a series of asyn function in generator</li>
<li>Only after yeilding the result of an asyn function, we do next one</li>
</ul>
</li>
<li><p>Final</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;                         <span class="comment">// the callback for result.value</span></span><br><span class="line">        fs.readFile(filename, callback);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">taskDef</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create the iterator, make available elsewhere</span></span><br><span class="line">    <span class="keyword">let</span> task = taskDef();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// start the task</span></span><br><span class="line">    <span class="keyword">let</span> result = task.next();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result.done) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> result.value === <span class="string">"function"</span>) &#123;   <span class="comment">// check if need to run callback</span></span><br><span class="line">                result.value(<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        result = task.throw(err);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    result = task.next(data);</span><br><span class="line">                    step();</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                result = task.next(result.value);</span><br><span class="line">                step();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// start the process</span></span><br><span class="line">    step();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">run(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> contents = <span class="keyword">yield</span> readFile(<span class="string">"config.json"</span>);</span><br><span class="line">    doSomethingWith(contents);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Done"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter9-Introducing-JavaScript-Classes"><a href="#Chapter9-Introducing-JavaScript-Classes" class="headerlink" title="Chapter9 Introducing JavaScript Classes"></a>Chapter9 Introducing JavaScript Classes</h1><h2 id="9-1-Class-Like-Structures-in-ECMAScript-5"><a href="#9-1-Class-Like-Structures-in-ECMAScript-5" class="headerlink" title="9.1 Class-Like Structures in ECMAScript 5"></a>9.1 Class-Like Structures in ECMAScript 5</h2><ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PersonType</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PersonType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> PersonType(<span class="string">"Nicholas"</span>);</span><br><span class="line">person.sayName();   <span class="comment">// outputs "Nicholas"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> PersonType);  <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-2-Class-Declarations"><a href="#9-2-Class-Declarations" class="headerlink" title="9.2 Class Declarations"></a>9.2 Class Declarations</h2><h3 id="9-2-1-Example"><a href="#9-2-1-Example" class="headerlink" title="9.2.1 Example"></a>9.2.1 Example</h3><ul>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    sayName() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> PersonClass(<span class="string">"Nicholas"</span>);</span><br><span class="line">person.sayName();   <span class="comment">// outputs "Nicholas"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> PersonClass);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> <span class="built_in">Object</span>);          <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> PersonClass);    <span class="comment">// "function"</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> PersonClass.prototype.sayName);  <span class="comment">// "function"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>The PersonClass declaration actually creates a <strong>function</strong> that has the behavior of the <strong>constructor</strong> method, which is why <code>typeof PersonClass</code> gives “function” as the result</p>
</li>
<li>The <code>sayName()</code> method also becomes a method on <code>PersonClass.prototype</code></li>
</ul>
<h3 id="9-2-2-important-difference-with-custom-types"><a href="#9-2-2-important-difference-with-custom-types" class="headerlink" title="9.2.2 important difference with custom types"></a>9.2.2 important difference with custom types</h3><ol>
<li>Class declarations are not hoisted. Act like <code>let</code> declarations and so exist in the <strong>temporal dead zone</strong> until execution reaches the declaration.</li>
<li>All code inside of class declarations runs in <strong>strict mode</strong> automatically.</li>
<li>All methods are non-enumerable.</li>
<li>All methods lack an internal <code>[[Construct]]</code> method and will throw an error if you try to call them with <code>new</code>.</li>
<li>Calling the class constructor without new throws an error.</li>
<li>Attempting to overwrite the class name within a class method throws an error.</li>
</ol>
<ul>
<li><p>Equivalent of PersonClass, this is <strong>awesome</strong></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> PersonType2 = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="keyword">const</span> PersonType2 = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// make sure the function was called with new</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">new</span>.target === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Constructor must be called with new."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(PersonType2.prototype, <span class="string">"sayName"</span>, &#123;</span><br><span class="line">        value: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// make sure the method wasn't called with new</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">new</span>.target !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Method cannot be called with new."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">        &#125;,</span><br><span class="line">        enumerable: <span class="literal">false</span>,</span><br><span class="line">        writable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> PersonType2;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-3-Class-Expressions"><a href="#9-3-Class-Expressions" class="headerlink" title="9.3 Class Expressions"></a>9.3 Class Expressions</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> PersonClass = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> PersonClass(<span class="string">"Nicholas"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-4-Classes-as-First-Class-Citizens"><a href="#9-4-Classes-as-First-Class-Citizens" class="headerlink" title="9.4 Classes as First-Class Citizens"></a>9.4 Classes as First-Class Citizens</h2><ul>
<li><p>first-class citizen means: </p>
<ul>
<li>it can be used as a value</li>
<li>it can be passed into a function</li>
<li>returned from a function</li>
<li><p>assigned to a variable</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createObject</span>(<span class="params">classDef</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> classDef();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = createObject(<span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    sayHi() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Hi!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">obj.sayHi();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>creating singletons</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> <span class="class"><span class="keyword">class</span> </span>&#123;...&#125;(<span class="string">"Nicholas"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-5-Accessor-Properties"><a href="#9-5-Accessor-Properties" class="headerlink" title="9.5 Accessor Properties"></a>9.5 Accessor Properties</h2><ul>
<li><code>getter</code> and <code>setter</code>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomHTMLElement</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element = element;</span><br><span class="line">    &#125;</span><br><span class="line">    get html() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.element.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">    set html(value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element.innerHTML = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(CustomHTMLElement.prototype, <span class="string">"ht\</span></span><br><span class="line"><span class="string">ml"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"get"</span> <span class="keyword">in</span> descriptor);   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"set"</span> <span class="keyword">in</span> descriptor);   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(descriptor.enumerable); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-6-Computed-Member-Names"><a href="#9-6-Computed-Member-Names" class="headerlink" title="9.6 Computed Member Names"></a>9.6 Computed Member Names</h2><ul>
<li>Nothing special  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> propertyName = <span class="string">"html"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomHTMLElement</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element = element;</span><br><span class="line">    &#125;</span><br><span class="line">    get [propertyName]() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.element.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">    set [propertyName](value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element.innerHTML = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-7-Generator-Methods"><a href="#9-7-Generator-Methods" class="headerlink" title="9.7 Generator Methods"></a>9.7 Generator Methods</h2><ul>
<li><p>Naive example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    *createIterator() &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> instance = <span class="keyword">new</span> MyClass();</span><br><span class="line"><span class="keyword">let</span> iterator = instance.createIterator();</span><br></pre></td></tr></table></figure>
</li>
<li><p>defining a default iterator for your class</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.items = [];</span><br><span class="line">    &#125;</span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">        <span class="keyword">yield</span> *<span class="keyword">this</span>.items.values();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> collection = <span class="keyword">new</span> Collection();</span><br><span class="line">collection.items.push(<span class="number">1</span>);</span><br><span class="line">collection.items.push(<span class="number">2</span>);</span><br><span class="line">collection.items.push(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> x <span class="keyword">of</span> collection) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-8-Static-Members"><a href="#9-8-Static-Members" class="headerlink" title="9.8 Static Members"></a>9.8 Static Members</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> create(name) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PersonClass(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="9-9-Inheritance-with-Derived-Classes"><a href="#9-9-Inheritance-with-Derived-Classes" class="headerlink" title="9.9 Inheritance with Derived Classes"></a>9.9 Inheritance with Derived Classes</h2><h3 id="9-9-1-Inheritance-with-Derived-Classes"><a href="#9-9-1-Inheritance-with-Derived-Classes" class="headerlink" title="9.9.1 Inheritance with Derived Classes"></a>9.9.1 Inheritance with Derived Classes</h3><ul>
<li>If specifying a constructor: <code>super()</code> is mandatory</li>
<li>If no constructor, <code>super()</code> is automatically called with all arguments upon creating a new instance of the class. </li>
<li>Can only use <code>super()</code> in a derived class.</li>
<li>Must call <code>super()</code> before accessing <code>this</code> in the constructor</li>
<li><p>The only way to avoid calling <code>super()</code> is to return an object from the class constructor.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="comment">// no constructor</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Is equivalent to</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(...args) &#123;</span><br><span class="line">        <span class="keyword">super</span>(...args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="9-9-2-Shadowing-Class-Method"><a href="#9-9-2-Shadowing-Class-Method" class="headerlink" title="9.9.2 Shadowing Class Method"></a>9.9.2 Shadowing Class Method</h3><ul>
<li><p>Just like other languages</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length) &#123;</span><br><span class="line">        <span class="keyword">super</span>(length, length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// override and shadow Rectangle.prototype.getArea()</span></span><br><span class="line">    getArea() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="9-9-3-Inherited-Static-Members"><a href="#9-9-3-Inherited-Static-Members" class="headerlink" title="9.9.3 Inherited Static Members"></a>9.9.3 Inherited Static Members</h3><ul>
<li><p>Just like other languages</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width) &#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    getArea() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> create(length, width) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Rectangle(length, width);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length) &#123;</span><br><span class="line">        <span class="comment">// same as Rectangle.call(this, length, length)</span></span><br><span class="line">        <span class="keyword">super</span>(length, length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = Square.create(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rect <span class="keyword">instanceof</span> Rectangle);     <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(rect.getArea());                <span class="comment">// 12</span></span><br><span class="line"><span class="built_in">console</span>.log(rect <span class="keyword">instanceof</span> Square);        <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="9-9-4-Derived-Classes-from-Expressions"><a href="#9-9-4-Derived-Classes-from-Expressions" class="headerlink" title="9.9.4 Derived Classes from Expressions"></a>9.9.4 Derived Classes from Expressions</h3><ul>
<li>Special<ul>
<li>You can use <code>extends</code> with any expression as long as the expression resolves to a function with <code>[[Construct]]</code> and a <code>prototype</code></li>
<li>Use case: dynamic extends<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle</span>(<span class="params">length, width</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.length = length;</span><br><span class="line">    <span class="keyword">this</span>.width = width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Rectangle.prototype.getArea = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getBase</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Rectangle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">getBase</span>() </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length) &#123;</span><br><span class="line">        <span class="keyword">super</span>(length, length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="keyword">new</span> Square(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(x.getArea());               <span class="comment">// 9</span></span><br><span class="line"><span class="built_in">console</span>.log(x <span class="keyword">instanceof</span> Rectangle);    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="9-9-5-Inheriting-from-Built-ins"><a href="#9-9-5-Inheriting-from-Built-ins" class="headerlink" title="9.9.5 Inheriting from Built-ins"></a>9.9.5 Inheriting from Built-ins</h3><ul>
<li><p>Just like other languages</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="comment">// empty</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> MyArray();</span><br><span class="line">colors[<span class="number">0</span>] = <span class="string">"red"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(colors.length);         <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">colors.length = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(colors[<span class="number">0</span>]);             <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="9-9-6-The-Symbol-species-Property"><a href="#9-9-6-The-Symbol-species-Property" class="headerlink" title="9.9.6 The Symbol.species Property"></a>9.9.6 The Symbol.species Property</h3><ul>
<li><p>Why?</p>
<ul>
<li><p>They think subitems should not be <code>instanceof MyArray</code>, while I feel it’s good</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyArray</span> <span class="keyword">extends</span> <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="comment">// empty</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> items = <span class="keyword">new</span> MyArray(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">    subitems = items.slice(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(items <span class="keyword">instanceof</span> MyArray);      <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(subitems <span class="keyword">instanceof</span> MyArray);   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>The Symbol.species well-known symbol is used to define a static accessor property that returns a function. The following builtin types have Symbol.species defined:</p>
<ul>
<li>Array</li>
<li>ArrayBuffer (discussed in Chapter 10)</li>
<li>Map</li>
<li>Promise</li>
<li>RegExp</li>
<li>Set</li>
<li>Typed Arrays (discussed in Chapter 10)</li>
</ul>
</li>
</ul>
<h2 id="9-10-Using-new-target-in-Class-Constructors"><a href="#9-10-Using-new-target-in-Class-Constructors" class="headerlink" title="9.10 Using new.target in Class Constructors"></a>9.10 Using new.target in Class Constructors</h2><ul>
<li>determine how the class is being invoked  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.target === Shape) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"This class cannot be instantiated directly."</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="keyword">new</span> Shape();                <span class="comment">// throws error</span></span><br><span class="line"><span class="keyword">var</span> y = <span class="keyword">new</span> Rectangle(<span class="number">3</span>, <span class="number">4</span>);        <span class="comment">// no error</span></span><br><span class="line"><span class="built_in">console</span>.log(y <span class="keyword">instanceof</span> Shape);    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter10-Improved-Array-Capabilities"><a href="#Chapter10-Improved-Array-Capabilities" class="headerlink" title="Chapter10 Improved Array Capabilities"></a>Chapter10 Improved Array Capabilities</h1><ul>
<li><p>Creating Arrays</p>
<ul>
<li><p><code>Array.of()</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>, <span class="number">2</span>);    <span class="comment">//[1, 2]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="number">1</span>);   <span class="comment">//[1]</span></span><br><span class="line"><span class="built_in">Array</span>.of(<span class="string">"1"</span>);  <span class="comment">//["1"]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Array.from(iterable, map, this)</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> helper = &#123;</span><br><span class="line">    diff: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">    add(value) &#123;</span><br><span class="line">        <span class="keyword">return</span> value + <span class="keyword">this</span>.diff;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">translate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>, helper.add, helper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> numbers = translate(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(numbers);               <span class="comment">// 2,3,4</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>New Methods on All Arrays</p>
<ul>
<li>find<ul>
<li><code>find(callback, this)</code></li>
<li><code>findIndex(callback, this)</code></li>
</ul>
</li>
<li><code>fill(value, startIndex, endIndex)</code></li>
<li><code>copyWithin(startFillIndex, startCopyIndex, howMany)</code></li>
</ul>
</li>
<li>Typed Arrays<ul>
<li>Improve calculation speed</li>
<li>Skip</li>
</ul>
</li>
</ul>
<h1 id="Chapter11-Promises-and-Asynchronous-Programming"><a href="#Chapter11-Promises-and-Asynchronous-Programming" class="headerlink" title="Chapter11 Promises and Asynchronous Programming"></a>Chapter11 Promises and Asynchronous Programming</h1><h2 id="11-1-Asynchronous-Programming-Background"><a href="#11-1-Asynchronous-Programming-Background" class="headerlink" title="11.1 Asynchronous Programming Background"></a>11.1 Asynchronous Programming Background</h2><ul>
<li>Background<ul>
<li>JavaScript engines are built on the concept of a single-threaded event loop</li>
<li>Whenever a piece of code is ready to be executed, it is added to the job queue</li>
<li>job execution runs from the first job in the queue to the last</li>
</ul>
</li>
<li>Old Patterns<ul>
<li>The Event Model<ul>
<li>chaining multiple separate asynchronous calls together is more complicated</li>
<li>button were clicked before onclick is assigned</li>
</ul>
</li>
<li>The Callback Pattern<ul>
<li>nested callback is dizaster</li>
<li>asynchronous operations to run in parallel</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="11-2-Promise-Basics"><a href="#11-2-Promise-Basics" class="headerlink" title="11.2 Promise Basics"></a>11.2 Promise Basics</h2><ul>
<li><code>[[PromiseState]]</code>: not exposed<ul>
<li>Fulfilled: Settled. Completed successfully.</li>
<li>Rejected: Settled. Didn’t complete successfully</li>
<li>Pending: Unsettled</li>
</ul>
</li>
<li><p>Promise vs thenable</p>
<ul>
<li>all promises are thenable</li>
<li>not all thenables are promise</li>
<li>all thenable has a <code>then(fulFill, reject)</code></li>
<li><p>all promise has a <code>then(fulFill, reject)</code> and <code>catch(reject)</code> method</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = readFile(<span class="string">"example.txt"</span>);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">contents</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// fulfillment</span></span><br><span class="line">    <span class="built_in">console</span>.log(contents);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// rejection</span></span><br><span class="line">    <span class="built_in">console</span>.error(err.message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// same</span></span><br><span class="line">promise.then(<span class="literal">null</span>, reject);</span><br><span class="line">promise.catch(reject);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Each call to <code>then()</code> or <code>catch()</code> creates a new job to be executed <strong>when the promise is resolved</strong></p>
</li>
<li>Without a rejection handler to a promise, all failures will happen silently</li>
</ul>
</li>
<li><p>Creating Unsettled Promises</p>
<ul>
<li><p><code>new Promise(excutor)</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// trigger the asynchronous operation</span></span><br><span class="line">        fs.readFile(filename, &#123; <span class="attr">encoding</span>: <span class="string">"utf8"</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, contents</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// check for errors</span></span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                reject(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// the read succeeded</span></span><br><span class="line">            resolve(contents);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fulfillment and rejection handlers are always added to the end of the job queue after the executor has completed. <strong>Behave like setTimeout</strong></p>
<ul>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Promise"</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Resolved."</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Hi!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Promise</span></span><br><span class="line"><span class="comment">// Hi!</span></span><br><span class="line"><span class="comment">// Resolved</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="11-3-Global-Promise-Rejection-Handling"><a href="#11-3-Global-Promise-Rejection-Handling" class="headerlink" title="11.3 Global Promise Rejection Handling"></a>11.3 Global Promise Rejection Handling</h2><ul>
<li>Issue: silent failure that occurs when a promise is rejected without a rejection handler</li>
<li><p>Solution: Event + setInterval</p>
<ul>
<li>event<ul>
<li>unhandlerejection</li>
<li>rejectionhandled</li>
</ul>
</li>
<li>setInterval</li>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> possiblyUnhandledRejections = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="built_in">window</span>.onunhandledrejection = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    possiblyUnhandledRejections.set(event.promise, event.reason);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">window</span>.onrejectionhandled = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    possiblyUnhandledRejections.delete(event.promise);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    possiblyUnhandledRejections.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">reason, promise</span>) </span>&#123;</span><br><span class="line">        handleRejection(promise, reason);</span><br><span class="line">    &#125;);</span><br><span class="line">possiblyUnhandledRejections.clear();</span><br><span class="line"></span><br><span class="line">&#125;, <span class="number">60000</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="11-4-Chaining-Promises"><a href="#11-4-Chaining-Promises" class="headerlink" title="11.4 Chaining Promises"></a>11.4 Chaining Promises</h2><ul>
<li>Each call to then() or catch() actually creates and returns another promise</li>
<li>This second promise is resolved only once the first has been fulfilled or rejected</li>
<li><p>example</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;resolve(<span class="number">42</span>);&#125;);</span><br><span class="line"></span><br><span class="line">p1.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then"</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Boom"</span>);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error.message);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Returning Values in Promise Chains</p>
<ul>
<li><p>data</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    reject(<span class="number">42</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p1.catch(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);         <span class="comment">// "42"</span></span><br><span class="line">    <span class="keyword">return</span> value + <span class="number">1</span>;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);         <span class="comment">// "43"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Promise</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    reject(<span class="number">42</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p1.catch(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);         <span class="comment">// "42"</span></span><br><span class="line">    <span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        reject(<span class="number">43</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> p2</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);         <span class="comment">// "43"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="11-5-Responding-to-Multiple-Promises"><a href="#11-5-Responding-to-Multiple-Promises" class="headerlink" title="11.5 Responding to Multiple Promises"></a>11.5 Responding to Multiple Promises</h2><ul>
<li><code>Promise.all()</code><ul>
<li>The returned promise is fulfilled when every promise in the iterable is fulfilled</li>
<li>If anyone is rejected, it is immediately rejected without waiting for others</li>
</ul>
</li>
<li><code>Promise.race()</code><ul>
<li>returns as soon as any promise in the array is fulfilled</li>
<li>if the first promise to settle is rejected, then the returned promise is rejected</li>
</ul>
</li>
</ul>
<h2 id="11-6-Inheriting-from-Promises"><a href="#11-6-Inheriting-from-Promises" class="headerlink" title="11.6 Inheriting from Promises"></a>11.6 Inheriting from Promises</h2><ul>
<li>Since static methods are inherited, resolve(), reject(), race(), all() method are also present on derived promises</li>
<li><p>Because of <code>Symbol.species</code>, resolve(), reject() will tag class as the derived class</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    resolve(<span class="number">42</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p2 = MyPromise.resolve(p1);</span><br><span class="line">p2.success(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);         <span class="comment">// 42</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(p2 <span class="keyword">instanceof</span> MyPromise);   <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter12-Proxies-and-the-Reflection-API"><a href="#Chapter12-Proxies-and-the-Reflection-API" class="headerlink" title="Chapter12 Proxies and the Reflection API"></a>Chapter12 Proxies and the Reflection API</h1><ul>
<li>Proxies exposes the inner workings of objects through</li>
<li>Proxies can intercept and alter low-level operations of the JavaScript engine. </li>
</ul>
<h2 id="12-1-The-Array-Problem"><a href="#12-1-The-Array-Problem" class="headerlink" title="12.1 The Array Problem"></a>12.1 The Array Problem</h2><ul>
<li>User cannot do <code>arr.length = 2</code></li>
</ul>
<h2 id="12-2-What-are-Proxies-and-Reflection"><a href="#12-2-What-are-Proxies-and-Reflection" class="headerlink" title="12.2 What are Proxies and Reflection?"></a>12.2 What are Proxies and Reflection?</h2><table>
<thead>
<tr>
<th>Proxy Trap</th>
<th>Overrides the Behavior Of</th>
<th>Default Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>get</td>
<td>Reading a property value</td>
<td>Reflect.get()</td>
</tr>
<tr>
<td>set</td>
<td>Writing to a property</td>
<td>Reflect.set()</td>
</tr>
<tr>
<td>has</td>
<td>The in operator</td>
<td>Reflect.has()</td>
</tr>
<tr>
<td>deleteProperty</td>
<td>The delete operator</td>
<td>Reflect.deleteProperty()</td>
</tr>
<tr>
<td>getPrototypeOf</td>
<td>Object.getPrototypeOf()</td>
<td>Reflect.getPrototypeOf()</td>
</tr>
<tr>
<td>setPrototypeOf</td>
<td>Object.setPrototypeOf()</td>
<td>Reflect.setPrototypeOf()</td>
</tr>
<tr>
<td>isExtensible</td>
<td>Object.isExtensible()</td>
<td>Reflect.isExtensible()</td>
</tr>
<tr>
<td>preventExtensions</td>
<td>Object.preventExtensions()</td>
<td>Reflect.preventExtensions()</td>
</tr>
<tr>
<td>getOwnPropertyDescriptor</td>
<td>Object.getOwnPropertyDescriptor()</td>
<td>Reflect.getOwnPropertyDescriptor()</td>
</tr>
<tr>
<td>defineProperty</td>
<td>Object.defineProperty()</td>
<td>Reflect.defineProperty</td>
</tr>
<tr>
<td>ownKeys</td>
<td>Object.keys, Object.getOwnPropertyNames(), Object.getOwnPropertySymbols()</td>
<td>Reflect.ownKeys()</td>
</tr>
<tr>
<td>apply</td>
<td>Calling a function</td>
<td>Reflect.apply()</td>
</tr>
<tr>
<td>construct</td>
<td>Calling a function with new</td>
<td>Reflect.construct()</td>
</tr>
</tbody>
</table>
<ul>
<li><p>example <code>set: only allow numbers for new property</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;</span><br><span class="line">    name: <span class="string">"target"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span><br><span class="line">    set(trapTarget, key, value, receiver) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ignore existing properties so as not to affect them</span></span><br><span class="line">        <span class="keyword">if</span> (!trapTarget.hasOwnProperty(key)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isNaN</span>(value)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Property must be a number."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add the property</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(trapTarget, key, value, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// adding a new property</span></span><br><span class="line">proxy.count = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(proxy.count);       <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(target.count);      <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// you can assign to name because it exists on target already</span></span><br><span class="line">proxy.name = <span class="string">"proxy"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(proxy.name);        <span class="comment">// "proxy"</span></span><br><span class="line"><span class="built_in">console</span>.log(target.name);       <span class="comment">// "proxy"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// throws an error</span></span><br><span class="line">proxy.anotherName = <span class="string">"proxy"</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Revocable Proxies</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = &#123;</span><br><span class="line">    name: <span class="string">"target"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; proxy, revoke &#125; = <span class="built_in">Proxy</span>.revocable(target, &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.name);        <span class="comment">// "target"</span></span><br><span class="line"></span><br><span class="line">revoke();</span><br><span class="line"></span><br><span class="line"><span class="comment">// throws error</span></span><br><span class="line"><span class="built_in">console</span>.log(proxy.name);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter13-Encapsulating-Code-With-Modules"><a href="#Chapter13-Encapsulating-Code-With-Modules" class="headerlink" title="Chapter13 Encapsulating Code With Modules"></a>Chapter13 Encapsulating Code With Modules</h1><h2 id="13-1-What-are-Modules"><a href="#13-1-What-are-Modules" class="headerlink" title="13.1 What are Modules?"></a>13.1 What are Modules?</h2><ul>
<li><strong>Variables</strong> created in the <strong>top level</strong> of a module exist only within the top-level scope of the module.</li>
<li>The value of <strong>this</strong> in the top level of a module is undefined.</li>
<li>Modules must export anything that should be available to code outside of the module.</li>
<li>Modules may import bindings from other modules.</li>
</ul>
<h2 id="13-2-Basic-Exporting"><a href="#13-2-Basic-Exporting" class="headerlink" title="13.2 Basic Exporting"></a>13.2 Basic Exporting</h2><ul>
<li>any variables, functions, or classes that are not explicitly exported remain private to the module</li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// export data</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> color = <span class="string">"red"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> name = <span class="string">"Nicholas"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> magicNumber = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export function</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export class</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width) &#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-3-Basic-Importing"><a href="#13-3-Basic-Importing" class="headerlink" title="13.3 Basic Importing"></a>13.3 Basic Importing</h2><ul>
<li>An important limitation of both export and import is that they must be used outside other statements and functions</li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; identifier1, identifier2 &#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> example <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-4-Renaming-Exports-and-Imports"><a href="#13-4-Renaming-Exports-and-Imports" class="headerlink" title="13.4 Renaming Exports and Imports"></a>13.4 Renaming Exports and Imports</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; sum <span class="keyword">as</span> add &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add <span class="keyword">as</span> sum &#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-5-Default-Values-in-Modules"><a href="#13-5-Default-Values-in-Modules" class="headerlink" title="13.5 Default Values in Modules"></a>13.5 Default Values in Modules</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br><span class="line"><span class="keyword">import</span> sum, &#123;color&#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-6-Re-exporting-a-Binding"><a href="#13-6-Re-exporting-a-Binding" class="headerlink" title="13.6 Re-exporting a Binding"></a>13.6 Re-exporting a Binding</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; sum &#125;;</span><br><span class="line"><span class="comment">// same as</span></span><br><span class="line"><span class="keyword">export</span> &#123; sum &#125; <span class="keyword">from</span> <span class="string">"./example.js"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-7-Importing-Without-Bindings"><a href="#13-7-Importing-Without-Bindings" class="headerlink" title="13.7 Importing Without Bindings"></a>13.7 Importing Without Bindings</h2><ul>
<li>Some modules may only make modifications to objects in the global scope</li>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module code without exports or imports</span></span><br><span class="line"><span class="built_in">Array</span>.prototype.pushAll = <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// items must be an array</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(items)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Argument must be an array."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// use built-in push() and spread operator</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.push(...items);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="13-8-Loading-Modules"><a href="#13-8-Loading-Modules" class="headerlink" title="13.8 Loading Modules"></a>13.8 Loading Modules</h2><ul>
<li>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span> src=<span class="string">"module.js"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>To support that functionality, always acts as if the defer attribute is applied</p>
</li>
<li>Modules are also executed in the order in which they appear in the HTML file</li>
<li>async<ul>
<li>All resources the module needs will be downloaded before the module executes</li>
<li>can’t guarantee when the module will execute</li>
</ul>
</li>
<li>Loading Modules as Workers<ul>
<li><code>let worker = new Worker(&quot;module.js&quot;, { type: &quot;module&quot; });</code></li>
</ul>
</li>
<li>Browser Module Specifier Resolution<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this script locates https://www.example.com/modules/module.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// imports from https://www.example.com/modules/example1.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; first &#125; <span class="keyword">from</span> <span class="string">"./example1.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// imports from https://www.example.com/example2.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; second &#125; <span class="keyword">from</span> <span class="string">"../example2.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// imports from https://www.example.com/example3.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; third &#125; <span class="keyword">from</span> <span class="string">"/example3.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// imports from https://www2.example.com/example4.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; fourth &#125; <span class="keyword">from</span> <span class="string">"https://www2.example.com/example4.js"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/" class="post-title-link" itemprop="url">Professional Javascript For Web Developer Learning Note</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-15 16:55:15" itemprop="dateCreated datePublished" datetime="2019-06-15T16:55:15-06:00">2019-06-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-10-09 19:48:25" itemprop="dateModified" datetime="2019-10-09T19:48:25-06:00">2019-10-09</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Chapter2-JavaScript-in-HTML"><a href="#Chapter2-JavaScript-in-HTML" class="headerlink" title="Chapter2 JavaScript in HTML"></a>Chapter2 JavaScript in HTML</h1><h2 id="2-1-The-lt-script-gt-Element"><a href="#2-1-The-lt-script-gt-Element" class="headerlink" title="2.1 The &lt;script&gt; Element"></a>2.1 The <code>&lt;script&gt;</code> Element</h2><ul>
<li>Attribute for script</li>
</ul>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>async</td>
<td>Indicates that the script should begin downloading immediately but should not prevent other actions on the page</td>
</tr>
<tr>
<td>charset</td>
<td></td>
</tr>
<tr>
<td>defer</td>
<td>deferred until after the document’s content has been completely parsed and displayed</td>
</tr>
<tr>
<td>src</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>default text/javascript</td>
</tr>
</tbody>
</table>
<ul>
<li>Without defer and async, the &lt;script> elements are interpreted in the order in which they appear in the page</li>
</ul>
<h2 id="2-2-Inline-Code-Versus-External-Files"><a href="#2-2-Inline-Code-Versus-External-Files" class="headerlink" title="2.2 Inline Code Versus External Files"></a>2.2 Inline Code Versus External Files</h2><h2 id="2-3-Document-Mode"><a href="#2-3-Document-Mode" class="headerlink" title="2.3 Document Mode"></a>2.3 Document Mode</h2><h2 id="2-4-The-lt-noscript-gt-Element"><a href="#2-4-The-lt-noscript-gt-Element" class="headerlink" title="2.4 The &lt;noscript&gt; Element"></a>2.4 The <code>&lt;noscript&gt;</code> Element</h2><ul>
<li><p>If browser does not support Javascript, it will show up</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>This page requires a JavaScript-enabled browser.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter3-Language-Basics"><a href="#Chapter3-Language-Basics" class="headerlink" title="Chapter3 Language Basics"></a>Chapter3 Language Basics</h1><h2 id="3-1-Syntax"><a href="#3-1-Syntax" class="headerlink" title="3.1 Syntax"></a>3.1 Syntax</h2><p><strong>Strict mode</strong></p>
<ul>
<li>Some of the erratic behavior of ECMAScript 3 is addressed and errors are thrown for unsafe activities</li>
<li>Enable strict mode for an entire script: include <code>&quot;use strict&quot;;</code> in js top</li>
<li><p>Enable strict mode for a function:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use strict"</span>;</span><br><span class="line">    <span class="comment">// code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-2-Keywords-And-Reserved-Words"><a href="#3-2-Keywords-And-Reserved-Words" class="headerlink" title="3.2 Keywords And Reserved Words"></a>3.2 Keywords And Reserved Words</h2><h2 id="3-3-Variables"><a href="#3-3-Variables" class="headerlink" title="3.3 Variables"></a>3.3 Variables</h2><ul>
<li>ECMAScript variables are loosely typed</li>
<li><p>Scope</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;  <span class="comment">// local variable</span></span><br><span class="line">    b = <span class="number">2</span>;  <span class="comment">// global variable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-4-Data-Types"><a href="#3-4-Data-Types" class="headerlink" title="3.4 Data Types"></a>3.4 Data Types</h2><ul>
<li>There are five primitive types in ECMAScript: <ul>
<li>Undefined</li>
<li>Null</li>
<li>Boolean</li>
<li>Number</li>
<li>String</li>
</ul>
</li>
</ul>
<h3 id="3-4-1-The-typeof-Operator"><a href="#3-4-1-The-typeof-Operator" class="headerlink" title="3.4.1 The typeof Operator"></a>3.4.1 The typeof Operator</h3><ul>
<li><p>Usage</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msg = <span class="string">"aaa"</span>;</span><br><span class="line">alert(<span class="keyword">typeof</span> msg);</span><br><span class="line">alert(<span class="keyword">typeof</span>(msg));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Return string</li>
</ul>
<table>
<thead>
<tr>
<th>Return</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>undefined</td>
<td>if the value is undefined</td>
</tr>
<tr>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>string</td>
<td></td>
</tr>
<tr>
<td>number</td>
<td></td>
</tr>
<tr>
<td>object</td>
<td>if the value is an object or null</td>
</tr>
<tr>
<td>function</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="3-4-2-The-Undefined-Type"><a href="#3-4-2-The-Undefined-Type" class="headerlink" title="3.4.2 The Undefined Type"></a>3.4.2 The Undefined Type</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">alert(a == <span class="literal">undefined</span>); <span class="comment">// declared: true </span></span><br><span class="line">alert(b == <span class="literal">undefined</span>); <span class="comment">// true</span></span><br><span class="line">alert(b); <span class="comment">// "undefined"</span></span><br><span class="line">alert(c == <span class="literal">undefined</span>); <span class="comment">// error</span></span><br><span class="line">alert(<span class="keyword">typeof</span> c); <span class="comment">// "undefined", this is weird</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-The-Null-Type"><a href="#3-4-3-The-Null-Type" class="headerlink" title="3.4.3 The Null Type"></a>3.4.3 The Null Type</h3><ul>
<li>A null value is an empty object pointer<ul>
<li>so <code>typeof null === &quot;object&quot; //true</code> </li>
</ul>
</li>
<li>The value undefined is a derivative of null<ul>
<li>so <code>null == undefined //true</code></li>
</ul>
</li>
</ul>
<h3 id="3-4-4-The-Boolean-Type"><a href="#3-4-4-The-Boolean-Type" class="headerlink" title="3.4.4 The Boolean Type"></a>3.4.4 The Boolean Type</h3><table>
<thead>
<tr>
<th>Type</th>
<th>Values converted to true</th>
<th>Values converted to false</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>String</td>
<td>Any nonempty string</td>
<td>“”</td>
</tr>
<tr>
<td>Number</td>
<td>Any nonzero number</td>
<td>0</td>
</tr>
<tr>
<td>Object</td>
<td>Any object</td>
<td>null</td>
</tr>
<tr>
<td>Undefined</td>
<td>NA</td>
<td>undefined</td>
</tr>
</tbody>
</table>
<h3 id="3-4-5-The-Number-Type"><a href="#3-4-5-The-Number-Type" class="headerlink" title="3.4.5 The Number Type"></a>3.4.5 The Number Type</h3><ul>
<li>base 8: <code>var octalNum = 070;</code></li>
<li>base 16: <code>var hexNum = 0xA;</code></li>
<li>e-notation: <code>var floatNum = 3.125e7</code></li>
<li>Infinity<ul>
<li>max number: <code>Number.MAX_VALUE</code></li>
<li>min number: <code>Number.MIN_VALUE</code></li>
<li>positive infinity: <code>Infinity</code> or <code>Number.POSITIVE_INFINITY</code></li>
<li>negative infinity: <code>-Infinity</code> or <code>Number.NEGATIVE_INFINITY</code></li>
<li><code>isInfinite(xxx)</code></li>
</ul>
</li>
<li>NaN(Not a Number)<ul>
<li>any number divided by not number: <code>10/&quot;abc&quot;</code></li>
<li>any NaN operation: <code>NaN/10</code></li>
<li>NaN is not equal to any value, including NaN: <code>NaN == NaN //false</code></li>
<li><code>isNaN()</code>: determine if the value is “not a number.”</li>
</ul>
</li>
<li>Number Conversions<ul>
<li>Number()</li>
<li>parseInt()</li>
<li>parseFloat()<h3 id="3-4-6-The-String-Type"><a href="#3-4-6-The-String-Type" class="headerlink" title="3.4.6 The String Type"></a>3.4.6 The String Type</h3></li>
</ul>
</li>
<li>Immutable</li>
<li>If the value has a toString() method, it is called (with no arguments) and the result is returned.</li>
<li>If the value is null, “null” is returned.</li>
<li>If the value is undefined, “undefined” is returned</li>
</ul>
<h3 id="3-4-7-The-Object-Type"><a href="#3-4-7-The-Object-Type" class="headerlink" title="3.4.7 The Object Type"></a>3.4.7 The Object Type</h3><ul>
<li><code>var o = new Object()</code></li>
<li>Each Object instance has the following properties and method</li>
</ul>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>constructor</td>
<td>function that was used to create the object</td>
</tr>
<tr>
<td>hasOwnProperty(propertyName)</td>
<td>Indicates if the given property exists on the object instance (not on the prototype)</td>
</tr>
<tr>
<td>isPrototypeOf(object)</td>
<td>Determines if the object is a prototype of another object</td>
</tr>
<tr>
<td>propertyIsEnumerable(propertyName)</td>
<td>using the for-in statemen</td>
</tr>
<tr>
<td>toLocaleString()</td>
<td></td>
</tr>
<tr>
<td>toString()</td>
<td></td>
</tr>
<tr>
<td>valueOf()</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="3-5-Operators"><a href="#3-5-Operators" class="headerlink" title="3.5 Operators"></a>3.5 Operators</h2><ul>
<li>Identically Equal and Not Identically Equal<ul>
<li><code>55 == &quot;55&quot; //true</code></li>
<li><code>55 === &quot;55&quot; //false</code></li>
</ul>
</li>
</ul>
<h2 id="3-6-Statement"><a href="#3-6-Statement" class="headerlink" title="3.6 Statement"></a>3.6 Statement</h2><ul>
<li>Labeled Statement<ul>
<li><code>label: statement</code></li>
<li>used with <code>continue</code> and <code>break</code></li>
</ul>
</li>
<li><p>The With Statement</p>
<ul>
<li><p>The with statement sets the scope of the code within a particular object</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> qs = location.search.substring(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">var</span> hostName = location.hostname;</span><br><span class="line"><span class="keyword">var</span> url = location.href;</span><br><span class="line"><span class="comment">// the same as</span></span><br><span class="line"><span class="keyword">with</span>(location)&#123;</span><br><span class="line">    <span class="keyword">var</span> qs = search.substring(<span class="number">1</span>); <span class="keyword">var</span> hostName = hostname;</span><br><span class="line">    <span class="keyword">var</span> url = href;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>* DO NOT USE WITH: 

&gt; Chapter 24.2: With statement creates its own scope and therefore increases the length of the scope chain for code executed within it 
</code></pre><h2 id="3-7-Functions"><a href="#3-7-Functions" class="headerlink" title="3.7 Functions"></a>3.7 Functions</h2><ul>
<li><p>Parameters are only for convenience:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayHi</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">typeof</span> b);</span><br><span class="line">    alert(<span class="keyword">typeof</span> a);</span><br><span class="line">&#125; </span><br><span class="line">sayHi(<span class="number">123</span>);    <span class="comment">// it works</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>arguments</code> in function</p>
<ul>
<li><code>arguments.length</code></li>
<li><code>arguments[0]</code> but arguments is not an Array instance</li>
</ul>
</li>
<li><strong>No Overloading</strong></li>
</ul>
<h1 id="Chapter4-Variables-Scope-and-Memory"><a href="#Chapter4-Variables-Scope-and-Memory" class="headerlink" title="Chapter4 Variables, Scope, and Memory"></a>Chapter4 Variables, Scope, and Memory</h1><h2 id="4-1-Primitive-And-Reference-Values"><a href="#4-1-Primitive-And-Reference-Values" class="headerlink" title="4.1 Primitive And Reference Values"></a>4.1 Primitive And Reference Values</h2><ul>
<li>Similar as Python:<ul>
<li>primitive type <strong>copy value</strong>: stored in <strong>stack</strong></li>
<li>reference type <strong>copy reference</strong> (pointer): stored in <strong>heap</strong></li>
</ul>
</li>
<li><p><code>instanceof</code>: if the variable is an instance of the given reference type</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert(person <span class="keyword">instanceof</span> <span class="built_in">Object</span>);</span><br><span class="line">alert(colors <span class="keyword">instanceof</span> <span class="built_in">Array</span>);</span><br><span class="line">alert(pattern <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="4-2-Execution-Context-And-Scope"><a href="#4-2-Execution-Context-And-Scope" class="headerlink" title="4.2 Execution Context And Scope"></a>4.2 Execution Context And Scope</h2><ul>
<li>Each execution context has an associated variable object upon which all of its defined variables and functions exist</li>
<li>There are only <strong>two</strong> primary types of execution contexts <ul>
<li>global</li>
<li>function (local) </li>
</ul>
</li>
</ul>
<h3 id="4-2-1-Scope-Chain-Augmentation"><a href="#4-2-1-Scope-Chain-Augmentation" class="headerlink" title="4.2.1 Scope Chain Augmentation"></a>4.2.1 Scope Chain Augmentation</h3><ul>
<li>There are two way to augment the scope chain<ul>
<li>try-catch</li>
<li>with</li>
</ul>
</li>
</ul>
<h3 id="4-2-2-No-Block-Level-Scopes"><a href="#4-2-2-No-Block-Level-Scopes" class="headerlink" title="4.2.2 No Block-Level Scopes"></a>4.2.2 No Block-Level Scopes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line">alert(i); <span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<h2 id="4-3-Garbage-Collection"><a href="#4-3-Garbage-Collection" class="headerlink" title="4.3 Garbage Collection"></a>4.3 Garbage Collection</h2><ul>
<li>Two ways:<ul>
<li>mark-and-sweep</li>
<li>reference counting</li>
</ul>
</li>
</ul>
<h3 id="4-3-1-mark-and-sweep"><a href="#4-3-1-mark-and-sweep" class="headerlink" title="4.3.1 mark-and-sweep:"></a>4.3.1 mark-and-sweep:</h3><ul>
<li>Delete variable that cannot be fetched</li>
</ul>
<h3 id="4-3-2-reference-counting"><a href="#4-3-2-reference-counting" class="headerlink" title="4.3.2 reference counting"></a>4.3.2 reference counting</h3><ul>
<li>Delete variable that reference count == 0</li>
<li><p>Issue: circular reference</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">"some_element"</span>); </span><br><span class="line"><span class="keyword">var</span> myObject = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">myObject.element = element;</span><br><span class="line">element.someObject = myObject;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="4-3-3-Performance"><a href="#4-3-3-Performance" class="headerlink" title="4.3.3 Performance"></a>4.3.3 Performance</h3><h3 id="4-3-4-Managing-Memory"><a href="#4-3-4-Managing-Memory" class="headerlink" title="4.3.4 Managing Memory"></a>4.3.4 Managing Memory</h3><p><strong>Dereference</strong></p>
<p>The point of dereferencing is to make sure the value is out of context and will be reclaimed the next time garbage collection occurs. e.g.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = createPerson(<span class="string">"name"</span>);</span><br><span class="line">p = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h1 id="Chapter5-Reference-Types"><a href="#Chapter5-Reference-Types" class="headerlink" title="Chapter5 Reference Types"></a>Chapter5 Reference Types</h1><h2 id="5-1-The-Object-Type"><a href="#5-1-The-Object-Type" class="headerlink" title="5.1 The Object Type"></a>5.1 The Object Type</h2><ul>
<li><p>Two ways to explicitly create an instance of Object:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>();          <span class="comment">// constructor</span></span><br><span class="line">person.age = <span class="number">10</span>;</span><br><span class="line">person.name = <span class="string">"aaa"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = &#123;<span class="attr">age</span>:<span class="number">10</span>, <span class="attr">name</span>:<span class="string">"aaa"</span>&#125;;  <span class="comment">// object literal notation</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Two ways to access attribute<ul>
<li><code>person.name</code>: preferred</li>
<li><code>person[&quot;name&quot;]</code>: used in case like <code>person[&quot;last name&quot;]</code></li>
</ul>
</li>
</ul>
<h2 id="5-2-The-Array-Type"><a href="#5-2-The-Array-Type" class="headerlink" title="5.2 The Array Type"></a>5.2 The Array Type</h2><ul>
<li><p>Two ways to explicitly create an instance of Array:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> <span class="built_in">Array</span>();   <span class="comment">// constructor</span></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">20</span>); <span class="comment">// length</span></span><br><span class="line"><span class="keyword">var</span> colors = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>, <span class="string">"aaa"</span>, obj);  <span class="comment">// can store any types</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> colors = [];        <span class="comment">// array literal notation</span></span><br><span class="line"><span class="keyword">var</span> colors = [<span class="number">1</span>, <span class="number">3</span>];</span><br></pre></td></tr></table></figure>
</li>
<li><p>access, update</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> colors = [<span class="number">1</span>, <span class="number">3</span>];</span><br><span class="line">colors[<span class="number">4</span>] = <span class="string">"aaa"</span>;  <span class="comment">// [1, 3, , , "aaa"]</span></span><br><span class="line">colors[<span class="number">3</span>];          <span class="comment">// undefined</span></span><br><span class="line">colors.length = <span class="number">2</span>;  <span class="comment">// [1, 3]</span></span><br><span class="line">colors.length = <span class="number">6</span>;  <span class="comment">// [1, 3, , , ,]</span></span><br><span class="line">colors[<span class="number">3</span>];          <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-2-1-Detecting-Arrays"><a href="#5-2-1-Detecting-Arrays" class="headerlink" title="5.2.1 Detecting Arrays"></a>5.2.1 Detecting Arrays</h3><ul>
<li>Reason:<ul>
<li>The one problem with <code>instanceof</code> assumes a single global execution context</li>
<li>If an array was passed from one frame into another frame, that array has a different constructor function.</li>
<li>So <code>instanceof</code> fail.</li>
</ul>
</li>
<li>Solution<ul>
<li><code>if (Array.isArray(colors))</code></li>
</ul>
</li>
</ul>
<h3 id="5-2-2-Conversion-Methods"><a href="#5-2-2-Conversion-Methods" class="headerlink" title="5.2.2 Conversion Methods"></a>5.2.2 Conversion Methods</h3><ul>
<li>toLocalString()</li>
<li>toString()</li>
<li>valueOf()</li>
</ul>
<h3 id="5-2-3-5-2-7"><a href="#5-2-3-5-2-7" class="headerlink" title="5.2.3-5.2.7"></a>5.2.3-5.2.7</h3><p><code>var nums = [0, 1, 2]</code></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stack</td>
<td>push(1, 2)</td>
<td>[0, 1, 2, 1, 2]</td>
</tr>
<tr>
<td>Stack</td>
<td>pop()</td>
<td>[0, 1]</td>
</tr>
<tr>
<td>Queue</td>
<td>shift()</td>
<td>[1, 2]</td>
</tr>
<tr>
<td>Queue</td>
<td>unshift(1, 2)</td>
<td>[1, 2, 0, 1, 2]</td>
</tr>
<tr>
<td>Reordering</td>
<td>reverse()</td>
<td>[2, 1, 0]</td>
</tr>
<tr>
<td>Reordering</td>
<td>sort(func)</td>
<td>a function for comparation</td>
</tr>
<tr>
<td>Manipulation</td>
<td>concat(3, [4, 5])</td>
<td>[0, 1, 2, 3, 4, 5]</td>
</tr>
<tr>
<td>Manipulation</td>
<td>slice()</td>
<td>slice(1): from index 1 to last <br> slice(1, 2): from index 1 to index 2 (excluded)</td>
</tr>
<tr>
<td>Matipulation</td>
<td>splice()</td>
<td><strong>deletion</strong>: splice(0, 3) // delte from index 0 for 3 element<br><strong>insertion</strong>: splice(2, 0, “123”) // insert “123” into index 2, delete 0 element<br><strong>replacement</strong>: splice(2, 1, “123”) // insert “123” into index 2, delete 1 element</td>
</tr>
<tr>
<td>Location</td>
<td>indexOf()</td>
<td>search from first element</td>
</tr>
<tr>
<td>Location</td>
<td>lastIndexOf()</td>
<td>search from last element</td>
</tr>
<tr>
<td>Iterative</td>
<td>every()</td>
<td><code>colors.every(function(item, index, array) {return item &gt; 2;});</code></td>
</tr>
<tr>
<td>Iterative</td>
<td>some()</td>
<td>similar as every()</td>
</tr>
<tr>
<td>Iterative</td>
<td>filter()</td>
<td><code>colors.filter(function(item, index, array) {return item &gt; 2;});</code></td>
</tr>
<tr>
<td>Iterative</td>
<td>forEach()</td>
<td><code>colors.map(function(item, index, array) {...});</code></td>
</tr>
<tr>
<td>Iterative</td>
<td>map()</td>
<td><code>colors.map(function(item, index, array) {return item * 2;});</code></td>
</tr>
<tr>
<td>Reduction</td>
<td>reduce()</td>
<td>like <code>foldl</code> in Go. From first item</td>
</tr>
<tr>
<td>Reduction</td>
<td>reduceRight()</td>
<td>like <code>foldr</code> in Go. From last item</td>
</tr>
</tbody>
</table>
<h2 id="5-3-THE-DATE-TYPE"><a href="#5-3-THE-DATE-TYPE" class="headerlink" title="5.3 THE DATE TYPE"></a>5.3 THE DATE TYPE</h2><p>Hard to say</p>
<h2 id="5-4-THE-REGEXP-TYPE"><a href="#5-4-THE-REGEXP-TYPE" class="headerlink" title="5.4 THE REGEXP TYPE"></a>5.4 THE REGEXP TYPE</h2><p>flags:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>g</td>
<td>global</td>
</tr>
<tr>
<td>i</td>
<td>case insensitive</td>
</tr>
<tr>
<td>m</td>
<td>multiline</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="regexp">/[bc]at/i</span>;     <span class="comment">// var expression = /pattern/ flags</span></span><br><span class="line"><span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"[bc]at"</span>, <span class="string">"i"</span>); <span class="comment">// var expression = new RegExp(patternString, flags);</span></span><br></pre></td></tr></table></figure>
<h3 id="5-4-1-RegExp-Instance-Properties"><a href="#5-4-1-RegExp-Instance-Properties" class="headerlink" title="5.4.1 RegExp Instance Properties"></a>5.4.1 RegExp Instance Properties</h3><table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>global</td>
<td>if g</td>
</tr>
<tr>
<td>ignoreCase</td>
<td>if i</td>
</tr>
<tr>
<td>multiline</td>
<td>if m</td>
</tr>
<tr>
<td>lastIndex</td>
<td>start position of next search</td>
</tr>
<tr>
<td>source</td>
<td>pattern information</td>
</tr>
</tbody>
</table>
<h3 id="5-4-2-RegExp-Instance-Methods"><a href="#5-4-2-RegExp-Instance-Methods" class="headerlink" title="5.4.2 RegExp Instance Methods"></a>5.4.2 RegExp Instance Methods</h3><ul>
<li><p>exec()</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="string">"..."</span>;</span><br><span class="line"><span class="keyword">var</span> pattern = <span class="regexp">/xxx/</span>;</span><br><span class="line"><span class="keyword">var</span> matches = pattern.exec(text);</span><br><span class="line">alert(matches.index);</span><br><span class="line">alert(matches.input);</span><br><span class="line">alert(matches[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>test():<br>  <code>pattern.test(text) // return boolean</code></li>
</ul>
<h3 id="5-4-3-RegExp-Constructor-Properties"><a href="#5-4-3-RegExp-Constructor-Properties" class="headerlink" title="5.4.3 RegExp Constructor Properties"></a>5.4.3 RegExp Constructor Properties</h3><table>
<thead>
<tr>
<th>VERBOSE NAME</th>
<th>SHORT NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>input</td>
<td>$_</td>
</tr>
<tr>
<td>lastMatch</td>
<td>$&amp;</td>
</tr>
<tr>
<td>lastParen</td>
<td>$+</td>
</tr>
<tr>
<td>leftContext</td>
<td>$`</td>
</tr>
<tr>
<td>multiline</td>
<td>$*</td>
</tr>
<tr>
<td>rightContext</td>
<td>$’</td>
</tr>
</tbody>
</table>
<p>usage:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pattern.test(text)) &#123;</span><br><span class="line">    alert(<span class="built_in">RegExp</span>.input);</span><br><span class="line">    alert(<span class="built_in">RegExp</span>.$_);</span><br><span class="line">    alert(<span class="built_in">RegExp</span>[<span class="string">"$'"</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-4-4-Pattern-Limitations"><a href="#5-4-4-Pattern-Limitations" class="headerlink" title="5.4.4 Pattern Limitations"></a>5.4.4 Pattern Limitations</h3><h2 id="5-5-The-Function-Type"><a href="#5-5-The-Function-Type" class="headerlink" title="5.5 The Function Type"></a>5.5 The Function Type</h2><ul>
<li>Each function is an instance of the <strong>Function</strong> type</li>
<li>Functions are actually Object<ul>
<li><code>func instanceof Object // true</code></li>
</ul>
</li>
<li>Function names are actually reference</li>
</ul>
<p><strong>Three</strong> ways to creat a function:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function declaration</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">num1, num2</span>) </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function expression</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>) </span>&#123;...&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"num1"</span>, <span class="string">"num2"</span>, <span class="string">"return num1 + num2"</span>); <span class="comment">// not recommended</span></span><br></pre></td></tr></table></figure>
<h3 id="5-5-1-No-Overloading"><a href="#5-5-1-No-Overloading" class="headerlink" title="5.5.1 No Overloading"></a>5.5.1 No Overloading</h3><p>Because function name is reference</p>
<h3 id="5-5-2-Function-Declarations-versus-Function-Expressions"><a href="#5-5-2-Function-Declarations-versus-Function-Expressions" class="headerlink" title="5.5.2 Function Declarations versus Function Expressions"></a>5.5.2 Function Declarations versus Function Expressions</h3><ul>
<li><strong>Function declarations</strong> are read and available in an execution context before any code is executed</li>
<li><p><strong>Function expressions</strong> aren’t complete until the execution reaches that line of code. </p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// works</span></span><br><span class="line">alert(sum(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error</span></span><br><span class="line">alert(sum(<span class="number">10</span>, <span class="number">10</span>));</span><br><span class="line"><span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-5-3-Functions-as-Values"><a href="#5-5-3-Functions-as-Values" class="headerlink" title="5.5.3 Functions as Values"></a>5.5.3 Functions as Values</h3><ul>
<li>function can be parsed as argument and return </li>
</ul>
<h3 id="5-5-4-Function-Internals"><a href="#5-5-4-Function-Internals" class="headerlink" title="5.5.4 Function Internals"></a>5.5.4 Function Internals</h3><ul>
<li>arguments<ul>
<li><code>arguments.callee</code>: the function, can be used for recursion</li>
</ul>
</li>
<li><p>this</p>
<ul>
<li><p>It is a reference to the context object that the function is operating on.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.color = <span class="string">"red"</span>;</span><br><span class="line"><span class="keyword">var</span> o = &#123; <span class="attr">color</span>: <span class="string">"blue"</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayColor</span>(<span class="params"></span>)</span>&#123; alert(<span class="keyword">this</span>.color);&#125;</span><br><span class="line"></span><br><span class="line">sayColor(); <span class="comment">//"red"</span></span><br><span class="line">o.sayColor = sayColor; </span><br><span class="line">o.sayColor(); <span class="comment">//"blue"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><a href="https://stackoverflow.com/questions/3127429/how-does-the-this-keyword-work" target="_blank" rel="noopener">Original Discussion</a></p>
<blockquote>
<p>The interpreter updates the ThisBinding whenever establishing an execution context in one of only three different cases:</p>
</blockquote>
<blockquote>
<ol>
<li>Initial global execution context</li>
<li>Entering eval code</li>
<li>Entering function code<ul>
<li>In most other cases, ThisBinding is set to the global object</li>
<li>If a function is <strong>called on an object</strong>, such as in <code>obj.myMethod()</code> or the equivalent <code>obj[&quot;myMethod&quot;]()</code>, then ThisBinding is set to the object. <ul>
<li>Opposite: <code>var a = obj.myMethod; a();</code> this bind to window</li>
</ul>
</li>
<li>These special functions take a so-called thisArg which becomes the ThisBinding when calling the function<ul>
<li>Function.prototype.apply( thisArg, argArray )</li>
<li>Function.prototype.call( thisArg [ , arg1 [ , arg2, … ] ] )</li>
<li>Function.prototype.bind( thisArg [ , arg1 [ , arg2, … ] ] )</li>
<li>Array.prototype.every( callbackfn [ , thisArg ] )</li>
<li>Array.prototype.some( callbackfn [ , thisArg ] )</li>
<li>Array.prototype.forEach( callbackfn [ , thisArg ] )</li>
<li>Array.prototype.map( callbackfn [ , thisArg ] )</li>
<li>Array.prototype.filter( callbackfn [ , thisArg ] )</li>
</ul>
</li>
</ul>
</li>
<li>new operation</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.someData = <span class="string">"a string"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> MyType();</span><br><span class="line">    </span><br><span class="line"><span class="comment">// similar as:</span></span><br><span class="line"><span class="keyword">var</span> instance = &#123;&#125;;</span><br><span class="line">MyType.call(instance);</span><br></pre></td></tr></table></figure>
<ul>
<li>caller<ul>
<li>A reference to the function that called this function or null if the function was called from the global scope.</li>
</ul>
</li>
</ul>
<h3 id="5-5-5-Function-Properties-and-Methods"><a href="#5-5-5-Function-Properties-and-Methods" class="headerlink" title="5.5.5 Function Properties and Methods"></a>5.5.5 Function Properties and Methods</h3><p><strong>Two properties</strong></p>
<ul>
<li>length: number of arguments expected</li>
<li>prototype<ul>
<li>actual location of all instance methods for reference types</li>
<li>methods such as toString(), valueOf() exist on prototype</li>
</ul>
</li>
</ul>
<p><strong>Two methods</strong></p>
<ul>
<li><p>func.apply(context, arguments):</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;<span class="keyword">return</span> num1 + num2;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callSum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// so this refer to global. The same as call sum(arguments) in global</span></span><br><span class="line">    <span class="keyword">return</span> sum.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">alert(callSum(<span class="number">10</span>, <span class="number">10</span>));     <span class="comment">// this function is invoked in global</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>func.call(context, arg1, arg2, …)<ul>
<li>Similar as apply()</li>
<li>Only difference is argument should be parsed one by one</li>
<li>Usage: <code>sum.call(this, num1, num2);</code></li>
</ul>
</li>
<li><p>Their ability to <strong>augment context</strong> inside of the function</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sayColor.call(<span class="keyword">this</span>);</span><br><span class="line">sayColor.call(<span class="built_in">window</span>);</span><br><span class="line">sayColor.call(obj);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>bind(context)</p>
<ul>
<li>It returns a function instance</li>
<li><p>bind <code>this</code> to function    </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;<span class="string">"color"</span>: <span class="string">"blue"</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayColor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> objSayColor = sayColor.bind(o);</span><br><span class="line">objSayColor();  <span class="comment">// blue</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="5-6-Primitive-Wrapper-Types"><a href="#5-6-Primitive-Wrapper-Types" class="headerlink" title="5.6 Primitive Wrapper Types"></a>5.6 Primitive Wrapper Types</h2><p><strong>Three special reference types: </strong></p>
<ul>
<li>The Boolean type: <code>var b = new Boolean(false)</code></li>
<li>The Number type: <code>var n = new Number(10)</code></li>
<li>The String type: <code>var s = new String(&quot;abbb&quot;)</code></li>
</ul>
<p><strong>Reason:</strong></p>
<ul>
<li><code>&quot;aaaaa&quot;.substring(2)</code> is valid</li>
<li>“aaaaa” is <strong>primitive type</strong>, shoule not have method. These steps happened:<ol>
<li>Create an instance of the String type.</li>
<li>Call the specified method on the instance.</li>
<li>Destroy the instance.</li>
</ol>
</li>
</ul>
<h3 id="5-6-1-The-Boolean-Type"><a href="#5-6-1-The-Boolean-Type" class="headerlink" title="5.6.1 The Boolean Type"></a>5.6.1 The Boolean Type</h3><p>DO NOT USE IT.<br>Unexpted behaviour when doing logic operation</p>
<h3 id="5-6-2-The-Number-Type"><a href="#5-6-2-The-Number-Type" class="headerlink" title="5.6.2 The Number Type"></a>5.6.2 The Number Type</h3><table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>valueOf()</td>
<td></td>
</tr>
<tr>
<td>toLocaleString()</td>
<td></td>
</tr>
<tr>
<td>toString()</td>
<td></td>
</tr>
<tr>
<td>toFixed()</td>
<td><code>10.005.toFixed(2) // 10.01</code></td>
</tr>
<tr>
<td>toExponential()</td>
<td><code>10.toExponential(1) // 1.0e+1</code></td>
</tr>
<tr>
<td>toPrecision()</td>
<td>fixed or exponential</td>
</tr>
</tbody>
</table>
<h3 id="5-6-3-The-String-Type"><a href="#5-6-3-The-String-Type" class="headerlink" title="5.6.3 The String Type"></a>5.6.3 The String Type</h3><table>
<thead>
<tr>
<th>Type</th>
<th>Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Character Methods</td>
<td>charAt()<br>charCodeAt()<br>“xxx”[0]</td>
</tr>
<tr>
<td>String-Manipulation Methods</td>
<td>concat()<br>slice()<br>substring()<br>substr()</td>
</tr>
<tr>
<td>String Location Methods</td>
<td>indexOf()<br>lastIndexOf()</td>
</tr>
<tr>
<td>The trim() Method</td>
<td>trim()</td>
</tr>
<tr>
<td>String Case Methods</td>
<td>toLowerCase()<br>toLocalLowerCase()<br>toUpperCase()<br>toLocalUpperCase()</td>
</tr>
<tr>
<td>String Pattern-Matching Methods</td>
<td>5.4 RE<br>match()<br>replace()<br>htmlEscape()<br>split()</td>
</tr>
<tr>
<td>The localeCompare() Method</td>
<td></td>
</tr>
<tr>
<td>The fromCharCode() Method</td>
<td></td>
</tr>
<tr>
<td>HTML Methods</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="5-7-Singleton-Built-In-Objects"><a href="#5-7-Singleton-Built-In-Objects" class="headerlink" title="5.7 Singleton Built-In Objects"></a>5.7 Singleton Built-In Objects</h2><h3 id="5-7-1-The-Global-Object"><a href="#5-7-1-The-Global-Object" class="headerlink" title="5.7.1 The Global Object"></a>5.7.1 The Global Object</h3><ul>
<li>All variables and functions defined globally become properties of the Global object</li>
<li>All variables and functions are Global methods. e.g. parseInt(), isNaN()</li>
</ul>
<ol>
<li><p>URI-Encoding Methods</p>
<ul>
<li>encodeURI()/decodeURI()</li>
<li>encodeURIComponent()/decodeURIComponent()</li>
</ul>
</li>
<li><p>The eval() Method</p>
<ul>
<li>It interprets the argument into actual ECMAScript statements and then inserts it into place</li>
<li><p>Has the same scope chain</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span>(<span class="string">"function sayHi() &#123;alert('hi');&#125;"</span>);</span><br><span class="line">sayHi()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="Global-Object-Properties"><a href="#Global-Object-Properties" class="headerlink" title="Global Object Properties"></a>Global Object Properties</h4><ul>
<li><p>Special Values:</p>
<ul>
<li>undefined</li>
<li>NaN</li>
<li>Infinity</li>
</ul>
</li>
<li><p>Constructors:</p>
<ul>
<li>Object, Array, Function, Boolean, String, Number, Date, RegExp, Error, EvalError, RangeError, ReferenceError, SyntaxError, TypeError, URIError</li>
</ul>
</li>
</ul>
<h4 id="The-Window-Object"><a href="#The-Window-Object" class="headerlink" title="The Window Object"></a>The Window Object</h4><ul>
<li>Though ECMAScript doesn’t indicate a way to access the Global object</li>
<li>Web browsers implement it such that the <code>window</code> is the Global object’s delegate</li>
<li><p>The <code>window</code> object does <code>much more</code> in JavaScript than just implement the ECMAScript Global object</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> color = <span class="string">"red"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayColor</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    alert(<span class="built_in">window</span>.color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.sayColor(); <span class="comment">//"red"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="5-7-2-The-Math-Object"><a href="#5-7-2-The-Math-Object" class="headerlink" title="5.7.2 The Math Object"></a>5.7.2 The Math Object</h3><h4 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h4><ul>
<li>Math.E, Math.LN10, Math.LN2, Math.LOG2E, Math.LOG10E, Math.PI, Math.SQRT1_2, Math.SQRT2</li>
</ul>
<h4 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h4><ul>
<li>min(), max()</li>
<li>ceil(), floor(), round() </li>
<li>random()</li>
<li>abs(), exp(), log(), pow(), sqrt(), acos(), asin(), atan(), atan2(), cos(), sin(), tan()</li>
</ul>
<h1 id="Chapter6-Object-Oriented-Programming"><a href="#Chapter6-Object-Oriented-Programming" class="headerlink" title="Chapter6 Object-Oriented Programming"></a>Chapter6 Object-Oriented Programming</h1><h2 id="6-1-Understanding-Objects"><a href="#6-1-Understanding-Objects" class="headerlink" title="6.1 Understanding Objects"></a>6.1 Understanding Objects</h2><h3 id="6-1-1-Types-of-Properties"><a href="#6-1-1-Types-of-Properties" class="headerlink" title="6.1.1 Types of Properties"></a>6.1.1 Types of Properties</h3><ul>
<li>Data Property: <ul>
<li>Each data property has 4 attributes</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[[Configurable]]</td>
<td>if can be <code>delete person.name</code>, false: cannot change any attributes </td>
</tr>
<tr>
<td>[[Enumerable]]</td>
<td>if the property can be for-in loop</td>
</tr>
<tr>
<td>[[Writable]]</td>
<td>if value can be changed</td>
</tr>
<tr>
<td>[[Value]]</td>
<td>the value</td>
</tr>
</tbody>
</table>
<ul>
<li>Accessor Properties<ul>
<li>It defines <code>getter</code> and <code>setter</code></li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[[Configurable]]</td>
<td>same</td>
</tr>
<tr>
<td>[[Enumerable]]</td>
<td>same</td>
</tr>
<tr>
<td>[[Get]]</td>
<td>getter</td>
</tr>
<tr>
<td>[[Set]]</td>
<td>setter</td>
</tr>
</tbody>
</table>
<h3 id="6-1-2-Defining-Multiple-Properties"><a href="#6-1-2-Defining-Multiple-Properties" class="headerlink" title="6.1.2 Defining Multiple Properties"></a>6.1.2 Defining Multiple Properties</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(person, </span><br><span class="line">    name: &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._name + <span class="string">"d"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>._name = newValue + <span class="string">"dd"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    age: &#123;</span><br><span class="line">        writable: <span class="literal">false</span>,</span><br><span class="line">        value: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="6-1-3-Reading-Property-Attributes"><a href="#6-1-3-Reading-Property-Attributes" class="headerlink" title="6.1.3 Reading Property Attributes"></a>6.1.3 Reading Property Attributes</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(person, <span class="string">"name"</span>);</span><br><span class="line">alert(description.value);</span><br></pre></td></tr></table></figure>
<h2 id="6-2-Object-Creation"><a href="#6-2-Object-Creation" class="headerlink" title="6.2 Object Creation"></a>6.2 Object Creation</h2><h3 id="6-2-1-The-Factory-Pattern"><a href="#6-2-1-The-Factory-Pattern" class="headerlink" title="6.2.1 The Factory Pattern"></a>6.2.1 The Factory Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, age</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.name = name;</span><br><span class="line">    o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;alert(<span class="keyword">this</span>.name); &#125;;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Disadvantage:<ul>
<li>Cannot know instance type</li>
<li>Different people has different <code>sayName</code> function</li>
</ul>
</li>
</ul>
<h3 id="6-2-2-The-Constructor-Pattern"><a href="#6-2-2-The-Constructor-Pattern" class="headerlink" title="6.2.2 The Constructor Pattern"></a>6.2.2 The Constructor Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;alert(<span class="keyword">this</span>.name); &#125;;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Advantages:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">"N"</span>, <span class="number">11</span>);</span><br><span class="line">person1.constructor == Person <span class="comment">// true</span></span><br><span class="line">person1 instanceOf Person <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Disadvantages:<ul>
<li>Different people has different <code>sayName</code> function</li>
<li>Make <code>sayName</code> global then <code>this.sayName = sayName</code> is not a solution since the method should be private</li>
<li>User is able to call <code>Person(xx, xx)</code> without <code>new</code>, then it sets global attribute </li>
</ul>
</li>
</ul>
<h3 id="6-2-3-The-Prototype-Pattern"><a href="#6-2-3-The-Prototype-Pattern" class="headerlink" title="6.2.3 The Prototype Pattern"></a>6.2.3 The Prototype Pattern</h3><p><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/prototype.png" alt="Prototype"></p>
<ul>
<li><p>By scope chain: </p>
<ul>
<li><code>person1.name</code> first search <code>person1</code> attribute then its Prototype</li>
<li><code>person1.sayName()</code> first search <code>person1</code> then its Prototype</li>
</ul>
</li>
<li><p>Advantages:</p>
<ul>
<li><code>person1.name == &quot;NG&quot;</code> covers the Prototype one</li>
<li><code>delte person1.name</code> can recover it</li>
<li>all person instances share the same sayName function</li>
</ul>
</li>
<li><p>Disadvantages:</p>
<ul>
<li>different people should have different attributes</li>
<li>If the name is an Object, it is mutable and change the name of all persons</li>
</ul>
</li>
<li><p>Syntax</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: Person,</span><br><span class="line">    name : "Nicholas",</span><br><span class="line">    age : 29,</span><br><span class="line">    sayName : function () &#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Some methods</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getPrototypeOf(person1) == Person.prototype   <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(person1).name         <span class="comment">// "Nicholas"</span></span><br><span class="line">person1.hasOwnProperty(<span class="string">"name"</span>)              <span class="comment">// false: if returned attribute got from instance</span></span><br><span class="line">person1.hasOwnPrototypeProperty(<span class="string">"name"</span>)     <span class="comment">// true: if returned attribute got from prototype</span></span><br><span class="line"><span class="string">"name"</span> <span class="keyword">in</span> person1                           <span class="comment">// true: if has "name" no matter in instance or prototype</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="built_in">Object</span>.keys()                   <span class="comment">// all instance enumerated attributes</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyNames()    <span class="comment">// all instance attributes even not enumerated</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="6-2-4-Combination-Constructor-Prototype-Pattern"><a href="#6-2-4-Combination-Constructor-Prototype-Pattern" class="headerlink" title="6.2.4 Combination Constructor/Prototype Pattern"></a>6.2.4 Combination Constructor/Prototype Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: Person,</span><br><span class="line">    sayName : function () &#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>Disadvantage: <ul>
<li>Confused because having two code blocks for a class</li>
</ul>
</li>
</ul>
<h3 id="6-2-5-Dynamic-Prototype-Pattern"><a href="#6-2-5-Dynamic-Prototype-Pattern" class="headerlink" title="6.2.5 Dynamic Prototype Pattern"></a>6.2.5 Dynamic Prototype Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.sayName != <span class="string">"function"</span>) &#123;</span><br><span class="line">        Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="keyword">this</span>.name;)</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-2-6-Parasitic-Constructor-Pattern"><a href="#6-2-6-Parasitic-Constructor-Pattern" class="headerlink" title="6.2.6 Parasitic Constructor Pattern"></a>6.2.6 Parasitic Constructor Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.name = name;</span><br><span class="line">    o.age = age;</span><br><span class="line">    o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name); &#125;;</span><br><span class="line">    <span class="keyword">return</span> o; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> friend = <span class="keyword">new</span> Person(<span class="string">"Nicholas"</span>, <span class="number">29</span>); </span><br><span class="line">friend.sayName(); <span class="comment">//"Nicholas"</span></span><br></pre></td></tr></table></figure>
<p>Does not make sense!!! Cannot see any advantages over 6.2.5</p>
<h3 id="6-2-7-Durable-Constructor-Pattern"><a href="#6-2-7-Durable-Constructor-Pattern" class="headerlink" title="6.2.7 Durable Constructor Pattern"></a>6.2.7 Durable Constructor Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">    o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(name); </span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> o; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Does not make sense!!! Cannot see any advantages over 6.2.5</p>
<h2 id="6-3-Inheritance"><a href="#6-3-Inheritance" class="headerlink" title="6.3 Inheritance"></a>6.3 Inheritance</h2><h3 id="6-3-1-Prototype-Chaining-hardly-use"><a href="#6-3-1-Prototype-Chaining-hardly-use" class="headerlink" title="6.3.1 Prototype Chaining (hardly use)"></a>6.3.1 Prototype Chaining (hardly use)</h3><p><strong>The basic idea</strong> is to use the concept of prototypes to inherit properties and methods between two reference types</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.property = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.property;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.subproperty = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//inherit from SuperType </span></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line"></span><br><span class="line"><span class="comment">// new method</span></span><br><span class="line">SubType.prototype.getSubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.subproperty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//override existing method. should below new SuperType() !!</span></span><br><span class="line">SubType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType(); </span><br><span class="line">alert(instance.getSuperValue()); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/inheritance.png" alt="Inheritance"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alert(instance <span class="keyword">instanceof</span> <span class="built_in">Object</span>);      <span class="comment">// true</span></span><br><span class="line">alert(instance <span class="keyword">instanceof</span> SuperType);   <span class="comment">// true</span></span><br><span class="line">alert(instance <span class="keyword">instanceof</span> SubType);     <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">alert(<span class="built_in">Object</span>.prototype.isPrototypeOf(instance));    <span class="comment">//true</span></span><br><span class="line">alert(SuperType.prototype.isPrototypeOf(instance)); <span class="comment">//true</span></span><br><span class="line">alert(SubType.prototype.isPrototypeOf(instance));   <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>Issues:</p>
<ol>
<li><p>When prototypes contain reference values</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"r"</span>, <span class="string">"g"</span>, <span class="string">"b"</span>]</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">instance1.colors.push(<span class="string">"w"</span>);</span><br><span class="line">alert(instance2.colors);        <span class="comment">// r, g, b, w</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>cannot pass arguments into the supertype </p>
</li>
</ol>
</li>
</ul>
<h3 id="6-3-2-Constructor-Stealing"><a href="#6-3-2-Constructor-Stealing" class="headerlink" title="6.3.2 Constructor Stealing"></a>6.3.2 Constructor Stealing</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//inherit from SuperType passing in an argument </span></span><br><span class="line">    SuperType.call(<span class="keyword">this</span>, <span class="string">"Nicholas"</span>);   <span class="comment">// SuperType.call("Nicholas") will bind name to window</span></span><br><span class="line">    <span class="comment">//instance property</span></span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">29</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType(); </span><br><span class="line">alert(instance.name); <span class="comment">//"Nicholas"; </span></span><br><span class="line">alert(instance.age); <span class="comment">//29</span></span><br></pre></td></tr></table></figure>
<p>Because of 5.5.4, it cannot be SuperType.call(“Nicholas”)</p>
<ul>
<li><p>Advantages: It solves 6.3.1 issues.</p>
</li>
<li><p>Disadvantages: </p>
<ol>
<li>no function reuse. (instances have their own function)</li>
<li>methods defined on the supertype’s prototype are not accessible on the subtype</li>
</ol>
</li>
</ul>
<h3 id="6-3-3-Combination-Inheritance"><a href="#6-3-3-Combination-Inheritance" class="headerlink" title="6.3.3 Combination Inheritance"></a>6.3.3 Combination Inheritance</h3><p>(combined with 6.3.1 and 6.3.2)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//inherit properties </span></span><br><span class="line">    SuperType.call(<span class="keyword">this</span>, name);</span><br><span class="line">    <span class="keyword">this</span>.age = age; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//inherit methods</span></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    alert(<span class="keyword">this</span>.age);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Advantage: </p>
<ol>
<li>The most frequently used inheritance pattern in JavaScript.</li>
<li><code>instanceof</code>, <code>isPrototypeOf()</code> also work</li>
</ol>
</li>
<li><p>Disadvantage:</p>
<ol>
<li>call two times of SuperType()</li>
</ol>
</li>
</ul>
<h3 id="6-3-4-Prototypal-Inheritance"><a href="#6-3-4-Prototypal-Inheritance" class="headerlink" title="6.3.4 Prototypal Inheritance"></a>6.3.4 Prototypal Inheritance</h3><p><strong>Basic idea:</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">o</span>)</span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">    F.prototype = o;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ECMA5</strong>: formalized the concept of prototypal inheritance by <code>Object.create(parentInstance)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">"Nicholas"</span>,</span><br><span class="line">    friends: [<span class="string">"Shelby"</span>, <span class="string">"Court"</span>, <span class="string">"Van"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> anotherPerson = <span class="built_in">Object</span>.create(person);</span><br><span class="line">anotherPerson.name = <span class="string">"Greg"</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>Advantages: easy</li>
<li>Disadvantages: <ul>
<li>need a parent instance created</li>
<li>share mutable type attributes. i.e. friends list</li>
</ul>
</li>
</ul>
<h3 id="6-3-5-Parasitic-寄生式-Inheritance"><a href="#6-3-5-Parasitic-寄生式-Inheritance" class="headerlink" title="6.3.5 Parasitic(寄生式) Inheritance"></a>6.3.5 Parasitic(寄生式) Inheritance</h3><p>Similar as 6.3.4</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAnother</span>(<span class="params">original</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">var</span> clone = object(original); </span><br><span class="line">    clone.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">"hi"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Disadvantage: </p>
<pre><code>* the same as 6.3.4
* function reuse inefficiencies
</code></pre><h3 id="6-3-6-Parasitic-Combination-寄生组合式）Inheritance"><a href="#6-3-6-Parasitic-Combination-寄生组合式）Inheritance" class="headerlink" title="6.3.6 Parasitic Combination(寄生组合式）Inheritance"></a>6.3.6 Parasitic Combination(寄生组合式）Inheritance</h3><p>看不懂！！！！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, superType</span>)</span>&#123; </span><br><span class="line">    <span class="comment">// prototype这个实例的prototype是superType的prototype</span></span><br><span class="line">    <span class="keyword">var</span> prototype = object(superType.prototype);    <span class="comment">//create object</span></span><br><span class="line">    prototype.constructor = subType;                <span class="comment">//create object</span></span><br><span class="line">    subType.prototype = prototype;                  <span class="comment">//assign object</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>)</span>&#123; </span><br><span class="line">    SuperType.call(<span class="keyword">this</span>, name);</span><br><span class="line">    <span class="keyword">this</span>.age = age; </span><br><span class="line">&#125;</span><br><span class="line">inheritPrototype(SubType, SuperType);</span><br><span class="line"></span><br><span class="line">SubType.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    alert(<span class="keyword">this</span>.age);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Parasitic combination inheritance is considered the <strong>most efficient</strong> way to implement type-based inheritance.</p>
<h1 id="Chapter7-Function-Expressions"><a href="#Chapter7-Function-Expressions" class="headerlink" title="Chapter7 Function Expressions"></a>Chapter7 Function Expressions</h1><h2 id="7-1-Recursion"><a href="#7-1-Recursion" class="headerlink" title="7.1 Recursion"></a>7.1 Recursion</h2><ul>
<li>use arguments.callee</li>
<li><p>a special implementation</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> factorial = (<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (num &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> num * f(num<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-2-Closure"><a href="#7-2-Closure" class="headerlink" title="7.2 Closure"></a>7.2 Closure</h2><p>Closures are functions that have access to variables from another function’s scope. This is often accomplished by creating a function inside a function</p>
<h3 id="7-2-1-Closures-and-Variables"><a href="#7-2-1-Closures-and-Variables" class="headerlink" title="7.2.1 Closures and Variables"></a>7.2.1 Closures and Variables</h3><p>Should understand the difference between</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123; </span><br><span class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> i;               <span class="comment">// this i is a reference</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFunctions</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">        result[i] = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> num;</span><br><span class="line">           &#125;;</span><br><span class="line">        &#125;(i);                       <span class="comment">// this i is parsed(value copy) in</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-2-The-this-Object"><a href="#7-2-2-The-this-Object" class="headerlink" title="7.2.2 The this Object"></a>7.2.2 The this Object</h3><p>Should understand the difference between</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">    name : <span class="string">"My Object"</span>,</span><br><span class="line">    getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.name; </span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br><span class="line">alert(object.getNameFunc()()); <span class="comment">//"The Window" (in non-strict mode)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">    name : <span class="string">"My Object"</span>,</span><br><span class="line">    getNameFunc : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;            <span class="comment">// this is the obj, so we need a variable to refer</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> that.name;</span><br><span class="line">        &#125;;      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">alert(object.getNameFunc()()); <span class="comment">//"My Object"</span></span><br></pre></td></tr></table></figure>
<h3 id="7-2-3-Memory-Leaks"><a href="#7-2-3-Memory-Leaks" class="headerlink" title="7.2.3 Memory Leaks"></a>7.2.3 Memory Leaks</h3><p>Closure will store variables in memory and cannot be destroied.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assignHandler</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">"someElement"</span>); </span><br><span class="line">    element.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(element.id); </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Solution</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assignHandler</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">"someElement"</span>);</span><br><span class="line">    <span class="keyword">var</span> id = element.id;</span><br><span class="line">    element.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(id);</span><br><span class="line">    &#125;;</span><br><span class="line">    element = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-3-MIMICKING-BLOCK-SCOPE"><a href="#7-3-MIMICKING-BLOCK-SCOPE" class="headerlink" title="7.3 MIMICKING BLOCK SCOPE"></a>7.3 MIMICKING BLOCK SCOPE</h2><p>JavaScript has no concept of <strong>block-level scoping</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">2</span>; i++)&#123;</span><br><span class="line">    alert(i);</span><br><span class="line">&#125;</span><br><span class="line">alert(i);       <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>Solution</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> someFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="comment">//block code here</span></span><br><span class="line">&#125;; </span><br><span class="line">someFunction();</span><br></pre></td></tr></table></figure>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//block code here</span></span><br><span class="line">&#125;();    <span class="comment">//error! Because of Javascript declaration hoisting</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//block code here</span></span><br><span class="line">&#125;)();   <span class="comment">//fine</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="7-4-PRIVATE-VARIABLES"><a href="#7-4-PRIVATE-VARIABLES" class="headerlink" title="7.4 PRIVATE VARIABLES"></a>7.4 PRIVATE VARIABLES</h2><p>Privileged method: two ways</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyObject</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//private variables and functions </span></span><br><span class="line">    <span class="keyword">var</span> privateVariable = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateFunction</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">    <span class="comment">//privileged methods </span></span><br><span class="line">    <span class="keyword">this</span>.publicMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        privateVariable++;</span><br><span class="line">        <span class="keyword">return</span> privateFunction(); </span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Pewrson</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.setName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        name = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Disadvantage: each time <code>new Person</code>, new functions are created</p>
<h3 id="7-4-1-Static-Private-Variables"><a href="#7-4-1-Static-Private-Variables" class="headerlink" title="7.4.1 Static Private Variables"></a>7.4.1 Static Private Variables</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">""</span>;</span><br><span class="line">    Person = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123; name = value;&#125;;</span><br><span class="line">    Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> name;&#125;;</span><br><span class="line">    Person.prototype.setName = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>)</span>&#123; name = value;&#125;; </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>Disadvantage: All instance name will be shared and set</p>
<h3 id="7-4-2-The-Module-Pattern"><a href="#7-4-2-The-Module-Pattern" class="headerlink" title="7.4.2 The Module Pattern"></a>7.4.2 The Module Pattern</h3><p>Create private variable and privileged method for singleton</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//private variables and functions </span></span><br><span class="line">    <span class="keyword">var</span> privateVariable = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateFunction</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//privileged/public methods and properties </span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        publicProperty: <span class="literal">true</span>, </span><br><span class="line">        publicMethod : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            privateVariable++;              <span class="comment">// closure</span></span><br><span class="line">            <span class="keyword">return</span> privateFunction(); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;; </span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<h3 id="7-4-3-The-Module-Augmentation-Pattern"><a href="#7-4-3-The-Module-Augmentation-Pattern" class="headerlink" title="7.4.3 The Module-Augmentation Pattern"></a>7.4.3 The Module-Augmentation Pattern</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> singleton = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private variables and functions </span></span><br><span class="line">    <span class="keyword">var</span> privateVariable = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateFunction</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//create object</span></span><br><span class="line">    <span class="keyword">var</span> object = <span class="keyword">new</span> CustomType();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//add privileged/public properties and methods </span></span><br><span class="line">    object.publicProperty = <span class="literal">true</span>;</span><br><span class="line">    object.publicMethod = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        privateVariable++;</span><br><span class="line">        <span class="keyword">return</span> privateFunction();</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//return the object</span></span><br><span class="line">    <span class="keyword">return</span> object; </span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<h1 id="Chapter8-BOM-Browser-Object-Model"><a href="#Chapter8-BOM-Browser-Object-Model" class="headerlink" title="Chapter8 BOM(Browser Object Model)"></a>Chapter8 BOM(Browser Object Model)</h1><p>Provides objects that expose browser functionality independent of any web page content</p>
<h2 id="8-1-THE-WINDOW-OBJECT"><a href="#8-1-THE-WINDOW-OBJECT" class="headerlink" title="8.1 THE WINDOW OBJECT"></a>8.1 THE WINDOW OBJECT</h2><p>Dual purpose:</p>
<ol>
<li>JavaScript interface to the browser window </li>
<li>ECMAScript Global object</li>
</ol>
<h3 id="8-1-1-The-Global-Scope"><a href="#8-1-1-The-Global-Scope" class="headerlink" title="8.1.1 The Global Scope"></a>8.1.1 The Global Scope</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">19</span>;</span><br><span class="line"><span class="built_in">window</span>.color = <span class="string">'blue'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="built_in">window</span>.age;      <span class="comment">// fail</span></span><br><span class="line"><span class="keyword">delete</span> <span class="built_in">window</span>.color;    <span class="comment">// success</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>Cannot <code>delete window.age</code>: properties of window that were added via var statements have their [[Configurable]] attribute set to false</p>
</li>
<li><p>Attempting to access an undeclared variable throws an error, but it is possible to check for the existence of a potentially undeclared variable by looking on the window object.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> newValue = oldValue;        <span class="comment">// err</span></span><br><span class="line"><span class="keyword">var</span> newValue = <span class="built_in">window</span>.oldValue; <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="8-1-2-8-1-7-Window-Relationships-and-Frames"><a href="#8-1-2-8-1-7-Window-Relationships-and-Frames" class="headerlink" title="8.1.2-8.1.7 Window Relationships and Frames"></a>8.1.2-8.1.7 Window Relationships and Frames</h3><table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Frames</td>
<td><code>frames[0]</code></td>
<td>access to window object for different frame</td>
</tr>
<tr>
<td></td>
<td><code>top</code></td>
<td>the very top (outermost) frame, which is the browser window itself</td>
</tr>
<tr>
<td></td>
<td><code>parent</code></td>
<td>The parent object always points to the current frame’s immediate parent frame</td>
</tr>
<tr>
<td>Window Position</td>
<td><code>screenLeft</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>screenTop</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>moveTo()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>moveBy()</code></td>
<td></td>
</tr>
<tr>
<td>Window Size</td>
<td><code>innerWidth</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>innerHeight</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>outerWidth</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>outerHeight</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>resizeTo()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>resizeBy()</code></td>
<td></td>
</tr>
<tr>
<td>Navigating and Opening Windows</td>
<td><code>open()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>close()</code></td>
<td></td>
</tr>
<tr>
<td>Intervals and Timeouts</td>
<td><code>setTimeout()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>clearTimeout()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>setInterval()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>clearInterval()</code></td>
<td></td>
</tr>
<tr>
<td>System Dialogs</td>
<td><code>alert()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>confirm()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>promp()</code></td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>print()</code></td>
<td>print dialog</td>
</tr>
<tr>
<td></td>
<td><code>find()</code></td>
<td>search dialog</td>
</tr>
</tbody>
</table>
<h2 id="8-2-THE-LOCATION-OBJECT"><a href="#8-2-THE-LOCATION-OBJECT" class="headerlink" title="8.2 THE LOCATION OBJECT"></a>8.2 THE LOCATION OBJECT</h2><ul>
<li>It provides information about the document</li>
<li><code>window.location === document.location</code></li>
</ul>
<h3 id="Location-Attributes"><a href="#Location-Attributes" class="headerlink" title="Location Attributes"></a>Location Attributes</h3><p><code>https://movie.douban.com/subject/1291561/?from=showing</code> as example</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>hash</td>
<td>“”</td>
<td>The URL hash or an empty string if the URL doesn’t have a hash.</td>
</tr>
<tr>
<td>host</td>
<td>“movie.douban.com”</td>
<td></td>
</tr>
<tr>
<td>href</td>
<td>“<a href="https://movie.douban.com/subject/1291561/?from=showing&quot;" target="_blank" rel="noopener">https://movie.douban.com/subject/1291561/?from=showing&quot;</a></td>
<td></td>
</tr>
<tr>
<td>pathname</td>
<td>“/subject/1291561/“</td>
<td></td>
</tr>
<tr>
<td>port</td>
<td>“”</td>
<td></td>
</tr>
<tr>
<td>protocol</td>
<td>“https:”</td>
<td>The protocol used by the page. Typically “http:” or “https:”.</td>
</tr>
<tr>
<td>search</td>
<td>“?from=showing”</td>
<td>search string which start with ?</td>
</tr>
</tbody>
</table>
<h3 id="Manipulating-the-Location"><a href="#Manipulating-the-Location" class="headerlink" title="Manipulating the Location"></a>Manipulating the Location</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>location.assign(&quot;http://www.wrox.com&quot;);</code></td>
<td></td>
</tr>
<tr>
<td><code>window.location = &quot;http://www.wrox.com&quot;</code></td>
<td></td>
</tr>
<tr>
<td><code>location.href = &quot;http://www.wrox.com&quot;</code></td>
<td><code>location.search = &quot;?q=javascript&quot;;</code><br><code>location.hostname = &quot;www.yahoo.com&quot;;</code><br>…</td>
</tr>
<tr>
<td><code>location.replace(&quot;http://www.wrox.com&quot;)</code></td>
<td>user cannot click back button to the previous page</td>
</tr>
<tr>
<td><code>location.reload()</code></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="8-3-THE-NAVIGATOR-OBJECT"><a href="#8-3-THE-NAVIGATOR-OBJECT" class="headerlink" title="8.3 THE NAVIGATOR OBJECT"></a>8.3 THE NAVIGATOR OBJECT</h2><p>For providing browser information</p>
<h2 id="8-4-THE-SCREEN-OBJECT"><a href="#8-4-THE-SCREEN-OBJECT" class="headerlink" title="8.4 THE SCREEN OBJECT"></a>8.4 THE SCREEN OBJECT</h2><p>An indication of client capabilities</p>
<h2 id="8-5-THE-HISTORY-OBJECT"><a href="#8-5-THE-HISTORY-OBJECT" class="headerlink" title="8.5 THE HISTORY OBJECT"></a>8.5 THE HISTORY OBJECT</h2><p>represents the user’s navigation history </p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>history.go(-1)</code></td>
<td>go back one page </td>
</tr>
<tr>
<td><code>history.go(1)</code></td>
<td>go forward one page</td>
</tr>
<tr>
<td><code>history.go(&quot;wrox.com&quot;)</code></td>
<td>go to nearest wrox.com page</td>
</tr>
<tr>
<td><code>history.forward()</code></td>
<td>same as <code>history.go(1)</code></td>
</tr>
<tr>
<td><code>history.back()</code></td>
<td>same as <code>history.go(-1)</code></td>
</tr>
</tbody>
</table>
<h1 id="Chpater9-Client-Detection"><a href="#Chpater9-Client-Detection" class="headerlink" title="Chpater9 Client Detection"></a>Chpater9 Client Detection</h1><h2 id="9-1-Capability-detection"><a href="#9-1-Capability-detection" class="headerlink" title="9.1 Capability detection"></a>9.1 Capability detection</h2><p>Tests for specific browser capabilities before using them</p>
<h2 id="9-3-Quirks-detection"><a href="#9-3-Quirks-detection" class="headerlink" title="9.3 Quirks detection"></a>9.3 Quirks detection</h2><p>Quirks are essentially bugs in browser implementations</p>
<h2 id="9-3-User-agent-detection"><a href="#9-3-User-agent-detection" class="headerlink" title="9.3 User-agent detection"></a>9.3 User-agent detection</h2><p>Detecting information about the browser, often including the browser, platform, operating system, and browser version.</p>
<h1 id="Chapter10-DOM-Document-Object-Model"><a href="#Chapter10-DOM-Document-Object-Model" class="headerlink" title="Chapter10 DOM(Document Object Model)"></a>Chapter10 DOM(Document Object Model)</h1><p>Represents a document as a hierarchical tree of nodes, allowing developers to add, remove, and modify individual parts of the page.</p>
<h2 id="10-1-HIERARCHY-OF-NODES"><a href="#10-1-HIERARCHY-OF-NODES" class="headerlink" title="10.1 HIERARCHY OF NODES"></a>10.1 HIERARCHY OF NODES</h2><h3 id="10-1-1-The-Node-Type"><a href="#10-1-1-The-Node-Type" class="headerlink" title="10.1.1 The Node Type"></a>10.1.1 The Node Type</h3><ul>
<li>Node.ELEMENT_NODE (1)</li>
<li>Node.ATTRIBUTE_NODE (2)</li>
<li>Node.TEXT_NODE (3)</li>
<li>Node.CDATA_SECTION_NODE (4)</li>
<li>Node.ENTITY_REFERENCE_NODE (5)</li>
<li>Node.ENTITY_NODE (6)</li>
<li>Node.PROCESSING_INSTRUCTION_NODE (7)</li>
<li>Node.COMMENT_NODE (8)</li>
<li>Node.DOCUMENT_NODE (9)</li>
<li>Node.DOCUMENT_TYPE_NODE (10)</li>
<li>Node.DOCUMENT_FRAGMENT_NODE (11)</li>
<li>Node.NOTATION_NODE (12)</li>
</ul>
<p><code>var someNode = document.getElementById(&#39;xx&#39;)</code></p>
<h4 id="nodeName-and-nodeValue"><a href="#nodeName-and-nodeValue" class="headerlink" title="nodeName and nodeValue"></a>nodeName and nodeValue</h4><table>
<thead>
<tr>
<th>Name</th>
<th>usage</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodeType</td>
<td><code>someNode.nodeType === Node.ELEMENT_NODE</code></td>
</tr>
<tr>
<td>nodeName</td>
<td><code>someNode.nodeName === &#39;DIV&#39;</code></td>
<td>tag</td>
</tr>
<tr>
<td>childNodes</td>
<td><code>someNode.childNodes[0]</code><br><code>someNode.childNodes.item(1)</code></td>
<td>Each node has a childNodes property containing a <strong>NodeList</strong> obj<br> Changes will be reflected in NodeList objects automatically (dynamic)</td>
</tr>
<tr>
<td>parentNode</td>
<td><code>someNode.parentNode</code></td>
<td></td>
</tr>
<tr>
<td>previousSibling</td>
<td><code>someNode.previousSibling</code></td>
<td></td>
</tr>
<tr>
<td>nextSibling</td>
<td><code>someNode.nextSibling</code></td>
<td></td>
</tr>
<tr>
<td>firstChild</td>
<td><code>someNode.firstChild</code></td>
<td></td>
</tr>
<tr>
<td>lastChild</td>
<td><code>someNode.lastChild</code></td>
<td></td>
</tr>
<tr>
<td>appendChild</td>
<td><code>someNode.appendChild(newNode)</code></td>
<td></td>
</tr>
<tr>
<td>insertBefore</td>
<td><code>someNode.insertBefore(newNode, aChildNode)</code></td>
<td>if null, become last node</td>
</tr>
<tr>
<td>replaceChild</td>
<td><code>someNode.replaceChild(newNode, aChildNode)</code></td>
<td></td>
</tr>
<tr>
<td>cloneNode</td>
<td><code>someNode.cloneNode(true)</code></td>
<td>boolean: copy all children or not</td>
</tr>
<tr>
<td>normalize</td>
<td>…</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="10-1-2-The-Document-Type"><a href="#10-1-2-The-Document-Type" class="headerlink" title="10.1.2 The Document Type"></a>10.1.2 The Document Type</h3><ul>
<li>Represents document nodes</li>
<li>The document object in browser is an instance of HTMLDocument</li>
<li>The document object is a property of window and is accessible globally</li>
</ul>
<table>
<thead>
<tr>
<th>Category</th>
<th>Usage</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Document Childre</td>
<td>document.documentElement</td>
<td><code>&lt;html&gt;</code></td>
</tr>
<tr>
<td></td>
<td>document.body</td>
<td><code>&lt;body&gt;</code></td>
</tr>
<tr>
<td></td>
<td>document.doctype</td>
<td><code>&lt;!DOCTYPE&gt;</code></td>
</tr>
<tr>
<td>Document Information</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.title</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.URL</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.domain</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.referrer</td>
<td>gives the URL of the page that linked to this page</td>
</tr>
<tr>
<td>Locating Elements</td>
<td>getElementById()</td>
<td>return the first occurance</td>
</tr>
<tr>
<td></td>
<td>document.getElementByTagName()</td>
<td>return a HTMLCollection obj, dynamic<br><code>images.namedItem(&quot;myImage&quot;)</code> or <code>images[&quot;myImage&quot;]</code> <br> parameter can be ‘*”</td>
</tr>
<tr>
<td></td>
<td>document.getElementByName()</td>
<td>similar as getElementByTagName</td>
</tr>
<tr>
<td>Special Collections</td>
<td>document.anchors</td>
<td>Contains all \<a> elements with a name attribute</a></td>
</tr>
<tr>
<td></td>
<td>document.forms</td>
<td><code>&lt;form&gt;</code></td>
</tr>
<tr>
<td></td>
<td>document.images</td>
<td><code>&lt;img&gt;</code></td>
</tr>
<tr>
<td></td>
<td>document.links</td>
<td>Contains all \<a> elements with an href attribute </a></td>
</tr>
<tr>
<td>DOM Conformance Detection</td>
<td>document.implementaion.hasFeature(‘XML’’, ‘1.0’)</td>
<td></td>
</tr>
<tr>
<td>Document Writing</td>
<td>write()</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.writeln()</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.open()</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.close()</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="10-1-3-The-Element-Type"><a href="#10-1-3-The-Element-Type" class="headerlink" title="10.1.3 The Element Type"></a>10.1.3 The Element Type</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>element.getAttribute()</td>
<td>custom attributes should be prepended with data- in order to validate</td>
</tr>
<tr>
<td>element.setAttribute()</td>
<td></td>
</tr>
<tr>
<td>element.removeAttribute()</td>
<td></td>
</tr>
<tr>
<td>element.attributes</td>
<td>.getNamedItem(name)<br>.removeNamedItem(name)<br>.setNamedItem(node)<br>.item(pos)</td>
</tr>
<tr>
<td>document.createElement()</td>
<td><code>createElement(&quot;div&quot;);div.id=&quot;newDiv&quot;</code> or <code>createElement(&quot;\&lt;div id=\\&quot;newDiv\\&quot;\&gt;\&lt;div&gt;&quot;)</code>;</td>
</tr>
</tbody>
</table>
<h3 id="10-1-4-The-Text-Type"><a href="#10-1-4-The-Text-Type" class="headerlink" title="10.1.4 The Text Type"></a>10.1.4 The Text Type</h3><table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>text manipulation</td>
<td>appendData(text)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>deleteData(offset, count)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>insertData(offset, count)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>replaceData(offset, count, text)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>splitText(offset)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>substringData(offset, count)</td>
<td></td>
</tr>
<tr>
<td>create text node</td>
<td>createTextNode(“text”)</td>
<td></td>
</tr>
<tr>
<td>normalize text nodes</td>
<td>element.normalize()</td>
<td>it is possible to have multiple text nodes as children</td>
</tr>
<tr>
<td>split text nodes</td>
<td>element.firstChild.splitText(5)</td>
</tr>
</tbody>
</table>
<h3 id="10-1-5-The-Comment-Type"><a href="#10-1-5-The-Comment-Type" class="headerlink" title="10.1.5 The Comment Type"></a>10.1.5 The Comment Type</h3><ul>
<li>Inherits from the same base as the Text type, so it has all of the same string- manipulation methods except splitText()</li>
<li>document.createComment()</li>
</ul>
<h3 id="10-1-6-The-CDATASection-Type"><a href="#10-1-6-The-CDATASection-Type" class="headerlink" title="10.1.6 The CDATASection Type"></a>10.1.6 The CDATASection Type</h3><ul>
<li>CDATA sections are specific to XML-based documents</li>
<li>document.createCDataSection()</li>
</ul>
<h3 id="10-1-7-The-DocumentType-Type"><a href="#10-1-7-The-DocumentType-Type" class="headerlink" title="10.1.7 The DocumentType Type"></a>10.1.7 The DocumentType Type</h3><ul>
<li><code>document.doctype.name === &#39;HTML&#39;</code></li>
<li>e.g. <code>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;</code>: HTML</li>
</ul>
<h3 id="10-1-8-The-DocumentFragment-Type"><a href="#10-1-8-The-DocumentFragment-Type" class="headerlink" title="10.1.8 The DocumentFragment Type"></a>10.1.8 The DocumentFragment Type</h3><p>Adding each item directly to the element causes the browser to re-render the page with the new information. It solves this issue.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fragment = <span class="built_in">document</span>.createDocumentFragment(); </span><br><span class="line"><span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">"myList"</span>);</span><br><span class="line"><span class="keyword">var</span> li = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">    li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>); </span><br><span class="line">    li.appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">"Item "</span> + (i+<span class="number">1</span>))); </span><br><span class="line">    fragment.appendChild(li);</span><br><span class="line">&#125; </span><br><span class="line">ul.appendChild(fragment);</span><br></pre></td></tr></table></figure>
<h3 id="10-1-9-The-Attr-Type"><a href="#10-1-9-The-Attr-Type" class="headerlink" title="10.1.9 The Attr Type"></a>10.1.9 The Attr Type</h3><p>Not recommended.<br>Another way of <code>get/set/removeAttribute()</code>.</p>
<h2 id="10-2-WORKING-WITH-THE-DOM"><a href="#10-2-WORKING-WITH-THE-DOM" class="headerlink" title="10.2 WORKING WITH THE DOM"></a>10.2 WORKING WITH THE DOM</h2><h3 id="10-2-1-Dynamic-Scripts"><a href="#10-2-1-Dynamic-Scripts" class="headerlink" title="10.2.1 Dynamic Scripts"></a>10.2.1 Dynamic Scripts</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadScript</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>); </span><br><span class="line">    cript.type = <span class="string">"text/javascript"</span>;</span><br><span class="line">    script.src = url;   <span class="comment">// or script.appendChild(document.createTextNode("function sayHi()&#123;alert(‘hi’);&#125;"));</span></span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-2-Dynamic-Styles"><a href="#10-2-2-Dynamic-Styles" class="headerlink" title="10.2.2 Dynamic Styles"></a>10.2.2 Dynamic Styles</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadStyles</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> link = <span class="built_in">document</span>.createElement(<span class="string">"link"</span>);</span><br><span class="line">    link.rel = <span class="string">"stylesheet"</span>;</span><br><span class="line">    link.type = <span class="string">"text/css"</span>;</span><br><span class="line">    link.href = url;</span><br><span class="line">    <span class="keyword">var</span> head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>]; <span class="comment">//or style.appendChild(document.createTextNode("body&#123;background-color:red&#125;"));</span></span><br><span class="line">    head.appendChild(link);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-3-Manipulating-Tables"><a href="#10-2-3-Manipulating-Tables" class="headerlink" title="10.2.3 Manipulating Tables"></a>10.2.3 Manipulating Tables</h3><p>Skip, I guess no one do this by hand</p>
<h3 id="10-2-4-Using-NodeLists"><a href="#10-2-4-Using-NodeLists" class="headerlink" title="10.2.4 Using NodeLists"></a>10.2.4 Using NodeLists</h3><p>NodeList, NamedNodeMap and HTMLCollection are similar: all dynamic</p>
<ul>
<li><p>Since a query is run against the document each time, try to cache frequently used values retrieved from a NodeList. e.g. </p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> divs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'div'</span>); </span><br><span class="line"><span class="keyword">var</span> len = divs.length;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Chapter11-DOM-Extensions"><a href="#Chapter11-DOM-Extensions" class="headerlink" title="Chapter11 DOM Extensions"></a>Chapter11 DOM Extensions</h1><h2 id="11-1-SELECTORS-API"><a href="#11-1-SELECTORS-API" class="headerlink" title="11.1 SELECTORS API"></a>11.1 SELECTORS API</h2><table>
<thead>
<tr>
<th>Category</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>querySelector()</td>
<td>document.querySelector(“body”)</td>
<td>“body”, “#myId”, “.myClass”<br> return first element</td>
</tr>
<tr>
<td>querySelectorAll()</td>
<td>document.querySelectorAll(“. myClass”);</td>
<td>return NodeList obj</td>
</tr>
<tr>
<td>matchesSelector()</td>
<td><code>document.body.matchesSelector(&quot;body.page1&quot;) === true</code></td>
</tr>
</tbody>
</table>
<h2 id="11-2-ELEMENT-TRAVERSAL"><a href="#11-2-ELEMENT-TRAVERSAL" class="headerlink" title="11.2 ELEMENT TRAVERSAL"></a>11.2 ELEMENT TRAVERSAL</h2><table>
<thead>
<tr>
<th>Category</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>childElementCount</td>
<td>number of child elements</td>
</tr>
<tr>
<td>firstElementChild</td>
<td></td>
</tr>
<tr>
<td>lastElementChild</td>
<td></td>
</tr>
<tr>
<td>previousElementSibling</td>
<td></td>
</tr>
<tr>
<td>nextElementSibling</td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i, len,</span><br><span class="line">child = element.firstElementChild; </span><br><span class="line"><span class="keyword">while</span>(child != element.lastElementChild)&#123;</span><br><span class="line">    processChild(child);</span><br><span class="line">    child = child.nextElementSibling; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11-3-HTML-5"><a href="#11-3-HTML-5" class="headerlink" title="11.3 HTML 5"></a>11.3 HTML 5</h2><table>
<thead>
<tr>
<th>Category</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Class-Related Additions</td>
<td>getElementsByClassName()</td>
<td>return NodeList</td>
</tr>
<tr>
<td></td>
<td>classList.add(value)<br>.contains(value)<br>.remove(value)<br>.toggle(value)</td>
<td></td>
</tr>
<tr>
<td>Focus Management</td>
<td>document.activeElement</td>
<td>contains a pointer to the DOM element that currently has focus</td>
</tr>
<tr>
<td></td>
<td>element.focus()</td>
<td></td>
</tr>
<tr>
<td></td>
<td>document.hasfocus()</td>
<td>determine if the user is interacting with the page</td>
</tr>
<tr>
<td>Changes to HTMLDocument</td>
<td>document.readyState</td>
<td>loading: The document is loading<br> complete: The document is completely loaded</td>
</tr>
<tr>
<td></td>
<td>document.compatMode</td>
<td>CSS1Compat: standard<br>BackCompat: quirks mode</td>
</tr>
<tr>
<td></td>
<td>document.head</td>
<td></td>
</tr>
<tr>
<td>Character Set Properties</td>
<td>document.charset</td>
<td>“UTF-16”</td>
</tr>
<tr>
<td>Custom Data Attributes</td>
<td>element.dataset</td>
<td>customed data attributes should begin with “data-“, then can be fetched by element.dataset.myname; <code>&lt;div id=&quot;myDiv&quot; data-myname=&quot;Nicholas&quot;&gt;&lt;/div&gt;</code></td>
</tr>
<tr>
<td>Markup Insertion</td>
<td>innerHTML</td>
<td>return the HTML representing <strong>all</strong> of the child nodes</td>
</tr>
<tr>
<td></td>
<td>outerHTML</td>
<td>all innerHTML and it self</td>
</tr>
<tr>
<td></td>
<td>insertAdjacentHTML(position, text)</td>
<td>position = [“beforebegin”, “afterbegin”, “beforeend”, “afterend”]</td>
</tr>
<tr>
<td>scrollIntoView</td>
<td>scrollIntoView(boolean)</td>
<td>make sure an element is visible</td>
</tr>
</tbody>
</table>
<h2 id="11-4-PROPRIETARY-EXTENSIONS"><a href="#11-4-PROPRIETARY-EXTENSIONS" class="headerlink" title="11.4 PROPRIETARY EXTENSIONS"></a>11.4 PROPRIETARY EXTENSIONS</h2><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>document.documentMode</code></td>
<td>determines which features it has access</td>
</tr>
<tr>
<td><code>document.documentElement.contains(document.body)</code></td>
<td></td>
</tr>
<tr>
<td><code>document.documentElement.compareDocumentPosision(another)</code></td>
<td>1, 2, 4, 8 16</td>
</tr>
<tr>
<td><code>innerText</code></td>
<td>read/write all children text content</td>
</tr>
<tr>
<td><code>outerText</code></td>
<td>read all children text content, write all children including itself</td>
</tr>
<tr>
<td><hr></td>
<td><hr></td>
</tr>
<tr>
<td><code>scrollIntoViewIfNeeded()</code></td>
<td>Scrolls only if it’s not already visible</td>
</tr>
<tr>
<td><code>scrollByLines(lineCount)</code></td>
<td></td>
</tr>
<tr>
<td><code>scrollByPages(pageCount)</code></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="Chapter12-DOM-Levels-2-and-3"><a href="#Chapter12-DOM-Levels-2-and-3" class="headerlink" title="Chapter12 DOM Levels 2 and 3"></a>Chapter12 DOM Levels 2 and 3</h1><h2 id="12-1-DOM-CHANGES"><a href="#12-1-DOM-CHANGES" class="headerlink" title="12.1 DOM CHANGES"></a>12.1 DOM CHANGES</h2><h3 id="12-1-1-XML-Namespaces"><a href="#12-1-1-XML-Namespaces" class="headerlink" title="12.1.1 XML Namespaces"></a>12.1.1 XML Namespaces</h3><p>Skip. I think it is gradually replaced by json</p>
<h3 id="12-1-2-Other-Changes"><a href="#12-1-2-Other-Changes" class="headerlink" title="12.1.2 Other Changes"></a>12.1.2 Other Changes</h3><h4 id="Changes-to-DocumentType"><a href="#Changes-to-DocumentType" class="headerlink" title="Changes to DocumentType"></a>Changes to DocumentType</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">"-//W3C//DTD HTML 4.01//EN"</span> <span class="string">"http://www.w3.org/TR/html4/strict.dtd"</span></span><br><span class="line">[<span class="xml"><span class="tag">&lt;<span class="name">!ELEMENT</span> <span class="attr">name</span> (#<span class="attr">PCDATA</span>)&gt;</span>]&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>publicId: “-//W3C//DTD HTML 4.01//EN”, </li>
<li>systemId:  “<a href="http://www.w3.org/TR/html4/strict.dtd&quot;" target="_blank" rel="noopener">http://www.w3.org/TR/html4/strict.dtd&quot;</a>, </li>
<li>internalSubset: “&lt;!ELEMENT name (#PCDATA)” </li>
</ul>
<h4 id="Changes-to-Document"><a href="#Changes-to-Document" class="headerlink" title="Changes to Document"></a>Changes to Document</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>importNode(oldNode, boolean)</td>
<td>Similar as cloneNode()<br> boolean: if copy children </td>
</tr>
<tr>
<td>document.implementaion</td>
<td>createDocumentType()<br>createDocument()<br>createHTMLDocument()</td>
</tr>
</tbody>
</table>
<h4 id="Changes-to-Node"><a href="#Changes-to-Node" class="headerlink" title="Changes to Node"></a>Changes to Node</h4><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>element.isSameNode()</td>
<td>same reference</td>
</tr>
<tr>
<td>element.isEqualNode()</td>
<td>same attributes</td>
</tr>
<tr>
<td>element.setUserData(key, value, operationCallback)</td>
<td>whenever the node with the data is cloned, removed, renamed, or imported into another document</td>
</tr>
<tr>
<td>element.getUserData(key)</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="Changes-to-Frames"><a href="#Changes-to-Frames" class="headerlink" title="Changes to Frames"></a>Changes to Frames</h4><p>This property contains a pointer to the document object representing the contents of the frame.</p>
<p><code>document.getElementById(&quot;frameId&quot;).contentDocument</code></p>
<h2 id="12-2-STYLES"><a href="#12-2-STYLES" class="headerlink" title="12.2 STYLES"></a>12.2 STYLES</h2><h3 id="12-2-1-Accessing-Element-Styles"><a href="#12-2-1-Accessing-Element-Styles" class="headerlink" title="12.2.1 Accessing Element Styles"></a>12.2.1 Accessing Element Styles</h3><p>Any HTML element that supports the style attribute also has a style property exposed in JavaScript</p>
<table>
<thead>
<tr>
<th>CSS PROPERTY</th>
<th>JAVASCRIPT PROPERTY</th>
</tr>
</thead>
<tbody>
<tr>
<td>background-image</td>
<td>element.style.backgroundImage</td>
</tr>
<tr>
<td>color</td>
<td>element.style.color</td>
</tr>
<tr>
<td>display</td>
<td>element.style.display</td>
</tr>
<tr>
<td>font-family</td>
<td>element.style.fontFamily</td>
</tr>
</tbody>
</table>
<h4 id="Some-attributes-methods"><a href="#Some-attributes-methods" class="headerlink" title="Some attributes/methods"></a>Some attributes/methods</h4><ul>
<li>cssText<ul>
<li><code>myDiv.style.cssText = &quot;width: 25px;&quot;</code></li>
</ul>
</li>
<li>length</li>
<li>parentRule</li>
<li>getPropertyCSSValue(propertyName)</li>
<li>getPropertyPriority(propertyName)</li>
<li>getPropertyValue(propertyName)</li>
<li>item(index)</li>
<li>removeProperty(propertyName)</li>
<li>setProperty(propertyName, value, priority)</li>
<li>getComputedStyle()<ul>
<li>get the actual style after overriding</li>
</ul>
</li>
</ul>
<h3 id="12-2-2-Working-with-Style-Sheets"><a href="#12-2-2-Working-with-Style-Sheets" class="headerlink" title="12.2.2 Working with Style Sheets"></a>12.2.2 Working with Style Sheets</h3><h4 id="CSS-Style-Sheets"><a href="#CSS-Style-Sheets" class="headerlink" title="CSS Style Sheets"></a>CSS Style Sheets</h4><ul>
<li>CSSStyleSheet extends StyleSheet</li>
<li>Access by: <code>document.styleSheets</code></li>
<li>Attributes:<ul>
<li>disabled</li>
<li>href</li>
<li>media</li>
<li>ownerNode</li>
<li>parentStyleSheet</li>
<li>title</li>
<li>type</li>
<li>cssRule</li>
<li>ownerRule</li>
<li>deleteRule(index)</li>
<li>insertRule(rule, index)</li>
</ul>
</li>
</ul>
<h4 id="CSS-Rules"><a href="#CSS-Rules" class="headerlink" title="CSS Rules"></a>CSS Rules</h4><ul>
<li>CSSStyleRule extends CSSRule</li>
<li>Access by: <code>document.styleSheets[0].cssRule</code></li>
<li><p>Attributes</p>
<ul>
<li>cssText</li>
<li>parentRule</li>
<li>parentStyleSheet</li>
<li>selectorText</li>
<li>style</li>
<li>type</li>
</ul>
</li>
<li><p>Operations:</p>
<ul>
<li>sheet.insertRule(ruleText, insertIndex)</li>
<li>sheet.deleteRule(index)</li>
</ul>
</li>
</ul>
<h3 id="12-2-3-Element-Dimensions"><a href="#12-2-3-Element-Dimensions" class="headerlink" title="12.2.3 Element Dimensions"></a>12.2.3 Element Dimensions</h3><table>
<thead>
<tr>
<th>Category</th>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>offset dimension</td>
<td>offsetHeight</td>
<td></td>
</tr>
<tr>
<td></td>
<td>offsetWidth</td>
<td></td>
</tr>
<tr>
<td></td>
<td>offsetLeft</td>
<td></td>
</tr>
<tr>
<td></td>
<td>offsetTop</td>
<td></td>
</tr>
<tr>
<td>Client Dimensions</td>
<td>clientWidth</td>
<td></td>
</tr>
<tr>
<td></td>
<td>clientHeight</td>
<td></td>
</tr>
<tr>
<td>Scroll dimension</td>
<td>scrollHeight</td>
<td></td>
</tr>
<tr>
<td></td>
<td>scrollWidth</td>
<td></td>
</tr>
<tr>
<td></td>
<td>scrollLeft</td>
<td></td>
</tr>
<tr>
<td></td>
<td>scrollTop</td>
<td></td>
</tr>
<tr>
<td>Element location</td>
<td>getBoundingClientRect().left/right/top/bottom</td>
<td>location of the element on the page relative to the viewport</td>
</tr>
</tbody>
</table>
<p><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/offsetDimension.png" alt="OffsetDimension"><br><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/ClientDimension.png" alt="ClientDimension"><br><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/ScrollDimension.png" alt="ScrollDimension"></p>
<h2 id="12-3-TRAVERSALS"><a href="#12-3-TRAVERSALS" class="headerlink" title="12.3 TRAVERSALS"></a>12.3 TRAVERSALS</h2><p>Depth-first: NodeIterator, TreeWalker</p>
<h3 id="12-3-1-NodeIterator"><a href="#12-3-1-NodeIterator" class="headerlink" title="12.3.1 NodeIterator"></a>12.3.1 NodeIterator</h3><p><code>document.createNodeIterator(root, whatToShow, filter, entityReferenceExpansion)</code></p>
<ul>
<li>root: search root</li>
<li>whatToShow: A numerical code indicating which nodes should be visited</li>
<li><p>filter: instance of NodeFilter. </p>
<ul>
<li><code>var iterator = NodeFilter.SHOW_ALL</code></li>
<li><code>var iterator = NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT</code></li>
<li><p>an obj contained function <code>acceptNode</code> </p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> filter = &#123;</span><br><span class="line">    acceptNode: <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> node.tagName.toLowerCase() == <span class="string">"p"</span> ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>a function:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">var</span> filter = <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> node.tagName.toLowerCase() == <span class="string">"p"</span> ?</span><br><span class="line">                  NodeFilter.FILTER_ACCEPT :</span><br><span class="line">                  NodeFilter.FILTER_SKIP;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>entityReferenceExpansion: not useful</p>
</li>
<li><p>The two primary methods of NodeIterator</p>
<ul>
<li><code>nextNode()</code></li>
<li><code>previousNode()</code></li>
</ul>
</li>
</ul>
<h3 id="12-3-2-TreeWalker"><a href="#12-3-2-TreeWalker" class="headerlink" title="12.3.2 TreeWalker"></a>12.3.2 TreeWalker</h3><p>An advanced version of NodeIterator<br><code>document.createTreeWalker(root, whatToShow, filter, entityReferenceExpansion)</code></p>
<p>methods:</p>
<ul>
<li>nextNode()</li>
<li>previousNode()</li>
<li>parentNode()</li>
<li>firstChild()</li>
<li>lastChild()</li>
<li>nextSibling()</li>
<li>previousSibling()</li>
</ul>
<h2 id="12-4-RANGES"><a href="#12-4-RANGES" class="headerlink" title="12.4 RANGES"></a>12.4 RANGES</h2><h3 id="12-4-1-Ranges-in-the-DOM"><a href="#12-4-1-Ranges-in-the-DOM" class="headerlink" title="12.4.1 Ranges in the DOM"></a>12.4.1 Ranges in the DOM</h3><ul>
<li><p>Usage:</p>
<ul>
<li><code>document.createRange()</code></li>
</ul>
</li>
<li><p>Attributes:</p>
<ul>
<li>startContainer</li>
<li>startOffset</li>
<li>endContainer</li>
<li>endOffset</li>
<li>commonAncestorContainer</li>
</ul>
</li>
</ul>
<h4 id="Simple-Selection"><a href="#Simple-Selection" class="headerlink" title="Simple Selection"></a>Simple Selection</h4><ul>
<li>selectNode(): contain node itself</li>
<li><p>selectNodeContents(): only contain children</p>
<ul>
<li><p>Usage:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> range1 = <span class="built_in">document</span>.createRange(), </span><br><span class="line">    range2 = <span class="built_in">document</span>.createRange(),</span><br><span class="line">    p1 = <span class="built_in">document</span>.getElementById(<span class="string">"p1"</span>);</span><br><span class="line">range1.selectNode(p1); </span><br><span class="line">range2.selectNodeContents(p1);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>setStartBefore(refNode)</p>
</li>
<li>setStartAfter(refNode)</li>
<li>setEndBefore(refNode)</li>
<li>setEndAfter(refNode)</li>
</ul>
<h4 id="Complex-Selection"><a href="#Complex-Selection" class="headerlink" title="Complex Selection"></a>Complex Selection</h4><ul>
<li>range.setStart()</li>
<li>range.setEnd()</li>
</ul>
<h4 id="Interacting-with-DOM-Range-Content"><a href="#Interacting-with-DOM-Range-Content" class="headerlink" title="Interacting with DOM Range Content"></a>Interacting with DOM Range Content</h4><ul>
<li>range.deleteContents()</li>
<li>range.extractContents()</li>
<li>range.cloneContents()</li>
<li>range.insertNode()</li>
<li>range.surroundContents()</li>
<li>range.collapse(): not useful</li>
<li>range1.compareBoundaryPoints(range2)<ul>
<li>check if shared boundary</li>
<li>It returns<ul>
<li>Range.START_TO_START: 0</li>
<li>Range.START_TO_END: 1</li>
<li>Range.END_TO_END: 2</li>
<li>Range.END_TO_START: 3</li>
</ul>
</li>
</ul>
</li>
<li>range.cloneRange()</li>
<li><code>range.detach(); range = null;</code>: detach from document then dereferenced</li>
</ul>
<h3 id="12-4-2-Ranges-in-Internet-Explorer-8-and-Earlier"><a href="#12-4-2-Ranges-in-Internet-Explorer-8-and-Earlier" class="headerlink" title="12.4.2 Ranges in Internet Explorer 8 and Earlier"></a>12.4.2 Ranges in Internet Explorer 8 and Earlier</h3><p>Skip</p>
<h1 id="Chapter13-Events"><a href="#Chapter13-Events" class="headerlink" title="Chapter13 Events"></a>Chapter13 Events</h1><h2 id="13-1-Events-Flow"><a href="#13-1-Events-Flow" class="headerlink" title="13.1 Events Flow"></a>13.1 Events Flow</h2><p>Example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Event Bubbling Example&lt;<span class="regexp">/title&gt; </span></span><br><span class="line"><span class="regexp">    &lt;/</span>head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id=<span class="string">"myDiv"</span>&gt;Click Me&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>body&gt; </span><br><span class="line">&lt;<span class="regexp">/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>DOM Level 2 Events has three phases</p>
<ul>
<li>the event capturing phase</li>
<li>at the target</li>
<li>the event bubbling phase</li>
</ul>
<p><img src="/2019/06/15/Professional-Javascript-For-Web-Developer-Learning-Note/eventCapture.png" alt="EventCapture"></p>
<h2 id="13-2-EVENT-HANDLERS"><a href="#13-2-EVENT-HANDLERS" class="headerlink" title="13.2 EVENT HANDLERS"></a>13.2 EVENT HANDLERS</h2><ul>
<li>event name: e.g. click, load</li>
<li>event handler: e.g. onclick, onload</li>
</ul>
<h3 id="13-2-1-HTML-Event-Handlers"><a href="#13-2-1-HTML-Event-Handlers" class="headerlink" title="13.2.1 HTML Event Handlers"></a>13.2.1 HTML Event Handlers</h3><ul>
<li><code>&lt;input type=&quot;button&quot; value=&quot;Click Me&quot; onclick=&quot;alert(‘Clicked’)&quot; /&gt;</code></li>
<li>It tightly couples the HTML to the JavaScript</li>
</ul>
<h3 id="13-2-2-DOM-Level-0-Event-Handlers"><a href="#13-2-2-DOM-Level-0-Event-Handlers" class="headerlink" title="13.2.2 DOM Level 0 Event Handlers"></a>13.2.2 DOM Level 0 Event Handlers</h3><ul>
<li><p>One method:</p>
<ul>
<li><p>Assign a function to an event handler property, which run winthin the scope of element</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"myBtn"</span>); </span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">"Clicked"</span>); </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">btn.onclick = <span class="literal">null</span>; <span class="comment">//remove event handler</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="13-2-3-DOM-Level-2-Event-Handlers"><a href="#13-2-3-DOM-Level-2-Event-Handlers" class="headerlink" title="13.2.3 DOM Level 2 Event Handlers"></a>13.2.3 DOM Level 2 Event Handlers</h3><ul>
<li>Two methods:<ul>
<li><code>addEventListener(eventName, handler, captureOrBubble)</code></li>
<li><code>removeEventListener(eventName, handler, captureOrBubble)</code></li>
</ul>
</li>
<li>multiple event handlers can be added<ul>
<li>e.g. btn can have two click event</li>
<li>event fire in the order of adding order</li>
</ul>
</li>
<li>event added by <code>addEventListener</code> can only be removed by <code>removeEventListener</code> with same arguments. (anonymous function… haha)</li>
</ul>
<h3 id="13-2-4-Internet-Explorer-Event-Handlers"><a href="#13-2-4-Internet-Explorer-Event-Handlers" class="headerlink" title="13.2.4 Internet Explorer Event Handlers"></a>13.2.4 Internet Explorer Event Handlers</h3><p>Skip</p>
<h3 id="13-2-5-Cross-Browser-Event-Handlers"><a href="#13-2-5-Cross-Browser-Event-Handlers" class="headerlink" title="13.2.5 Cross-Browser Event Handlers"></a>13.2.5 Cross-Browser Event Handlers</h3><p>Skip</p>
<h2 id="13-3-THE-EVENT-OBJECT"><a href="#13-3-THE-EVENT-OBJECT" class="headerlink" title="13.3 THE EVENT OBJECT"></a>13.3 THE EVENT OBJECT</h2><p>When an event related to the DOM is fired, all of the relevant information is gathered and stored on an object called <strong>event</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.type);    <span class="comment">//"click"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="13-3-1-The-DOM-Event-Object"><a href="#13-3-1-The-DOM-Event-Object" class="headerlink" title="13.3.1 The DOM Event Object"></a>13.3.1 The DOM Event Object</h3><table>
<thead>
<tr>
<th>attribute</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bubbles</td>
<td>Boolean</td>
<td>if the event bubbles</td>
</tr>
<tr>
<td>cancelable</td>
<td>Boolean</td>
<td>if the default behavior of the event can be canceled.</td>
</tr>
<tr>
<td>currentTarget</td>
<td>Element</td>
<td>The element whose event is handlering</td>
</tr>
<tr>
<td>defaultPrevented</td>
<td>Boolean</td>
<td>indicates that preventDefault() has been called</td>
</tr>
<tr>
<td>detail</td>
<td>Integer</td>
<td></td>
</tr>
<tr>
<td>eventPhase</td>
<td>Integer</td>
<td>1: capturing phase, 2: at target, 3: bubbling</td>
</tr>
<tr>
<td><strong>preventDefault()</strong></td>
<td>Function</td>
<td>Cancels the default behavior for the event</td>
</tr>
<tr>
<td>stopImmediatePropagation()</td>
<td>Function</td>
<td>Cancels any further event capturing or event bubbling and prevents any other event handlers from being called</td>
</tr>
<tr>
<td><strong>stopPropagation()</strong></td>
<td>Function</td>
<td>Cancels any further event capturing or event bubbling</td>
</tr>
<tr>
<td>target</td>
<td>Element</td>
<td>The target of the event.</td>
</tr>
<tr>
<td>trusted</td>
<td>Boolean</td>
<td></td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>The type of event that was fired</td>
</tr>
<tr>
<td>view</td>
<td>AbstractView</td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><p><code>currentTarget</code> vs <code>target</code> vs <code>this</code></p>
<ul>
<li><code>currentTarget === this</code></li>
<li>currentTarget indicates where the handler is</li>
<li><p>target indicates where the action happens</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.onclick = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    alert(event.currentTarget === <span class="built_in">document</span>.body); <span class="comment">//true </span></span><br><span class="line">    alert(<span class="keyword">this</span> === <span class="built_in">document</span>.body); <span class="comment">//true </span></span><br><span class="line">    alert(event.target === <span class="built_in">document</span>.getElementById(<span class="string">"myBtn"</span>)); <span class="comment">//true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>Any event that can be canceled using preventDefault() will have its cancelable property set to true</li>
</ul>
<h3 id="13-3-2-The-Internet-Explorer-Event-Object"><a href="#13-3-2-The-Internet-Explorer-Event-Object" class="headerlink" title="13.3.2 The Internet Explorer Event Object"></a>13.3.2 The Internet Explorer Event Object</h3><p>Skip</p>
<h3 id="13-3-3-The-Cross-Browser-Event-Object"><a href="#13-3-3-The-Cross-Browser-Event-Object" class="headerlink" title="13.3.3 The Cross-Browser Event Object"></a>13.3.3 The Cross-Browser Event Object</h3><p>Skip</p>
<h2 id="13-4-EVENT-TYPES"><a href="#13-4-EVENT-TYPES" class="headerlink" title="13.4 EVENT TYPES"></a>13.4 EVENT TYPES</h2><p><strong>DOM Level 3 Events specifies the following event groups:</strong></p>
<ul>
<li>User interface (UI) events<ul>
<li>DOMActive: deprecated</li>
<li>load: after completely loaded<ul>
<li>window, script, img, body</li>
</ul>
</li>
<li>unload</li>
<li>abort: Fires on an \&lt;object> element if it is not fully loaded before the user stops the download process</li>
<li>error</li>
<li>select</li>
<li>resize</li>
<li>scroll</li>
</ul>
</li>
<li>Focus events<ul>
<li>blur: Fires when an element has lost focus.</li>
<li>DOMFocusIn: deprecated</li>
<li>DOMFocusOut: deprecated</li>
<li>focus — Fires when an element has received focus</li>
<li>focusin — Fires when an element has received focus</li>
<li>focusout — Fires when an element has lost focus.</li>
<li>When focus is moved from one element to another on the page, the following order of events is followed:<ol>
<li><code>focusout</code> fires on the element losing focus.</li>
<li><code>focusin</code> fires on the element receiving focus.</li>
<li><code>blur</code> fires on the element losing focus.</li>
<li><code>DOMFocusOut</code> fires on the element losing focus.</li>
<li><code>focus</code> fires on the element receiving focus.</li>
<li><code>DOMFocusIn</code> fires on the element receiving focus.</li>
</ol>
</li>
</ul>
</li>
<li>Mouse events<ul>
<li>click</li>
<li>dblclick</li>
<li>mousedown</li>
<li>mouseenter</li>
<li>mouseleave</li>
<li>mousemove</li>
<li>mouseout</li>
<li>mouseover</li>
<li>mouseup</li>
</ul>
</li>
<li>Wheel events<ul>
<li>mousewheel</li>
</ul>
</li>
<li>Text events<ul>
<li>text input</li>
</ul>
</li>
<li>Keyboard events<ul>
<li>keydown</li>
<li>keypress</li>
<li>keyup</li>
</ul>
</li>
<li>Composition events: When inputting characters: like Chinese, Japanese</li>
<li>Mutation events: when a change occurs to the underlying DOM structure.<ul>
<li>DOMSubtreeModified</li>
<li>DOMNodeInserted</li>
<li>DOMNodeRemoved</li>
<li>DOMNodeInsertedIntoDocument</li>
<li>DOMNodeRemovedFromDocument</li>
<li>DOMAttrModified</li>
<li>DOMCharacterDataModified</li>
</ul>
</li>
<li>Mutation name events: when element or attribute names are changed</li>
</ul>
<p><strong>HTML5 Events</strong></p>
<ul>
<li>contextmenu: the menu when right mouse click</li>
<li>beforeunload: prevent the page from being unloaded.</li>
<li>DOMContentLoaded: fires as soon as the DOM tree is completely formed and without regard to images, JavaScript files, CSS files, or other such resources. </li>
<li>readystatechange: IE</li>
<li>pageshow/pagehide:<ul>
<li>back-forward cache speed up page load, while won’t fire load event</li>
<li>pageshow fires after the load event or page restored</li>
</ul>
</li>
<li>hashchange: when the URL hash (everything following a pound sign (#) in a URL) changed</li>
</ul>
<p><strong>Device Events</strong>: Skip</p>
<p><strong>Touch and Gesture Events</strong>: Skip</p>
<h2 id="13-5-MEMORY-AND-PERFORMANCE"><a href="#13-5-MEMORY-AND-PERFORMANCE" class="headerlink" title="13.5 MEMORY AND PERFORMANCE"></a>13.5 MEMORY AND PERFORMANCE</h2><h3 id="13-5-1-Event-Delegation"><a href="#13-5-1-Event-Delegation" class="headerlink" title="13.5.1 Event Delegation"></a>13.5.1 Event Delegation</h3><p>Basic idea: gather all same event handler in document</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">EventUtil.addHandler(list, <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123; </span><br><span class="line">    event = EventUtil.getEvent(event);</span><br><span class="line">    <span class="keyword">var</span> target = EventUtil.getTarget(event);</span><br><span class="line">    <span class="keyword">switch</span>(target.id)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"goSomewhere"</span>:</span><br><span class="line">            location.href = <span class="string">"http://www.wrox.com"</span>; </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"sayHi"</span>: </span><br><span class="line">            alert(<span class="string">"hi"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>The document object is immediately available and can have event handlers assigned at any point during the page’s life cycle</li>
<li>Less time is spent setting up event handlers on the page. Assigning one event handler takes fewer DOM references and less time.</li>
<li>Lower memory usage is required for the entire page, improving overall performance.</li>
</ul>
<h3 id="13-5-2-Removing-Event-Handlers"><a href="#13-5-2-Removing-Event-Handlers" class="headerlink" title="13.5.2 Removing Event Handlers"></a>13.5.2 Removing Event Handlers</h3><ul>
<li>Dangling event handlers: the event handler remains attached even the element is removed</li>
<li>Solution: remove event handler <code>btn.onclick = null;</code></li>
</ul>
<h2 id="13-6-SIMULATING-EVENTS"><a href="#13-6-SIMULATING-EVENTS" class="headerlink" title="13.6 SIMULATING EVENTS"></a>13.6 SIMULATING EVENTS</h2><h3 id="13-6-1-DOM-Event-Simulation"><a href="#13-6-1-DOM-Event-Simulation" class="headerlink" title="13.6.1 DOM Event Simulation"></a>13.6.1 DOM Event Simulation</h3><p>Create event by JavaScript</p>
<ul>
<li>UIEvents</li>
<li>MouseEvents</li>
<li>MutationEvents</li>
<li>HTMLEvents</li>
</ul>
<h3 id="13-6-2-Internet-Explorer-Event-Simulation"><a href="#13-6-2-Internet-Explorer-Event-Simulation" class="headerlink" title="13.6.2 Internet Explorer Event Simulation"></a>13.6.2 Internet Explorer Event Simulation</h3><p>Skip</p>
<h1 id="Chapter14-Scripting-Forms"><a href="#Chapter14-Scripting-Forms" class="headerlink" title="Chapter14 Scripting Forms"></a>Chapter14 Scripting Forms</h1><h2 id="14-1-Form-Basics"><a href="#14-1-Form-Basics" class="headerlink" title="14.1 Form Basics"></a>14.1 Form Basics</h2><p>by the <form> element in HTML and by the HTMLFormElement type in JavaScript. The HTMLFormElement type inherits from HTMLElement</form></p>
<table>
<thead>
<tr>
<th>attribute</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>acceptCharset</td>
<td>The character sets that the server can process</td>
</tr>
<tr>
<td>action</td>
<td>URL</td>
</tr>
<tr>
<td>elements</td>
<td>An HTMLCollection of all controls in the form.</td>
</tr>
<tr>
<td>enctype</td>
<td>The encoding type of the request</td>
</tr>
<tr>
<td>length</td>
<td>number of controls in the form</td>
</tr>
<tr>
<td>method</td>
<td>type of HTTP request. e.g. “get” “post”</td>
</tr>
<tr>
<td>name</td>
<td>form name</td>
</tr>
<tr>
<td>reset()</td>
<td>reset all fields to default</td>
</tr>
<tr>
<td>submit()</td>
<td>submit form</td>
</tr>
<tr>
<td>target</td>
<td>The name of the window to use for sending the request and receiving the response</td>
</tr>
</tbody>
</table>
<p>document.forms[0] or document.forms[1]</p>
<h3 id="14-1-1-Submitting-Forms"><a href="#14-1-1-Submitting-Forms" class="headerlink" title="14.1.1 Submitting Forms"></a>14.1.1 Submitting Forms</h3><p>any \&lt;input> \&lt;button> with <code>type=&quot;submit&quot;</code> can submit form</p>
<p>form.addEventListener(‘submit’, handler);<br>event.preventDefault(event)<br>form.submit()</p>
<h3 id="14-1-2-Submitting-Forms"><a href="#14-1-2-Submitting-Forms" class="headerlink" title="14.1.2 Submitting Forms"></a>14.1.2 Submitting Forms</h3><p>form.addEventListener(‘reset’, handler);<br>event.preventDefault(event)<br>form.reset()</p>
<h3 id="14-1-3-Form-Fields"><a href="#14-1-3-Form-Fields" class="headerlink" title="14.1.3 Form Fields"></a>14.1.3 Form Fields</h3><p>form.elements[0]<br>form.elements[‘text1’]<br>form.elements.length</p>
<h4 id="Common-Form-Field-Properties"><a href="#Common-Form-Field-Properties" class="headerlink" title="Common Form-Field Properties"></a>Common Form-Field Properties</h4><p>disabled |<br>form | pointer to this form<br>name | name<br>readOnly<br>tabIndex | tab order<br>type | checkbox, radio …<br>value | if file: readonly and contain file path</p>
<h4 id="Common-Form-Field-Methods"><a href="#Common-Form-Field-Methods" class="headerlink" title="Common Form-Field Methods"></a>Common Form-Field Methods</h4><p>focus() | sets the browser’s focus to the form fi eld<br>autofocus | <code>&lt;input type=&quot;text&quot; autofocus&gt;</code><br>blur() | remove focus from element</p>
<h4 id="Common-Form-Field-Events"><a href="#Common-Form-Field-Events" class="headerlink" title="Common Form-Field Events"></a>Common Form-Field Events</h4><p>blur | lose focus<br>change | lose focus and value changed for \&lt;input> \&lt;textarea> \&lt;select><br>focus | get focus</p>
<h2 id="14-2-SCRIPTING-TEXT-BOXES"><a href="#14-2-SCRIPTING-TEXT-BOXES" class="headerlink" title="14.2 SCRIPTING TEXT BOXES"></a>14.2 SCRIPTING TEXT BOXES</h2><p><code>texBox.value = &quot;some new value&quot;;</code>: DO NOT use standard DOM methods(setAttribute…)</p>
<table>
<thead>
<tr>
<th>category</th>
<th>name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>selection</td>
<td>textbox.select()</td>
<td>select all text when getting focus</td>
</tr>
<tr>
<td></td>
<td>selectionStart<br>selectionEnd</td>
<td><code>textbox.value.substring(textbox.selectionStart, textbox.selectionEnd)</code></td>
</tr>
<tr>
<td></td>
<td>setSelectionRange(startIndex, endIndex)</td>
</tr>
<tr>
<td>filter</td>
<td>addHandler(“keypress”, func)</td>
<td>combine <code>keypress</code> and <code>preventDefault</code></td>
</tr>
<tr>
<td>Clipboard</td>
<td>beforecopy<br>copy<br>beforecut<br>cut<br>beforepaste<br>paste</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>event.clipboardData.getData(&quot;text&quot;)</code><br><code>event.clipboardData.clearData()</code><br><code>event.clipboardData.setData(&quot;text&quot;, &quot;abcd&quot;)</code></td>
<td></td>
</tr>
<tr>
<td>HTML5 Constraint Validation</td>
<td>required</td>
<td></td>
</tr>
<tr>
<td></td>
<td>type=”email”<br>type=”url”</td>
<td>input types</td>
</tr>
<tr>
<td></td>
<td>type=”number” (range, datetime, datetime-local, date, month, week, time)<br>input.setUp(5)<br>input.setDown(5)</td>
<td>numeric ranges</td>
</tr>
<tr>
<td></td>
<td>checkValidity()</td>
<td>input.checkValidity()</td>
</tr>
<tr>
<td></td>
<td>input.validity</td>
<td>validation info</td>
</tr>
<tr>
<td></td>
<td>novalidate</td>
<td><code>&lt;form method=&quot;post&quot; novalidate&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="14-3-SCRIPTING-SELECT-BOXES"><a href="#14-3-SCRIPTING-SELECT-BOXES" class="headerlink" title="14.3 SCRIPTING SELECT BOXES"></a>14.3 SCRIPTING SELECT BOXES</h2><p><strong>select element methods</strong></p>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>add(newOption, relOption)</td>
<td>add newOption before relOption</td>
</tr>
<tr>
<td>multiple</td>
<td>if multiple selection allowed boolean</td>
</tr>
<tr>
<td>options</td>
<td>An HTMLCollection of <code>&lt;option&gt;</code> elements</td>
</tr>
<tr>
<td>remove(index)</td>
<td></td>
</tr>
<tr>
<td>selectedIndex</td>
<td></td>
</tr>
<tr>
<td>size</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>option element methods</strong></p>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>index</td>
<td></td>
</tr>
<tr>
<td>label</td>
<td></td>
</tr>
<tr>
<td>selected</td>
<td>boolean</td>
</tr>
<tr>
<td>text</td>
<td></td>
</tr>
<tr>
<td>value</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="14-4-FORM-SERIALIZATION"><a href="#14-4-FORM-SERIALIZATION" class="headerlink" title="14.4 FORM SERIALIZATION"></a>14.4 FORM SERIALIZATION</h2><p>How serialize? </p>
<ul>
<li>Read through all fields then encode it as “name=abc&amp;age=14&amp;phone=123”</li>
<li><code>new FormData()</code></li>
</ul>
<h2 id="14-5-RICH-TEXT-EDITING"><a href="#14-5-RICH-TEXT-EDITING" class="headerlink" title="14.5 RICH TEXT EDITING"></a>14.5 RICH TEXT EDITING</h2><p>Skip</p>
<h1 id="Chapter15-Graphics-with-Canvas"><a href="#Chapter15-Graphics-with-Canvas" class="headerlink" title="Chapter15 Graphics with Canvas"></a>Chapter15 Graphics with Canvas</h1><p>Skip</p>
<h1 id="Chapter-16-HTML5-Scripting"><a href="#Chapter-16-HTML5-Scripting" class="headerlink" title="Chapter 16 HTML5 Scripting"></a>Chapter 16 HTML5 Scripting</h1><h2 id="16-1-CROSS-DOCUMENT-MESSAGING-XDM"><a href="#16-1-CROSS-DOCUMENT-MESSAGING-XDM" class="headerlink" title="16.1 CROSS-DOCUMENT MESSAGING (XDM)"></a>16.1 CROSS-DOCUMENT MESSAGING (XDM)</h2><p>Definition: the ability to pass information between pages from different origins<br>e.g. <code>www.wrox.com</code> wants to communicate with a page from <code>p2p.wrox.com</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sender</span></span><br><span class="line"><span class="comment">//data: data</span></span><br><span class="line"><span class="comment">//origin: the origin of the document that sent the message</span></span><br><span class="line"><span class="comment">//source: A proxy for the window object of the document that sent the message</span></span><br><span class="line">postMessage(data, origin, source)</span><br><span class="line"></span><br><span class="line"><span class="comment">//receiver</span></span><br><span class="line"></span><br><span class="line">EventUtil.addHandler(<span class="built_in">window</span>, <span class="string">"message"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//ensure the sender is expected</span></span><br><span class="line">	<span class="keyword">if</span> (event.origin == <span class="string">"http://www.wrox.com"</span>)&#123;</span><br><span class="line">		processMessage(event.data);</span><br><span class="line">		<span class="comment">//optional: send a message back to the original window</span></span><br><span class="line">		event.source.postMessage(<span class="string">"Received!"</span>, <span class="string">"http://p2p.wrox.com"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="16-2-NATIVE-DRAG-AND-DROP"><a href="#16-2-NATIVE-DRAG-AND-DROP" class="headerlink" title="16.2 NATIVE DRAG AND DROP"></a>16.2 NATIVE DRAG AND DROP</h2><ul>
<li><p>Drag-and-Drop Events</p>
<ul>
<li>dragstart</li>
<li>drag</li>
<li>dragend</li>
</ul>
</li>
<li><p>Dragged over a valid drop target</p>
<ul>
<li>dragenter</li>
<li>dragover</li>
<li>dragleave</li>
<li>drop</li>
</ul>
</li>
<li><p>The dataTransfer Object</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>event.dataTransfer.getData()</td>
<td></td>
</tr>
<tr>
<td>event.dataTransfer.setData()</td>
<td></td>
</tr>
<tr>
<td>========================</td>
<td>==============================</td>
</tr>
<tr>
<td>event.dataTransfer.dropEffect</td>
<td>which type of drop behaviors are allowed [‘none’, move’, ‘copy’, ‘link’]</td>
</tr>
<tr>
<td>event.dataTransfer.effectAllowed</td>
<td>which dropEffect is allowed for the dragged item</td>
</tr>
<tr>
<td>========================</td>
<td>==============================</td>
</tr>
<tr>
<td>event.dataTransfer.addElement(element)</td>
<td>Adds an element to the drag operation</td>
</tr>
<tr>
<td>event.dataTransfer.clearData(format)</td>
<td></td>
</tr>
<tr>
<td>event.dataTransfer.setDragImage(element, x, y)</td>
<td>Allows you to specify an image to be displayed under the cursor as the drag takes plac</td>
</tr>
<tr>
<td>event.dataTransfer.types</td>
<td>A list of data types currently being stored</td>
</tr>
<tr>
<td>graggable</td>
<td><code>&lt;img src=&quot;smile.gif&quot; draggable=&quot;false&quot;&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="16-3-MEDIA-ELEMENTS"><a href="#16-3-MEDIA-ELEMENTS" class="headerlink" title="16.3 MEDIA ELEMENTS"></a>16.3 MEDIA ELEMENTS</h2><p>Two new tag: \&lt;video> \&lt;audio></p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Attribute</th>
</tr>
</thead>
<tbody>
<tr>
<td>src</td>
<td>media source</td>
</tr>
<tr>
<td>poster</td>
<td>an image URI to display while the video content is being loaded</td>
</tr>
<tr>
<td>controls</td>
<td>display a UI component</td>
</tr>
</tbody>
</table>
<p>Properties:</p>
<ul>
<li>autoplay, buffered, bufferedBytes, bufferingRate, bufferingThrottled,<br>controls, currentLoop, currentSrc, currentTime, defaultPlaybackRate,<br>duration, ended, loop, muted, networkState,<br>paused, playbackRate, played, readyState, seekable,<br>seeking, src, start, totalBytes, videoHeight, videoWidth,<br>volume, </li>
<li>abort, canplay, canplaythrough, canshowcurrentframe, dataunavailable,<br>durationchange, emptied, empty, ended, error,<br>load, loadeddata, loadedmetadata, loadstart, pause,<br>play, playing, progress, ratechange, seeked,<br>seeking, stalled, timeupdate, volumechange, waiting</li>
</ul>
<p>Methods:</p>
<ul>
<li>element.play()</li>
<li>element.pause()</li>
<li>element.canPlayType(): return true/false</li>
<li>Audio(): <code>var audio = new Audio()</code></li>
</ul>
<h2 id="16-4-HISTORY-STATE-MANAGEMENT"><a href="#16-4-HISTORY-STATE-MANAGEMENT" class="headerlink" title="16.4 HISTORY STATE MANAGEMENT"></a>16.4 HISTORY STATE MANAGEMENT</h2><p>Issue: sometimes I open a new dialog by js and wanna close it by the <code>Back</code> button</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// push state into history</span></span><br><span class="line">history.pushState(data, title, URL)</span><br><span class="line"></span><br><span class="line"><span class="comment">// happens when clicking `Back` button</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">"popState"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> state = event.popState;	<span class="comment">// null if no history</span></span><br><span class="line">	processState(state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// overwrite current state</span></span><br><span class="line">history.replaceState(data, title, URL);</span><br></pre></td></tr></table></figure>
<h1 id="Chapter17-Error-Handling-and-Debugging"><a href="#Chapter17-Error-Handling-and-Debugging" class="headerlink" title="Chapter17 Error Handling and Debugging"></a>Chapter17 Error Handling and Debugging</h1><h2 id="17-1-BROWSER-ERROR-REPORTING"><a href="#17-1-BROWSER-ERROR-REPORTING" class="headerlink" title="17.1 BROWSER ERROR REPORTING"></a>17.1 BROWSER ERROR REPORTING</h2><p>Skip: Introduce Developer Tool</p>
<h2 id="17-2-ERROR-HANDLING"><a href="#17-2-ERROR-HANDLING" class="headerlink" title="17.2 ERROR HANDLING"></a>17.2 ERROR HANDLING</h2><h3 id="17-2-1-try-catch-finally"><a href="#17-2-1-try-catch-finally" class="headerlink" title="17.2.1 try-catch-finally"></a>17.2.1 try-catch-finally</h3><table>
<thead>
<tr>
<th>Error</th>
<th>Types</th>
</tr>
</thead>
<tbody>
<tr>
<td>Error</td>
<td>base type</td>
</tr>
<tr>
<td>EvalError</td>
<td>exception when eval()</td>
</tr>
<tr>
<td>RangeError</td>
<td>number is outside the bounds of its range</td>
</tr>
<tr>
<td>ReferenceError</td>
<td>attempting to access a variable that doesn’t exist</td>
</tr>
<tr>
<td>SyntaxError</td>
<td></td>
</tr>
<tr>
<td>TypeError</td>
<td></td>
</tr>
<tr>
<td>URIError</td>
<td>encodeURI() or decodeURI()</td>
</tr>
</tbody>
</table>
<h3 id="17-2-2-Throwing-Errors"><a href="#17-2-2-Throwing-Errors" class="headerlink" title="17.2.2 Throwing Errors"></a>17.2.2 Throwing Errors</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// all legal</span></span><br><span class="line"><span class="keyword">throw</span> <span class="number">12345</span>;</span><br><span class="line"><span class="keyword">throw</span> <span class="string">"Hello world!"</span>;</span><br><span class="line"><span class="keyword">throw</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">throw</span> &#123; <span class="attr">name</span>: <span class="string">"JavaScript"</span>&#125;;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">SyntaxError</span>(<span class="string">"I don’t like your syntax."</span>)</span><br></pre></td></tr></table></figure>
<p>customized error</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomError</span>(<span class="params">message</span>)</span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"CustomError"</span>;</span><br><span class="line">    <span class="keyword">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line">CustomError.prototype = <span class="keyword">new</span> <span class="built_in">Error</span>(); </span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> CustomError(<span class="string">"My message"</span>);</span><br></pre></td></tr></table></figure>
<p>When?</p>
<ul>
<li>A good error-handling protocol ensures that the only errors that occur are the ones that you throw</li>
<li>e.g.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">values</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!(values <span class="keyword">instanceof</span> <span class="built_in">Array</span>))&#123;</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"process(): Argument must be an array."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    values.sort();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>, len=values.length; i &lt; len; i++)&#123; </span><br><span class="line">        <span class="keyword">if</span> (values[i] &gt; <span class="number">100</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> values[i]; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="17-2-3-The-error-Event"><a href="#17-2-3-The-error-Event" class="headerlink" title="17.2.3 The error Event"></a>17.2.3 The error Event</h3><p>Error even has event !!!</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">message, url, line</span>)</span>&#123; </span><br><span class="line">    alert(message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="17-2-4-Error-Handling-Strategies"><a href="#17-2-4-Error-Handling-Strategies" class="headerlink" title="17.2.4 Error-Handling Strategies"></a>17.2.4 Error-Handling Strategies</h3><h3 id="17-2-5-Identify-Where-Errors-Might-Occur"><a href="#17-2-5-Identify-Where-Errors-Might-Occur" class="headerlink" title="17.2.5 Identify Where Errors Might Occur"></a>17.2.5 Identify Where Errors Might Occur</h3><ul>
<li>Type coercion errors</li>
<li>Data type errors</li>
<li>Communication errors</li>
</ul>
<h3 id="17-2-6-Distinguishing-between-Fatal-and-Nonfatal-Errors"><a href="#17-2-6-Distinguishing-between-Fatal-and-Nonfatal-Errors" class="headerlink" title="17.2.6 Distinguishing between Fatal and Nonfatal Errors"></a>17.2.6 Distinguishing between Fatal and Nonfatal Errors</h3><h3 id="17-2-7-Log-Errors-to-the-Server"><a href="#17-2-7-Log-Errors-to-the-Server" class="headerlink" title="17.2.7 Log Errors to the Server"></a>17.2.7 Log Errors to the Server</h3><p>Soooooo smart. Each image will visit its url.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logError</span>(<span class="params">sev, msg</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.src = <span class="string">"log.php?sev="</span> + <span class="built_in">encodeURIComponent</span>(sev) + <span class="string">"&amp;msg="</span> +</span><br><span class="line">    <span class="built_in">encodeURIComponent</span>(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="17-3-DEBUGGING-TECHNIQUES"><a href="#17-3-DEBUGGING-TECHNIQUES" class="headerlink" title="17.3 DEBUGGING TECHNIQUES"></a>17.3 DEBUGGING TECHNIQUES</h2><h3 id="17-3-1-Logging-Messages-to-a-Console"><a href="#17-3-1-Logging-Messages-to-a-Console" class="headerlink" title="17.3.1 Logging Messages to a Console"></a>17.3.1 Logging Messages to a Console</h3><ul>
<li>error(message)</li>
<li>info(message)</li>
<li>log(message)</li>
<li>warn(message)</li>
</ul>
<h3 id="17-3-2-Logging-Messages-to-the-Page"><a href="#17-3-2-Logging-Messages-to-the-Page" class="headerlink" title="17.3.2 Logging Messages to the Page"></a>17.3.2 Logging Messages to the Page</h3><p>never mind</p>
<h3 id="17-3-3-Throwing-Errors"><a href="#17-3-3-Throwing-Errors" class="headerlink" title="17.3.3 Throwing Errors"></a>17.3.3 Throwing Errors</h3><ul>
<li><code>throw new Error(xxx);</code></li>
<li><code>assert(condition, msg)</code></li>
</ul>
<h2 id="17-4-COMMON-INTERNET-EXPLORER-ERRORS"><a href="#17-4-COMMON-INTERNET-EXPLORER-ERRORS" class="headerlink" title="17.4 COMMON INTERNET EXPLORER ERRORS"></a>17.4 COMMON INTERNET EXPLORER ERRORS</h2><p>Skip</p>
<h1 id="Chapter18-XML-in-JavaScript"><a href="#Chapter18-XML-in-JavaScript" class="headerlink" title="Chapter18 XML in JavaScript"></a>Chapter18 XML in JavaScript</h1><p>Skip</p>
<h1 id="Chapter19-ECMAScript-for-XML"><a href="#Chapter19-ECMAScript-for-XML" class="headerlink" title="Chapter19 ECMAScript for XML"></a>Chapter19 ECMAScript for XML</h1><p>Skip</p>
<h1 id="Chapter20-JSON"><a href="#Chapter20-JSON" class="headerlink" title="Chapter20 JSON"></a>Chapter20 JSON</h1><h2 id="20-1-SYNTAX"><a href="#20-1-SYNTAX" class="headerlink" title="20.1 SYNTAX"></a>20.1 SYNTAX</h2><table>
<thead>
<tr>
<th>type</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Simple Values</td>
<td>“Hello World”</td>
</tr>
<tr>
<td>Object</td>
<td>{“name”: “Nicholas”, “age”: 29}</td>
</tr>
<tr>
<td>Arrays</td>
<td>[{..}, {..}]</td>
</tr>
</tbody>
</table>
<h2 id="20-2-PARSING-AND-SERIALIZATION"><a href="#20-2-PARSING-AND-SERIALIZATION" class="headerlink" title="20.2 PARSING AND SERIALIZATION"></a>20.2 PARSING AND SERIALIZATION</h2><h3 id="20-2-1-The-JSON-Object"><a href="#20-2-1-The-JSON-Object" class="headerlink" title="20.2.1 The JSON Object"></a>20.2.1 The JSON Object</h3><table>
<thead>
<tr>
<th>Method</th>
<th>Convert</th>
</tr>
</thead>
<tbody>
<tr>
<td>JSON.stringify()</td>
<td>object -&gt; JSON string</td>
</tr>
<tr>
<td>JSON.parse()</td>
<td>JSON string -&gt; object</td>
</tr>
</tbody>
</table>
<h3 id="20-2-2-Serialization-Options"><a href="#20-2-2-Serialization-Options" class="headerlink" title="20.2.2 Serialization Options"></a>20.2.2 Serialization Options</h3><ul>
<li><p>Filtering Results</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify(object, [<span class="string">"title"</span>, <span class="string">"edition"</span>])</span><br><span class="line"><span class="built_in">JSON</span>.stringify(object, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">"xxx"</span>) &#123;<span class="keyword">return</span> <span class="literal">undefined</span>;&#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>String Indentation</p>
<p>  <code>JSON.stringify(object, null, 4);   // indent as 4</code></p>
</li>
<li><p>The toJSON() Method</p>
<ul>
<li><p>define a toJSON() method in object. e.g.</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> book = &#123;<span class="string">"name"</span>:<span class="string">"Nicholas"</span>, </span><br><span class="line">            <span class="string">"age"</span>:<span class="number">16</span>, </span><br><span class="line">            toJSON:<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">            &#125;&#125;</span><br><span class="line"><span class="built_in">JSON</span>.stringify(book);   <span class="comment">// only stringify Simple Value name</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="20-2-3-Parsing-Options"><a href="#20-2-3-Parsing-Options" class="headerlink" title="20.2.3 Parsing Options"></a>20.2.3 Parsing Options</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bookCopy = <span class="built_in">JSON</span>.parse(jsonText, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="string">"releaseDate"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key == <span class="string">"name"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;   <span class="comment">// skip this pair</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="Chapter21-Ajax-and-Comet"><a href="#Chapter21-Ajax-and-Comet" class="headerlink" title="Chapter21 Ajax and Comet"></a>Chapter21 Ajax and Comet</h1><p>The key technology pushing Ajax forward was the <code>XMLHttpRequest</code> (XHR) object</p>
<h2 id="21-1-THE-XMLHttpRequest-OBJECT"><a href="#21-1-THE-XMLHttpRequest-OBJECT" class="headerlink" title="21.1 THE XMLHttpRequest OBJECT"></a>21.1 THE XMLHttpRequest OBJECT</h2><h3 id="21-1-2-XHR-Usage"><a href="#21-1-2-XHR-Usage" class="headerlink" title="21.1.2 XHR Usage"></a>21.1.2 XHR Usage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span> ((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">			alert(xhr.responseText);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			alert(<span class="string">"Request was unsuccessful: "</span> + xhr.status);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"example.txt"</span>, <span class="literal">false</span>);	<span class="comment">// GET/POST, URI, isAsynchronous</span></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>You can access only URLs that exist on the same origin, which means the same domain, using the same port, and with the same protocol.</p>
<table>
<thead>
<tr>
<th>readyState</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Uninitialized. The open() method hasn’t been called yet.</td>
</tr>
<tr>
<td>1</td>
<td>Open. The open() method has been called but send() has not been called.</td>
</tr>
<tr>
<td>2</td>
<td>Sent. The send() method has been called but no response has been received.</td>
</tr>
<tr>
<td>3</td>
<td>Receiving. Some response data has been retrieved.</td>
</tr>
<tr>
<td>4</td>
<td>Complete. All of the response data has been retrieved and is available.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>attribute</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>responseText</td>
<td>The text that was returned as the body of the response.</td>
</tr>
<tr>
<td>responseXML</td>
<td>Contains an XML DOM document with the response data if the response has a content type of “text/xml” or “application/xml” .</td>
</tr>
<tr>
<td>status</td>
<td>The HTTP status of the response.</td>
</tr>
<tr>
<td>statusText</td>
<td>The description of the HTTP status.</td>
</tr>
</tbody>
</table>
<h3 id="21-1-3-HTTP-Headers"><a href="#21-1-3-HTTP-Headers" class="headerlink" title="21.1.3 HTTP Headers"></a>21.1.3 HTTP Headers</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"example.php"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"MyHeader"</span>, <span class="string">"MyValue"</span>);</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>Accept</li>
<li>Accept-Charset</li>
<li>Accept-Encoding</li>
<li>Accept-Language</li>
<li>Connection</li>
<li>Cookie</li>
<li>Host </li>
<li>Referer </li>
<li>User-Agent </li>
</ul>
<h3 id="21-1-4-GET-Requests"><a href="#21-1-4-GET-Requests" class="headerlink" title="21.1.4 GET Requests"></a>21.1.4 GET Requests</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"example.php?name1=value1&amp;name2=value2"</span>, <span class="literal">true</span>);		<span class="comment">// wrong</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// should be encoded</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addURLParam</span>(<span class="params">url, name, value</span>) </span>&#123;</span><br><span class="line">	url += (url.indexOf(<span class="string">"?"</span>) == <span class="number">-1</span> ? <span class="string">"?"</span> : <span class="string">"&amp;"</span>);</span><br><span class="line">	url += <span class="built_in">encodeURIComponent</span>(name) + <span class="string">"="</span> + <span class="built_in">encodeURIComponent</span>(value);</span><br><span class="line">	<span class="keyword">return</span> url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = addURLParam(url, <span class="string">'name'</span>, <span class="string">'Ni'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="21-1-5-POST-Requests"><a href="#21-1-5-POST-Requests" class="headerlink" title="21.1.5 POST Requests"></a>21.1.5 POST Requests</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">"post"</span>, <span class="string">"postexample.php"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</span><br><span class="line"><span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"user-info"</span>);</span><br><span class="line">xhr.send(serialize(form));</span><br></pre></td></tr></table></figure>
<ol>
<li>set header</li>
<li>serialize form</li>
</ol>
<h2 id="21-2-XMLHttpRequest-LEVEL-2"><a href="#21-2-XMLHttpRequest-LEVEL-2" class="headerlink" title="21.2 XMLHttpRequest LEVEL 2"></a>21.2 XMLHttpRequest LEVEL 2</h2><h3 id="21-2-1-FormData"><a href="#21-2-1-FormData" class="headerlink" title="21.2.1 FormData"></a>21.2.1 FormData</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> FormData(<span class="built_in">document</span>.forms[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">data.append(<span class="string">"name"</span>, <span class="string">"Nicholas"</span>);</span><br><span class="line"></span><br><span class="line">xhr.send(data);</span><br></pre></td></tr></table></figure>
<h3 id="21-2-2-Timeouts"><a href="#21-2-2-Timeouts" class="headerlink" title="21.2.2 Timeouts"></a>21.2.2 Timeouts</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"timeout.php"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.timeout = <span class="number">1000</span>; <span class="comment">//set timeout for 1 second (IE 8+ only)</span></span><br><span class="line">xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">"Request did not return in a second."</span>);</span><br><span class="line">&#125;;</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h3 id="21-2-3-overrideMimeType"><a href="#21-2-3-overrideMimeType" class="headerlink" title="21.2.3 overrideMimeType()"></a>21.2.3 overrideMimeType()</h3><p>The returned MIME type for a response determines how the response is handled by the XHR objec</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = createXHR();</span><br><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"text.php"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.overrideMimeType(<span class="string">"text/xml"</span>);</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<h2 id="21-3-PROGRESS-EVENTS"><a href="#21-3-PROGRESS-EVENTS" class="headerlink" title="21.3 PROGRESS EVENTS"></a>21.3 PROGRESS EVENTS</h2><table>
<thead>
<tr>
<th>event</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>loadstart</td>
<td>Fires when the fi rst byte of the response has been received.</td>
</tr>
<tr>
<td>progress</td>
<td>Fires repeatedly as a response is being received.</td>
<td>lengthComputable, position, totalSize</td>
</tr>
<tr>
<td>error</td>
<td>Fires when there was an error attempting the request.</td>
</tr>
<tr>
<td>abort</td>
<td>Fires when the connection was terminated by calling abort() .</td>
</tr>
<tr>
<td>load</td>
<td>Fires when the response has been fully received.</td>
<td></td>
</tr>
<tr>
<td>loadend</td>
<td>Fires when the communication is complete and after fi ring error , abort , or load .</td>
</tr>
</tbody>
</table>
<h2 id="21-4-CROSS-ORIGIN-RESOURCE-SHARING"><a href="#21-4-CROSS-ORIGIN-RESOURCE-SHARING" class="headerlink" title="21.4 CROSS-ORIGIN RESOURCE SHARING"></a>21.4 CROSS-ORIGIN RESOURCE SHARING</h2><p>CORS: XHR objects can access resources only on the domain from which the containing web page originates</p>
<ul>
<li>send request with extra header called Origin including (protocol, domain name, and port)<ul>
<li>e.g. <code>Origin: http://www.nczonline.net</code></li>
</ul>
</li>
<li>If the server decides that the request should be allowed, it sends an <code>Access-Control-Allow-Origin</code> header echoing back the same origin that was sent or “*” if it’s a public resource<ul>
<li>e.g. <code>Access-Control-Allow-Origin: http://www.nczonline.net</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = createXHR();</span><br><span class="line">xhr.open(<span class="string">"get"</span>, <span class="string">"http://www.somewhere-else.com/page/"</span>, <span class="literal">true</span>);	<span class="comment">// an absolute URL</span></span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Preflighted Requests</p>
<ul>
<li>CORS allows the use of custom headers, methods other than GET or POST, and different body content types</li>
<li>When you try to make a request with one of the advanced options, a “preflight” request is made to the server. </li>
<li><p>This request uses the OPTIONS method and sends the following headers</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Origin: http:<span class="comment">//www.nczonline.net</span></span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: NCZ</span><br></pre></td></tr></table></figure>
</li>
<li><p>server should return</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:<span class="comment">//www.nczonline.net</span></span><br><span class="line">Access-Control-Allow-Methods: POST, GET</span><br><span class="line">Access-Control-Allow-Headers: NCZ</span><br><span class="line">Access-Control-Max-Age: <span class="number">1728000</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li>Credentialed Requests<ul>
<li><code>Access-Control-Allow-Credentials: true</code></li>
</ul>
</li>
</ul>
<h2 id="21-5-ALTERNATE-CROSS-DOMAIN-TECHNIQUES"><a href="#21-5-ALTERNATE-CROSS-DOMAIN-TECHNIQUES" class="headerlink" title="21.5 ALTERNATE CROSS-DOMAIN TECHNIQUES"></a>21.5 ALTERNATE CROSS-DOMAIN TECHNIQUES</h2><ul>
<li><p>Image Pings</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.onload = img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">"Done!"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">img.src = <span class="string">"http://www.example.com/test?name=Nicholas"</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>* you can only send GET requests
* you cannot access the response text from the server.
</code></pre><ul>
<li><p>JSONP</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">alert(<span class="string">"You’re at IP address "</span> + response.ip + <span class="string">", which is in "</span> +</span><br><span class="line">response.city + <span class="string">", "</span> + response.region_name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">script.src = <span class="string">"http://freegeoip.net/json/?callback=handleResponse"</span>;</span><br><span class="line"><span class="built_in">document</span>.body.insertBefore(script, <span class="built_in">document</span>.body.firstChild);</span><br></pre></td></tr></table></figure>
<ul>
<li>Unsafe: you’re pulling executable code into your page from another domain</li>
<li>Hard to determine that a JSONP request has failed</li>
</ul>
</li>
<li><p>Comet</p>
<ul>
<li>long polling</li>
<li>streaming</li>
</ul>
</li>
<li><p>Server-Sent Events</p>
<ul>
<li><p>Client API for Comet</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> evtSource = <span class="keyword">new</span> EventSource(<span class="string">"ssedemo.php"</span>);</span><br><span class="line">evtSource.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newElement = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">  </span><br><span class="line">  newElement.innerHTML = <span class="string">"message: "</span> + e.data;</span><br><span class="line">  eventList.appendChild(newElement);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Server code</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/stream/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stream</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Response(event(), mimetype=<span class="string">"text/event-stream"</span>) <span class="comment"># MIME type</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Web Sockets</p>
<ul>
<li>Must use a specialized server supporting the protocol to work properly</li>
<li><p>Client API</p>
<ul>
<li>event: open, error, close, message</li>
<li><p>readyState</p>
<ul>
<li>WebSocket.OPENING(0)</li>
<li>WebSocket.OPEN(1)</li>
<li>WebSocket.CLOSING(2)</li>
<li>WebSocket.CLOSE(3)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://www.example.com/server.php"</span>);</span><br><span class="line">socket.send(<span class="built_in">JSON</span>.stringify(message));</span><br><span class="line"></span><br><span class="line">socket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">var</span> data = event.data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">socket.close()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="21-5-6-SSE-versus-Web-Sockets"><a href="#21-5-6-SSE-versus-Web-Sockets" class="headerlink" title="21.5.6 SSE versus Web Sockets"></a>21.5.6 SSE versus Web Sockets</h3><ul>
<li><p>SSE</p>
<ul>
<li>base on HTTP protocol</li>
<li>easier to implement</li>
<li>one direction</li>
</ul>
</li>
<li><p>Web Sockets</p>
<ul>
<li>base on Web Socket protocol</li>
<li>bidirection</li>
</ul>
</li>
</ul>
<h2 id="21-6-SECURITY"><a href="#21-6-SECURITY" class="headerlink" title="21.6 SECURITY"></a>21.6 SECURITY</h2><ul>
<li>Requiring SSL to access resources that can be requested via XHR.</li>
<li>Requiring a computed token to be sent along with every request.</li>
</ul>
<h1 id="Chapter22-Advanced-Techniques"><a href="#Chapter22-Advanced-Techniques" class="headerlink" title="Chapter22 Advanced Techniques"></a>Chapter22 Advanced Techniques</h1><h2 id="22-1-ADVANCED-FUNCTIONS"><a href="#22-1-ADVANCED-FUNCTIONS" class="headerlink" title="22.1 ADVANCED FUNCTIONS"></a>22.1 ADVANCED FUNCTIONS</h2><h3 id="22-1-1-Safe-Type-Detection"><a href="#22-1-1-Safe-Type-Detection" class="headerlink" title="22.1.1 Safe Type Detection"></a>22.1.1 Safe Type Detection</h3><h4 id="Issue"><a href="#Issue" class="headerlink" title="Issue:"></a>Issue:</h4><p>The <code>instanceof</code> operator does not work when multiple global scopes are present, such as when there are multiple frames. e.g.<code>var isArray = value instanceof Array;</code></p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isArray</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(value) == <span class="string">"[object Array]"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-1-2-Scope-Safe-Constructors"><a href="#22-1-2-Scope-Safe-Constructors" class="headerlink" title="22.1.2 Scope-Safe Constructors"></a>22.1.2 Scope-Safe Constructors</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">instanceof</span> Person)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name; <span class="keyword">this</span>.age = age; <span class="keyword">this</span>.job = job;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(name, age, job);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-1-3-Lazy-Loading-Functions"><a href="#22-1-3-Lazy-Loading-Functions" class="headerlink" title="22.1.3 Lazy Loading Functions"></a>22.1.3 Lazy Loading Functions</h3><ul>
<li><p>manipulating the function the first time it is called</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createXHR</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> XMLHttpRequest != <span class="string">"undefined"</span>)&#123;</span><br><span class="line">        createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;             <span class="comment">// override the function</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        createXHR = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;             <span class="comment">// override the function</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"No XHR object available."</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> createXHR();                     <span class="comment">// next time the function is already decided</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>assign the appropriate function immediately when the function is declared</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createXHR = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> XMLHttpRequest != <span class="string">"undefined"</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> XMLHttpRequest(); </span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"No XHR object available."</span>); </span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="22-1-4-Function-Binding"><a href="#22-1-4-Function-Binding" class="headerlink" title="22.1.4 Function Binding"></a>22.1.4 Function Binding</h3><p>see 5.5.5</p>
<h3 id="22-1-5-Function-Currying"><a href="#22-1-5-Function-Currying" class="headerlink" title="22.1.5 Function Currying"></a>22.1.5 Function Currying</h3><p>Creates functions that have one or more arguments already set (also called partial function application</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> handler = &#123;</span><br><span class="line">    message: <span class="string">"Event handled"</span>,</span><br><span class="line">    handleClick: <span class="function"><span class="keyword">function</span>(<span class="params">name, event</span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.message + <span class="string">":"</span> + name + <span class="string">":"</span> + event.type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"my-btn"</span>);</span><br><span class="line">EventUtil.addHandler(btn, <span class="string">"click"</span>, bind(handler.handleClick, handler, <span class="string">"my-btn"</span>));</span><br></pre></td></tr></table></figure>
<p>Just like functional programming</p>
<h2 id="22-2-TAMPER-PROOF-OBJECTS"><a href="#22-2-TAMPER-PROOF-OBJECTS" class="headerlink" title="22.2 TAMPER-PROOF OBJECTS"></a>22.2 TAMPER-PROOF OBJECTS</h2><ul>
<li><p>Nonextensible Objects</p>
<ul>
<li>cannot add</li>
<li><p><code>Object.isExtensible(person)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123; <span class="attr">name</span>: <span class="string">"Nicholas"</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(person);</span><br><span class="line">person.age = <span class="number">29</span>; </span><br><span class="line">alert(person.age); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Sealed Objects</p>
<ul>
<li>cannot add/delete</li>
<li><p><code>Object.isSealed(person);</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123; <span class="attr">name</span>: <span class="string">"Nicholas"</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.seal(person);</span><br><span class="line">person.age = <span class="number">29</span>; </span><br><span class="line">alert(person.age);  <span class="comment">//undefined </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> person.name; </span><br><span class="line">alert(person.name); <span class="comment">//"Nicholas"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Frozen Objects</p>
<ul>
<li>cannot add/delete/update</li>
<li><p><code>Ojbject.isFrozen(person)</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123; <span class="attr">name</span>: <span class="string">"Nicholas"</span> &#125;;</span><br><span class="line"><span class="built_in">Object</span>.seal(person);</span><br><span class="line">person.age = <span class="number">29</span>; </span><br><span class="line">alert(person.age);  <span class="comment">//undefined </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> person.name; </span><br><span class="line">alert(person.name); <span class="comment">//"Nicholas"</span></span><br><span class="line"></span><br><span class="line">person.name = <span class="string">"Greg"</span>;</span><br><span class="line">alert(person.name); <span class="comment">//"Nicholas"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="22-3-ADVANCED-TIMERS"><a href="#22-3-ADVANCED-TIMERS" class="headerlink" title="22.3 ADVANCED TIMERS"></a>22.3 ADVANCED TIMERS</h2><h3 id="22-3-1-setTimeout-and-setInterval"><a href="#22-3-1-setTimeout-and-setInterval" class="headerlink" title="22.3.1 setTimeout and setInterval"></a>22.3.1 setTimeout and setInterval</h3><ul>
<li>No code is executed immediately in JavaScript; it is executed as soon as the process is idle.</li>
<li><code>setTimeout(func, 250)</code> means adding func into the queue after 250mm</li>
<li><code>setInterval()</code> has 2 main issues:<ul>
<li>intervals may be skipped</li>
<li>intervals may be smaller than expected between multiple timer-code executions</li>
</ul>
</li>
</ul>
<h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution:"></a>Solution:</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="comment">//processing</span></span><br><span class="line">    setTimeout(<span class="built_in">arguments</span>.callee, interval); </span><br><span class="line">    </span><br><span class="line">&#125;, interval);</span><br></pre></td></tr></table></figure>
<h3 id="22-3-2-Yielding-Process"><a href="#22-3-2-Yielding-Process" class="headerlink" title="22.3.2 Yielding Process"></a>22.3.2 Yielding Process</h3><h4 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue:"></a>Issue:</h4><ul>
<li>There is a long-running script limit</li>
<li>If you reach that limit, the user is presented with a browser error dialog indicating that a script is taking too long to execute and asking whether the user would like to allow it to continue processing or stop.</li>
</ul>
<h4 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution:"></a>Solution:</h4><ul>
<li>array chunking</li>
<li>create a queue of items to process, use timers to pull the next item to process, process it, and then set another timer</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//get next item and process it </span></span><br><span class="line">    <span class="keyword">var</span> item = array.shift(); </span><br><span class="line">    process(item);</span><br><span class="line">    <span class="comment">//if there’s more items, set another timeout </span></span><br><span class="line">    <span class="keyword">if</span>(array.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        setTimeout(<span class="built_in">arguments</span>.callee, <span class="number">100</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<h3 id="22-3-3-Function-Throttling"><a href="#22-3-3-Function-Throttling" class="headerlink" title="22.3.3 Function Throttling"></a>22.3.3 Function Throttling</h3><h4 id="Issue-2"><a href="#Issue-2" class="headerlink" title="Issue:"></a>Issue:</h4><ul>
<li>Attempting to perform too many DOM-related operations in sequence can cause the browser to hang, and sometimes crash.</li>
</ul>
<h4 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution:"></a>Solution:</h4><ul>
<li>The basic idea behind function throttling is that some code should not be executed repeatedly without a break</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> processor = &#123; </span><br><span class="line">    timeoutId: <span class="literal">null</span>,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//method that actually performs the processing </span></span><br><span class="line">    performProcessing: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//actual processing code </span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//method that is called to initiate processing </span></span><br><span class="line">    process: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        clearTimeout(<span class="keyword">this</span>.timeoutId);</span><br><span class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.timeoutId = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            that.performProcessing(); </span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;    </span><br><span class="line"><span class="comment">//try to start processing </span></span><br><span class="line">processor.process();</span><br></pre></td></tr></table></figure>
<h2 id="22-4-CUSTOM-EVENTS"><a href="#22-4-CUSTOM-EVENTS" class="headerlink" title="22.4 CUSTOM EVENTS"></a>22.4 CUSTOM EVENTS</h2><p>Use the observer pattern</p>
<h2 id="22-5-DRAG-AND-DROP"><a href="#22-5-DRAG-AND-DROP" class="headerlink" title="22.5 DRAG AND DROP"></a>22.5 DRAG AND DROP</h2><p>just some drag/drop event implementation code</p>
<h1 id="Chapter23-Offline-Applications-and-Client-Side-Storage"><a href="#Chapter23-Offline-Applications-and-Client-Side-Storage" class="headerlink" title="Chapter23 Offline Applications and Client-Side Storage"></a>Chapter23 Offline Applications and Client-Side Storage</h1><h2 id="23-1-OFFLINE-DETECTION"><a href="#23-1-OFFLINE-DETECTION" class="headerlink" title="23.1 OFFLINE DETECTION"></a>23.1 OFFLINE DETECTION</h2><ul>
<li><code>navigator.online</code></li>
<li>events<ul>
<li><code>online</code></li>
<li><code>offline</code></li>
</ul>
</li>
</ul>
<h2 id="23-2-APPLICATION-CACHE"><a href="#23-2-APPLICATION-CACHE" class="headerlink" title="23.2 APPLICATION CACHE"></a>23.2 APPLICATION CACHE</h2><ul>
<li><p>Need a manifest file: lists out the resources to be downloaded</p>
<ul>
<li><p>offline.appcache</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CACHE MANIFEST</span><br><span class="line"></span><br><span class="line">file.js</span><br><span class="line">file.css</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>The manifest file is associated with a page by specifying its path in the manifest attribute of <html></html></p>
<p>  <code>&lt;html manifest=&quot;/offline.appcache&quot;&gt;</code>   </p>
</li>
<li><p>JS API</p>
<ul>
<li>applicationCache.status</li>
<li>applicationCache.update()</li>
<li>applicationCache.swapCache()</li>
<li>applicationCache event<ul>
<li>checking</li>
<li>error</li>
<li>noupdate</li>
<li>downloading</li>
<li>progress</li>
<li>updateready</li>
<li>cached</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="23-3-DATA-STORAGE"><a href="#23-3-DATA-STORAGE" class="headerlink" title="23.3 DATA STORAGE"></a>23.3 DATA STORAGE</h2><h3 id="23-3-1-Cookie"><a href="#23-3-1-Cookie" class="headerlink" title="23.3.1 Cookie"></a>23.3.1 Cookie</h3><ul>
<li><p>Response header:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Content-type: text/html </span><br><span class="line"><span class="built_in">Set</span>-Cookie: name=value </span><br><span class="line">Other-header: other-header-value</span><br></pre></td></tr></table></figure>
</li>
<li><p>Request header</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/<span class="number">1.1</span></span><br><span class="line">Cookie: name=value</span><br><span class="line">Other-header: other-header-value</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Restrictions<ul>
<li>Cookies are, by nature, tied to a specific domain</li>
<li>Limitation of amount of cookies</li>
<li>Limitation of length of cookies</li>
</ul>
</li>
<li><p>Cookie Parts</p>
<ul>
<li>name: case insensitive, should be URL encoded</li>
<li>value: should be URL encoded</li>
<li>domain: The domain for which the cookie is valid</li>
<li>path: The path within the specified domain for which the cookie should be sent to the server<ul>
<li>we can specify <code>http://www.wrox.com/books</code> as path, so cookie won’t be sent in <code>https://www.wrox.com</code> even they have the same domain</li>
</ul>
</li>
<li>expiration: A time stamp indicating when the cookie should be deleted (that is, when it should stop being sent to the server</li>
<li>secure flag: cookie information is sent to the server only if an SSL connection is used.<ul>
<li><code>https://www.wrox.com</code> works</li>
<li><code>http://www.wrox.com</code> doesn’t work</li>
</ul>
</li>
</ul>
</li>
<li><p>Cookie in JavaScript</p>
<ul>
<li><code>document.cookie = &quot;name=Nicholas&quot;</code><ul>
<li>added to the existing set of cookies instead of </li>
<li>Setting <code>document.cookie</code> does not overwrite any cookies unless the name of the cookie being set is already in use</li>
</ul>
</li>
</ul>
</li>
<li><p>Subcookies</p>
<ul>
<li>A technique that get around the per-domain cookie limit imposed by browsers</li>
<li>format: <code>name=name1=value1&amp;name2=value2&amp;name3=value3&amp;name4=value4&amp;name5=value5</code></li>
</ul>
</li>
</ul>
<h3 id="23-3-2-Internet-Explorer-User-Data"><a href="#23-3-2-Internet-Explorer-User-Data" class="headerlink" title="23.3.2 Internet Explorer User Data"></a>23.3.2 Internet Explorer User Data</h3><p>Skip</p>
<h3 id="23-3-3-The-Storage-Type"><a href="#23-3-3-The-Storage-Type" class="headerlink" title="23.3.3 The Storage Type"></a>23.3.3 The Storage Type</h3><p>Storage Object</p>
<ul>
<li>methods<ul>
<li>clear()</li>
<li>getItem(name)</li>
<li>key(index)</li>
<li>removeItem(name)</li>
<li>setItem(name value)</li>
</ul>
</li>
<li>types<ul>
<li>sessionStorage</li>
<li>globalStorage (deprecated)</li>
<li>localStorage</li>
</ul>
</li>
<li>storage event<ul>
<li>Whenever a change is made to a Storage object, the storage event is fired on the document</li>
<li>domain</li>
<li>key</li>
<li>newValue</li>
<li>oldValue</li>
</ul>
</li>
</ul>
<h4 id="sessionStorage"><a href="#sessionStorage" class="headerlink" title="sessionStorage"></a>sessionStorage</h4><ul>
<li>Data is stored until the browser is closed</li>
<li>Data stored persists across page refreshes</li>
<li>Data available if the browser crashes and is restarted</li>
</ul>
<h4 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h4><ul>
<li>In order to access the same localStorage object, pages must be served from the same domain (subdomains aren’t valid), using the same protocol, and on the same port. </li>
<li>Data persisted until it is specifically removed via JavaScript or the user clears the browser’s cache.</li>
</ul>
<h3 id="23-3-4-IndexedDB"><a href="#23-3-4-IndexedDB" class="headerlink" title="23.3.4 IndexedDB"></a>23.3.4 IndexedDB</h3><ul>
<li>database in JS</li>
<li>use case<ul>
<li>store large amount of data in UI</li>
<li>locate data fast</li>
<li>suppport transaction</li>
<li>offline application</li>
</ul>
</li>
</ul>
<h1 id="Chapter24-Best-Practices"><a href="#Chapter24-Best-Practices" class="headerlink" title="Chapter24 Best Practices"></a>Chapter24 Best Practices</h1><ul>
<li>Maintainability</li>
<li>Performance</li>
<li>Deployment </li>
</ul>
<h1 id="Chapter25-Emerging-APIs"><a href="#Chapter25-Emerging-APIs" class="headerlink" title="Chapter25 Emerging APIs"></a>Chapter25 Emerging APIs</h1><h2 id="25-1-requestAnimationFrame"><a href="#25-1-requestAnimationFrame" class="headerlink" title="25.1 requestAnimationFrame()"></a>25.1 requestAnimationFrame()</h2><h3 id="Reason"><a href="#Reason" class="headerlink" title="Reason:"></a>Reason:</h3><ol>
<li>We need to determine the best way to schedule a redraw since each browser has a fixed refresh rate. So Javascript animation can work smoothly.</li>
<li>setInterval() and setTimeout() are inaccurate.</li>
<li>Redrawing too often will consume too much resource.</li>
<li>This technique asks browser to update animation on next repaint.</li>
</ol>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation:"></a>Implementation:</h3><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>setInterval()</td>
<td>Deprecated because of accuracy</td>
</tr>
<tr>
<td>mozRequestAnimationFrame()</td>
<td>Chrome: webkitRequestanimationFrame(callback, element)<br>IE: msRequestAnimationFrame()</td>
</tr>
</tbody>
</table>
<h2 id="25-2-Page-Visibility-API"><a href="#25-2-Page-Visibility-API" class="headerlink" title="25.2 Page Visibility API"></a>25.2 Page Visibility API</h2><h3 id="Reason-1"><a href="#Reason-1" class="headerlink" title="Reason:"></a>Reason:</h3><ol>
<li>Knowing when users are actually interacting with the page.</li>
</ol>
<h3 id="Implementation-1"><a href="#Implementation-1" class="headerlink" title="Implementation"></a>Implementation</h3><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>document.hidden</td>
<td>A Boolean value indicating if the page is hidden from view</td>
</tr>
<tr>
<td>document.visibilityState</td>
<td>State indicator</td>
</tr>
<tr>
<td>visibilitychange</td>
<td>Event fires when a document changes from hidden to visible or vice versa.</td>
</tr>
</tbody>
</table>
<h2 id="25-3-Geolocation-API"><a href="#25-3-Geolocation-API" class="headerlink" title="25.3 Geolocation API"></a>25.3 Geolocation API</h2><p>navigator.geolocation has 3 functions:</p>
<ol>
<li>getCurrentPosition(successCallBack, failCallback, options)<ul>
<li>successCallBack: latitude, longitude, accuracy, altitude, altitudeAccuracy, heading, speed</li>
<li>options: enableHighAccuracy, timeout, maximumAge </li>
</ul>
</li>
<li>watchPosition()</li>
<li>clearPosition()</li>
</ol>
<h2 id="25-4-File-API"><a href="#25-4-File-API" class="headerlink" title="25.4 File API"></a>25.4 File API</h2><p><strong>File Attributes</strong></p>
<ul>
<li>name</li>
<li>size</li>
<li>type</li>
<li>lastModifiedData</li>
</ul>
<h3 id="25-4-1-FileReader"><a href="#25-4-1-FileReader" class="headerlink" title="25.4.1 FileReader"></a>25.4.1 FileReader</h3><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>readAsText(file, encoding)</td>
<td>store as plain text</td>
</tr>
<tr>
<td>readAsDataURL(file)</td>
<td>store as URI</td>
</tr>
<tr>
<td>readAsBinaryString(file)</td>
<td>store as Binary String </td>
</tr>
<tr>
<td>readAsArrayBuffer(file)</td>
<td>store as ArrayBuffer</td>
</tr>
</tbody>
</table>
<p>Asynchronously:</p>
<table>
<thead>
<tr>
<th>Event</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>progress</td>
<td>lengthComputable, loaded, total</td>
</tr>
<tr>
<td>load</td>
<td></td>
</tr>
<tr>
<td>error</td>
<td>reader.error.code: 1, 2, 3, 4 </td>
</tr>
</tbody>
</table>
<h3 id="25-4-2-Partial-Reads"><a href="#25-4-2-Partial-Reads" class="headerlink" title="25.4.2 Partial Reads"></a>25.4.2 Partial Reads</h3><ul>
<li>Reason: Save time if read only parts of a file instead of the whole file</li>
<li>Implementation: <ul>
<li><code>blob.slice(startByte, length)</code></li>
<li><code>reader.readAsText(blobSliceObj)</code></li>
</ul>
</li>
</ul>
<h3 id="25-4-3-Object-URLs"><a href="#25-4-3-Object-URLs" class="headerlink" title="25.4.3 Object URLs"></a>25.4.3 Object URLs</h3><ul>
<li>Reason: Don’t need to read the file contents into JavaScript in order to use them</li>
<li><p>Implementation:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url = createObjectURL(file)</span><br><span class="line">xx.innerHTML = <span class="string">`&lt;img src="<span class="subst">$&#123;url&#125;</span>"&gt;`</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="25-4-4-Drag-and-Drop-File-Reading"><a href="#25-4-4-Drag-and-Drop-File-Reading" class="headerlink" title="25.4.4 Drag-and-Drop File Reading"></a>25.4.4 Drag-and-Drop File Reading</h3><p>In event handler:</p>
<ol>
<li>Cancel the default behavior of dragenter, dragover, and drop.</li>
<li><code>event.dataTransfer.files</code></li>
</ol>
<h3 id="25-4-5-File-Upload-with-XHR"><a href="#25-4-5-File-Upload-with-XHR" class="headerlink" title="25.4.5 File Upload with XHR"></a>25.4.5 File Upload with XHR</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">in</span> event handler)</span><br><span class="line">data = <span class="keyword">new</span> Formdata();</span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest(); </span><br><span class="line">...</span><br><span class="line">data.append(<span class="string">'file'</span>, event.dataTransfer.files[<span class="number">0</span>]);</span><br><span class="line">xhr.send(data)</span><br></pre></td></tr></table></figure>
<h2 id="25-5-Web-Timing"><a href="#25-5-Web-Timing" class="headerlink" title="25.5 Web Timing"></a>25.5 Web Timing</h2><p>Reason: value page performance</p>
<h2 id="25-6-Web-Workers"><a href="#25-6-Web-Workers" class="headerlink" title="25.6 Web Workers"></a>25.6 Web Workers</h2><p>Reason: allow uds to run asynchronous JavaScript that will not block the user interface</p>
<h4 id="Implementation-2"><a href="#Implementation-2" class="headerlink" title="Implementation:"></a>Implementation:</h4><ul>
<li><p>Page:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">"xx.js"</span>);</span><br><span class="line">woder.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.data;  <span class="comment">// Formatted return data</span></span><br><span class="line">&#125;</span><br><span class="line">worker.postmessage(data);</span><br></pre></td></tr></table></figure>
</li>
<li><p>xx.js(worker):</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = event.data;</span><br><span class="line">    data.sort();</span><br><span class="line">    self.postMessage(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Other functions:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>worker.terminate()</td>
<td>stop worker in page</td>
</tr>
<tr>
<td>self.close()</td>
<td>stop working in xx.js</td>
</tr>
<tr>
<td>importScripts()</td>
<td>import script in xx.js</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/19/Flask-3-Context-Management/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/19/Flask-3-Context-Management/" class="post-title-link" itemprop="url">Flask-3-Context-Management</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-19 18:26:28 / Modified: 19:20:50" itemprop="dateCreated datePublished" datetime="2019-04-19T18:26:28-06:00">2019-04-19</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Context-Management"><a href="#Context-Management" class="headerlink" title="Context Management"></a>Context Management</h1><h2 id="1-Storage-Management"><a href="#1-Storage-Management" class="headerlink" title="1 Storage Management"></a>1 Storage Management</h2><p>Flask support Coroutines by dict and <code>greenlet.getcurrent</code>, it allocates space for each greenlet and store them in a dictionary</p>
<ol>
<li>create a dictionary called <code>__storage__</code></li>
<li>set, get from <code>__storage__</code> using <code>greenlet.getcurrent</code> as key</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> greenlet <span class="keyword">import</span> getcurrent <span class="keyword">as</span> get_ident</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">from</span> thread <span class="keyword">import</span> get_ident</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">from</span> _thread <span class="keyword">import</span> get_ident</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Local</span><span class="params">(object)</span>:</span></span><br><span class="line">    __slots__ = (<span class="string">'__storage__'</span>, <span class="string">'__ident_func__'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        object.__setattr__(self, <span class="string">'__storage__'</span>, &#123;&#125;)</span><br><span class="line">        object.__setattr__(self, <span class="string">'__ident_func__'</span>, get_ident)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> iter(self.__storage__.items())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""Create a proxy for a name."""</span></span><br><span class="line">        <span class="keyword">return</span> LocalProxy(self, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__release_local__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__storage__.pop(self.__ident_func__(), <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.__storage__[self.__ident_func__()][name]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, name, value)</span>:</span></span><br><span class="line">        ident = self.__ident_func__()</span><br><span class="line">        storage = self.__storage__</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            storage[ident][name] = value</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            storage[ident] = &#123;name: value&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">del</span> self.__storage__[self.__ident_func__()][name]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(name)</span><br></pre></td></tr></table></figure>
<h2 id="2-Request-Context"><a href="#2-Request-Context" class="headerlink" title="2 Request Context"></a>2 Request Context</h2><ul>
<li>Request context includes request and session</li>
<li>Basically, each request comes<ol>
<li>Capsulate <code>environ</code> into a <code>RequestContext</code> object</li>
<li>Add it into <code>__storage__</code> dictionary</li>
<li>Dispatch request to each view file and do operation</li>
<li>Remove it from <code>__storage__</code> dictionary</li>
</ol>
</li>
</ul>
<p>Picture for step 1, 2, 4</p>
<p><img src="/2019/04/19/Flask-3-Context-Management/ctx.png" alt="RequestContext"></p>
<p>Picture for step 3 example</p>
<p><img src="/2019/04/19/Flask-3-Context-Management/ctx_request.png" alt="Request"></p>
<blockquote>
<p><code>partial()</code>: it is quite funcional programming<br><code>object.__setattr__(self, &#39;_LocalProxy__local&#39;, local)</code>: stuck here for quite a while. <a href="https://docs.python.org/3.7/tutorial/classes.html#private-variables" target="_blank" rel="noopener">python3 documentation</a></p>
</blockquote>
<h2 id="3-App-Context"><a href="#3-App-Context" class="headerlink" title="3 App Context"></a>3 App Context</h2><ul>
<li>It is quite similar as Request Context</li>
<li>It includes <code>current_app</code> and <code>g</code></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/07/Flask-2-Dispatching-Request/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/07/Flask-2-Dispatching-Request/" class="post-title-link" itemprop="url">Flask-2-Dispatching-Request</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-07 17:56:52 / Modified: 18:24:42" itemprop="dateCreated datePublished" datetime="2019-04-07T17:56:52-06:00">2019-04-07</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="A-simple-Flask-server"><a href="#A-simple-Flask-server" class="headerlink" title="A simple Flask server"></a>A simple Flask server</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route('/') # -------------------- 2</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run() <span class="comment"># ---------------------- 1</span></span><br></pre></td></tr></table></figure>
<h2 id="1-Flask-Request-Entry"><a href="#1-Flask-Request-Entry" class="headerlink" title="1 Flask Request Entry"></a>1 Flask Request Entry</h2><p>This is a simple werkzeug server</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.wrappers <span class="keyword">import</span> Request, Response</span><br><span class="line"></span><br><span class="line"><span class="meta">@Request.application</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Response(<span class="string">'Hello World!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">from</span> werkzeug.serving <span class="keyword">import</span> run_simple</span><br><span class="line">    <span class="comment"># listen to `http://localhost:4000/` and do a hello() once we visit it.</span></span><br><span class="line">    run_simple(<span class="string">'localhost'</span>, <span class="number">4000</span>, hello)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>app.run()</code>: bases on <code>werkzeug.serving.run_simple(host, port, self, **options)</code>. So once we visit its route, the entry of Flask application is app(), which is the <code>Flask.__call__</code>.</li>
<li><code>Flask.__call__</code>: use wsgi_app <ul>
<li><code>return self.wsgi_app(environ, start_response)</code></li>
</ul>
</li>
<li>In the end, the real entry is <code>wsgi_app(environ, start_response)</code></li>
</ul>
<h2 id="2-Route-Register"><a href="#2-Route-Register" class="headerlink" title="2 Route Register"></a>2 Route Register</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br></pre></td></tr></table></figure>
<p>This <a href="https://yuhan19.github.io/2019/01/13/Flask-1-Decorator/" target="_blank" rel="noopener">Python Decorator</a> is equivalant to</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span></span><br><span class="line">app.route(<span class="string">"/"</span>)(hello_world)</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>app.route()</code>:  base on self.add_url_rule(rule, endpoint, f, **options). It binds a function with a url. So these two are equivalant </p>
<ul>
<li><code>app.add_url_rule(&quot;/&quot;, hello_world.__name__, hello_world)</code></li>
<li><code>app.route(&quot;/&quot;)(hello_world)</code></li>
</ul>
</li>
<li><p><code>add_url_rule(rule, endpoint, view_func)</code>:</p>
<ul>
<li><code>rule = self.url_rule_class(rule, methods=methods, **options)</code>: combine url, methods(post, get…), endpoint together</li>
<li><code>self.url_map.add(rule)</code>: this url_map is werkzeug.routing.Map</li>
<li><code>self.view_function[endpoint] = view_func</code>, it binds endpoint with function and is used when dispatching request</li>
</ul>
</li>
</ul>
<h2 id="3-Dispatching-Request"><a href="#3-Dispatching-Request" class="headerlink" title="3 Dispatching Request"></a>3 Dispatching Request</h2><p>From <a href="#1-Flask-Request-Entry">Flask Request Entry</a>, the real request entry is <code>wsgi_app(environ, start_response)</code>, What does it do with the Routing system ?</p>
<ol>
<li>push <code>request_context</code> into context</li>
<li><code>Flask.dispatch_request</code><ul>
<li><code>return self.view_functions[rule.endpoint](**req.view_args)</code></li>
</ul>
</li>
</ol>
<p>Finally, it is equal to <code>return hello_world()</code></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/10/Robotframework-Learning-Note/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/10/Robotframework-Learning-Note/" class="post-title-link" itemprop="url">Robotframework Learning Note</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-10 16:06:45" itemprop="dateCreated datePublished" datetime="2019-03-10T16:06:45-06:00">2019-03-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-13 21:34:33" itemprop="dateModified" datetime="2019-03-13T21:34:33-06:00">2019-03-13</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-Getting-started"><a href="#1-Getting-started" class="headerlink" title="1   Getting started"></a>1   Getting started</h1><p>3 ways of execution:</p>
<ul>
<li><code>robot init.robot</code> or</li>
<li><code>python3 robot -m init.robot</code> or</li>
<li><code>python3 xx/python3.7/site-packages/robot/run.py init.robot</code></li>
</ul>
<h1 id="2-Creating-test-data"><a href="#2-Creating-test-data" class="headerlink" title="2   Creating test data"></a>2   Creating test data</h1><h2 id="2-1-Test-data-syntax"><a href="#2-1-Test-data-syntax" class="headerlink" title="2.1   Test data syntax"></a>2.1   Test data syntax</h2><h3 id="2-1-1-Files-and-directories"><a href="#2-1-1-Files-and-directories" class="headerlink" title="2.1.1   Files and directories"></a>2.1.1   Files and directories</h3><p>TestSuites(a test project) contain:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Test files</td>
<td>contains test cases</td>
</tr>
<tr>
<td>Initialization file</td>
<td>configure the created test suite dir    </td>
</tr>
<tr>
<td>Test library</td>
<td>lowest level keywords</td>
</tr>
<tr>
<td>Resource files</td>
<td>variables and keywords</td>
</tr>
<tr>
<td>Variable files</td>
<td>able to dynamically create variables, which is more flexible than resource files</td>
</tr>
</tbody>
</table>
<h3 id="2-1-2-Test-data-section"><a href="#2-1-2-Test-data-section" class="headerlink" title="2.1.2   Test data section"></a>2.1.2   Test data section</h3><p>A test file contains:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Settings</td>
<td>importing test libraries, resource files and variable files, Documentation, Metadata, Suite Setup/Teardown</td>
</tr>
<tr>
<td>Variables</td>
<td>defining variables (global to each test case)</td>
</tr>
<tr>
<td>Test cases</td>
<td>creating test cases using keywords</td>
</tr>
<tr>
<td>Tasks<br>(new feature)</td>
<td>like test cases. a single file can only contain either test cases or task</td>
</tr>
<tr>
<td>Keywords</td>
<td>Creating user keywords</td>
</tr>
</tbody>
</table>
<p><strong>Sometimes Section is also called table ! e.g. variable table</strong></p>
<h3 id="2-1-3-Supported-file-formats"><a href="#2-1-3-Supported-file-formats" class="headerlink" title="2.1.3   Supported file formats"></a>2.1.3   Supported file formats</h3><p>html, tsv, txt, robot(recommended), rst</p>
<h3 id="2-1-4-Rules-for-parsing-the-data"><a href="#2-1-4-Rules-for-parsing-the-data" class="headerlink" title="2.1.4   Rules for parsing the data"></a>2.1.4   Rules for parsing the data</h3><ul>
<li>Ignore data: lots of rules, basically # is used for comment</li>
<li>Escaping: \</li>
<li>Special sequences: \n, \r, \t, \x, \u, \U</li>
<li>Some useful BuiltIn libraries. e.g. Convert To Bytes, ${\n}, ${EMPTY}, ${SPACE}</li>
<li><p>Multiple line: use … It is useful for keywords, documentation, variables</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@&#123;LIST&#125;    1    2    3    4</span><br><span class="line">...    5    6</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-2-Creating-test-cases"><a href="#2-2-Creating-test-cases" class="headerlink" title="2.2   Creating test cases"></a>2.2   Creating test cases</h2><h3 id="2-2-1-Test-cases-syntax"><a href="#2-2-1-Test-cases-syntax" class="headerlink" title="2.2.1   Test cases syntax"></a>2.2.1   Test cases syntax</h3><ul>
<li>Keywords can be imported from Library, Resource or keyword table</li>
<li>Each test case can have:<ul>
<li>[Documentation]</li>
<li>[Tags]</li>
<li>[Setup], [Teardown]</li>
<li>[Timeout]</li>
<li>[Template]: data driven test, mentioned in 2.2.7</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-Arguments"><a href="#2-2-2-Arguments" class="headerlink" title="2.2.2   Arguments"></a>2.2.2   Arguments</h3><p>Behaves like python:</p>
<ul>
<li>Positional arguments</li>
<li>Default value arguments</li>
<li>Variable number of arguments</li>
<li>Named arguments</li>
<li>**kargs</li>
</ul>
<h3 id="2-2-3-Failures"><a href="#2-2-3-Failures" class="headerlink" title="2.2.3   Failures"></a>2.2.3   Failures</h3><ul>
<li>If a test case fails, rest test cases will still run</li>
<li>We can specify failure reason e.g.<ul>
<li><code>Should Be True    ${result}    xx is not true</code></li>
</ul>
</li>
<li>Continue on failure: 3.2.2</li>
</ul>
<h3 id="2-2-4-Test-case-name-and-documentation"><a href="#2-2-4-Test-case-name-and-documentation" class="headerlink" title="2.2.4   Test case name and documentation"></a>2.2.4   Test case name and documentation</h3><ul>
<li>${TEST_NAME} refer to the test name. More in 2.6.4 Built-in variables</li>
<li>The [Documentation] in test case shows in the command line and test reports.</li>
</ul>
<h3 id="2-2-5-Tagging-test-cases"><a href="#2-2-5-Tagging-test-cases" class="headerlink" title="2.2.5   Tagging test cases"></a>2.2.5   Tagging test cases</h3><ul>
<li>–include, –exclude to run test cases</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th>Location</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Force Tags</td>
<td>Setting table</td>
<td>Set tags all test cases in this file. If it is in init file, all sub test suite dir are tags as it</td>
</tr>
<tr>
<td>Default Tags</td>
<td>Setting table</td>
<td>Set tags for test cases without [Tag]. Cannot use in init file</td>
</tr>
<tr>
<td>Tags</td>
<td>Test Case table</td>
<td>set tag for test case. Can override Default Tags. Can also be NONE</td>
</tr>
<tr>
<td>BuiltIn keywords</td>
<td></td>
<td>Dynamically set tags: Set Tags, Remove Tags, Fail and Pass Execution keywords, </td>
</tr>
</tbody>
</table>
<h3 id="2-2-6-Test-setup-and-teardown"><a href="#2-2-6-Test-setup-and-teardown" class="headerlink" title="2.2.6   Test setup and teardown"></a>2.2.6   Test setup and teardown</h3><ul>
<li>Test Setup, Teardown can take care of only 1 task: <ul>
<li>Use user defined keywords</li>
<li>Use builtIn “Run Keywords”</li>
</ul>
</li>
<li>Each test case can have its own [Setup], [Teardown] to override the one in Settings</li>
<li>Detail is in 3.2.1 Execution Flow</li>
</ul>
<h3 id="2-2-7-Test-templates"><a href="#2-2-7-Test-templates" class="headerlink" title="2.2.7   Test templates"></a>2.2.7   Test templates</h3><ul>
<li>Convert keyword-driven test cases into data-driven tests.</li>
<li>It’s like I have a method that need to be tested for lots of pairs of different arguments and expected output.</li>
<li><p>Example</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*** Test Cases ***</span><br><span class="line">Template with embedded arguments</span><br><span class="line">    [Template]    The result of $&#123;calculation&#125; should be $&#123;expected&#125;</span><br><span class="line">    1 + 1    2</span><br><span class="line">    1 + 2    3</span><br><span class="line"></span><br><span class="line">*** Keywords ***</span><br><span class="line">The result of $&#123;calculation&#125; should be $&#123;expected&#125;</span><br><span class="line">    $&#123;result&#125; =    Calculate    $&#123;calculation&#125;</span><br><span class="line">    Should Be Equal    $&#123;result&#125;     $&#123;expected&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-2-8-Different-test-case-styles"><a href="#2-2-8-Different-test-case-styles" class="headerlink" title="2.2.8   Different test case styles"></a>2.2.8   Different test case styles</h3><ul>
<li>Keyword-driven: normal</li>
<li>Data-driven: using template</li>
<li>Behavior-driven: using Given, When, Then, And, But<ul>
<li>Given: initial state</li>
<li>When: operation</li>
<li>Then: expected result</li>
<li>And, But: connect keywords</li>
</ul>
</li>
</ul>
<h2 id="2-3-Creating-Tasks"><a href="#2-3-Creating-Tasks" class="headerlink" title="2.3   Creating Tasks"></a>2.3   Creating Tasks</h2><p>new feature after Robotframework 3.1</p>
<h2 id="2-4-Creating-test-suites"><a href="#2-4-Creating-test-suites" class="headerlink" title="2.4   Creating test suites"></a>2.4   Creating test suites</h2><h3 id="2-4-1-Test-case-files"><a href="#2-4-1-Test-case-files" class="headerlink" title="2.4.1   Test case files"></a>2.4.1   Test case files</h3><p>In Setting table, we can have</p>
<ul>
<li>Documentation</li>
<li>Metadata</li>
<li>Suite Setup</li>
<li>Suit Teardown</li>
</ul>
<h3 id="2-4-2-Test-suite-directories"><a href="#2-4-2-Test-suite-directories" class="headerlink" title="2.4.2   Test suite directories"></a>2.4.2   Test suite directories</h3><p>Initialization files: </p>
<ul>
<li>For specifying test suite related settings</li>
<li>Similar as test case files, but cannot have test case tables and not all settings are supported.</li>
<li>Library, resource, variable, keywords cannot applied to other files !!!</li>
</ul>
<h3 id="2-4-3-Test-suite-name-and-documentation"><a href="#2-4-3-Test-suite-name-and-documentation" class="headerlink" title="2.4.3   Test suite name and documentation"></a>2.4.3   Test suite name and documentation</h3><ul>
<li>Test suite name <ul>
<li>name is constructed from fire name</li>
<li>underscore -&gt; space</li>
<li>e.g. some_tests.robot -&gt; Some Tests</li>
<li>Execution order: by file name. Detail in 3.2.1 Execution flow</li>
</ul>
</li>
</ul>
<h3 id="2-4-4-Free-test-suite-metadata"><a href="#2-4-4-Free-test-suite-metadata" class="headerlink" title="2.4.4   Free test suite metadata"></a>2.4.4   Free test suite metadata</h3><h3 id="2-4-5-Suite-setup-and-teardown"><a href="#2-4-5-Suite-setup-and-teardown" class="headerlink" title="2.4.5   Suite setup and teardown"></a>2.4.5   Suite setup and teardown</h3><ul>
<li>Suite setup is executed before any of suite’s test cases or child test suites. Suite setup fails, all testcase fails</li>
<li>Suite teardown is executed after everything, even suite setup fails.</li>
<li>They can be set in init file</li>
</ul>
<h2 id="2-5-Using-test-libraries"><a href="#2-5-Using-test-libraries" class="headerlink" title="2.5   Using test libraries"></a>2.5   Using test libraries</h2><h3 id="2-5-1-Importing-libraries"><a href="#2-5-1-Importing-libraries" class="headerlink" title="2.5.1   Importing libraries"></a>2.5.1   Importing libraries</h3><ul>
<li>Library: used in Settings table</li>
<li>Import Library: used in test cases dynamically</li>
</ul>
<h3 id="2-5-2-Specifying-library-to-import"><a href="#2-5-2-Specifying-library-to-import" class="headerlink" title="2.5.2   Specifying library to import"></a>2.5.2   Specifying library to import</h3><ul>
<li>System tries to find the library from the module search path including PYTHONPATH</li>
<li><p>Using relative, absolute path</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*** Settings ***</span><br><span class="line">Library    PythonLibrary.py</span><br><span class="line">Library    /absolute/path/JavaLibrary.java</span><br><span class="line">Library    relative/path/PythonDirLib/    possible    arguments</span><br><span class="line">Library    $&#123;RESOURCES&#125;/Example.class</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-5-3-Setting-custom-name-to-test-library"><a href="#2-5-3-Setting-custom-name-to-test-library" class="headerlink" title="2.5.3   Setting custom name to test library"></a>2.5.3   Setting custom name to test library</h3><p>We can initialize 2 python class using this way. e.g.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Library    xx    arg1    WITH NAME    TestLib1</span><br><span class="line">Library    xx    arg2    WITH NAME    TestLib2</span><br></pre></td></tr></table></figure>
<h3 id="2-5-4-Standard-libraries"><a href="#2-5-4-Standard-libraries" class="headerlink" title="2.5.4   Standard libraries"></a>2.5.4   Standard libraries</h3><h3 id="2-5-5-External-libraries"><a href="#2-5-5-External-libraries" class="headerlink" title="2.5.5   External libraries"></a>2.5.5   External libraries</h3><h2 id="2-6-Variables"><a href="#2-6-Variables" class="headerlink" title="2.6   Variables"></a>2.6   Variables</h2><h3 id="2-6-1-Introduction"><a href="#2-6-1-Introduction" class="headerlink" title="2.6.1   Introduction"></a>2.6.1   Introduction</h3><ul>
<li>&amp;{} dictionary</li>
<li>${} variable</li>
<li>@{} list</li>
<li>%{} environment</li>
</ul>
<h3 id="2-6-2-Using-variables"><a href="#2-6-2-Using-variables" class="headerlink" title="2.6.2   Using variables"></a>2.6.2   Using variables</h3><ul>
<li>Naming rules:<ul>
<li>Case insensitive, ignore underscore and space</li>
<li>Global variables naming rule: upper case</li>
</ul>
</li>
<li><p>${} variables</p>
<ul>
<li>Can contain any object, including numbers, lists, dictionaries, or even custom objects.</li>
<li><p>With other string or variable, this variable will convert to its <strong>unicode</strong> | <strong>str</strong> e.g.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;VAR&#125; is an object</span><br><span class="line">Method    $&#123;VAR&#125;    # Method gets an object</span><br><span class="line">Method    Hi $&#123;VAR&#125; # Method gets a string</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>@{} list</p>
<ul>
<li><p>Not a true list argument !!! We should use ${} to parse a list variable as argument, since these are equivalent.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@&#123;USER&#125;    robot    secret</span><br><span class="line">Login    robot    secret</span><br><span class="line">Login    @&#123;USER&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Accessing list items</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@&#123;STRINGS&#125;    one    two    kolme    four</span><br><span class="line">$&#123;STRINGS&#125;[2:-1:2]  # Start from 2 until last one, step 2</span><br><span class="line">@&#123;STRINGS&#125;[index] # Old syntax. Do not use it</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>&amp;{} dictionary</p>
<ul>
<li><p>Not a true dictionary argument !!! We should use ${} to parse a list variable as argument, since these are equivalent.</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;&#123;USER&#125;    name=robot    password=secret</span><br><span class="line">Login    name=robot    password=secret</span><br><span class="line">Login    &amp;&#123;USER&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Accessing list items<br>  <code>${USER.name}</code> or <code>${USER}[name]</code></p>
</li>
</ul>
</li>
<li><p>%{} environment variables</p>
<ul>
<li>Keyword: Set Environment Variable</li>
<li>Keyword: Delete Environment Variable</li>
</ul>
</li>
</ul>
<h3 id="2-6-3-Creating-variables"><a href="#2-6-3-Creating-variables" class="headerlink" title="2.6.3   Creating variables"></a>2.6.3   Creating variables</h3><ol>
<li><p>Variable table in test case file or resource file</p>
<ul>
<li>Cannot create dynamic variables</li>
<li><p>Syntax can be either</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;NAME&#125;    robot</span><br><span class="line">$&#123;NAME&#125; =    robot</span><br><span class="line">@&#123;LIST&#125;         one         two</span><br><span class="line">&amp;&#123;DICT&#125;    first=one    second=two</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Variable file</p>
<ul>
<li><code>robot --variablefile xx.py test.robot</code></li>
<li><strong>Global to all testcases</strong></li>
</ul>
</li>
<li><p>Command line variables</p>
<ul>
<li><code>robot --variable NAME:robot</code></li>
<li><strong>Global to all testcases</strong></li>
</ul>
</li>
<li><p>BuiltIn keywords for local variables</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@&#123;list&#125; =    Create List    1    2</span><br><span class="line">$&#123;list&#125; =    Create List    1    2</span><br><span class="line">$&#123;dict&#125; =    Create Dictionary    1    2</span><br><span class="line">&amp;&#123;dict&#125; =    Create Dictionary    1    2</span><br><span class="line">$&#123;a&#125;    $&#123;b&#125; =    Create List    1    2</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="5">
<li>Set Test/Suite/Global Variable keywords<ul>
<li>Set Test Variable: visible in this test case</li>
<li>Set Suite Variable: visible in this test suite (all test cases in this file)</li>
<li>Set Global Variable: visible in global, like -variable</li>
</ul>
</li>
</ol>
<h3 id="2-6-4-Built-in-variables"><a href="#2-6-4-Built-in-variables" class="headerlink" title="2.6.4   Built-in variables"></a>2.6.4   Built-in variables</h3><ul>
<li>Operating-system variables<ul>
<li><code>${CURDIR}</code></li>
<li><code>${TEMPDIR}</code></li>
<li><code>${EXECDIR}</code></li>
<li><code>${/}</code>: path separator</li>
<li><code>${:}</code>: path separator</li>
<li><code>${\n}</code>: system line separator</li>
</ul>
</li>
<li>Number variables<ul>
<li>int <code>${80}</code></li>
<li>float <code>${3.14}</code></li>
<li>scientific <code>${-1e-4}</code>  </li>
<li>binary <code>${0b1011}</code></li>
<li>octal <code>${0o10}</code></li>
<li>hex <code>${0xff}</code></li>
</ul>
</li>
<li>Boolean<ul>
<li>case insensitive</li>
<li><code>${true} ${false}</code></li>
</ul>
</li>
<li>Null<ul>
<li>case insensitive</li>
<li><code>${none} ${null}</code></li>
</ul>
</li>
<li>Space and empty variables<ul>
<li><code>Should Be Equal    {SPACE * 4}    \ \ \ \</code></li>
<li><code>${EMPTY}    @{EMPTY LIST}    &amp;{EMPTY DICT}</code></li>
</ul>
</li>
<li>Automatic variables<ul>
<li>It is like metadata of robot test<br>  <code>${TEST NAME} ${SUITE NAME} ${PREV TEST NAME} ${OUTPUT DIR}</code></li>
</ul>
</li>
</ul>
<h3 id="2-6-5-Variable-priorities-and-scopes"><a href="#2-6-5-Variable-priorities-and-scopes" class="headerlink" title="2.6.5   Variable priorities and scopes"></a>2.6.5   Variable priorities and scopes</h3><h4 id="Priorities"><a href="#Priorities" class="headerlink" title="Priorities"></a>Priorities</h4><ol>
<li>Variable set during test execution<ul>
<li>e.g. Create List or return value</li>
<li>e.g. Set Test/Suite/Global Variable keywords</li>
<li>Highest priority</li>
<li>Cannot affect variables not in its scope</li>
</ul>
</li>
<li>–variable: <ul>
<li>Second priority</li>
<li>Last one override others</li>
<li>Override all others</li>
</ul>
</li>
<li>–variablefile: <ul>
<li>Third priority</li>
<li>Variable in first file override others</li>
</ul>
</li>
<li>Variable table<ul>
<li>Forth priority</li>
<li>visible to all test case in this file</li>
</ul>
</li>
<li>Imported resource and variable files<ul>
<li>Lowest</li>
</ul>
</li>
<li>Built-in variables<ul>
<li>This is special case. I don’t think it should be discussed here</li>
</ul>
</li>
</ol>
<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><ul>
<li>Global scope: –variable, –variablefile, Built-in variables, Set Global Variable</li>
<li>Test suite scope<ul>
<li>Not recursive: higher-level test suite are not available in lower-level suites</li>
<li>Set Suite Variable, Imported resource and variable files, Variable table</li>
</ul>
</li>
<li>Test case scope: return value from keywords</li>
</ul>
<h3 id="2-6-6-Advanced-variable-features-interesting"><a href="#2-6-6-Advanced-variable-features-interesting" class="headerlink" title="2.6.6   Advanced variable features (interesting)"></a>2.6.6   Advanced variable features (interesting)</h3><ul>
<li><p>Extended variable syntax</p>
<ul>
<li><p>The expression inside the curly brackets is evaluated as a Python expression</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Keyword1    $&#123;OBJECT.eat(&apos;Cucumber&apos;)&#125;</span><br><span class="line">Keyword2    $&#123;OBJECT.name&#125;</span><br><span class="line">Keyword3    $&#123;DICT[2]&#125;</span><br><span class="line"></span><br><span class="line">$&#123;string&#125; =    Set Variable    abc</span><br><span class="line">Log    $&#123;string.upper()&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Extended variable syntax assignment<br>  <code>${OBJECT.name} =    Set Variable    New name</code></p>
</li>
<li><p>Variables inside variables</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;JOHN HOME&#125;    /home/john</span><br><span class="line">$&#123;JANE HOME&#125;    /home/jane</span><br><span class="line"></span><br><span class="line">$&#123;name&#125; =    Get Name</span><br><span class="line">Keyword    $&#123;$&#123;name&#125; HOME&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="2-7-Creating-user-keywords"><a href="#2-7-Creating-user-keywords" class="headerlink" title="2.7   Creating user keywords"></a>2.7   Creating user keywords</h2><h3 id="2-7-1-User-keyword-syntax"><a href="#2-7-1-User-keyword-syntax" class="headerlink" title="2.7.1   User keyword syntax"></a>2.7.1   User keyword syntax</h3><ul>
<li>Keywords in init file are not visible in other files, neither files in same directory or sub-directory</li>
<li>Can only resource another file to use its keywords</li>
<li>Settings in Keyword: <ul>
<li>[Documentation]</li>
<li>[Tags]</li>
<li>[Arguments]</li>
<li>[Return]</li>
<li>[Teardown]</li>
<li>[Timeout]</li>
</ul>
</li>
</ul>
<h3 id="2-7-2-User-keyword-name-and-documentation"><a href="#2-7-2-User-keyword-name-and-documentation" class="headerlink" title="2.7.2   User keyword name and documentation"></a>2.7.2   User keyword name and documentation</h3><h3 id="2-7-3-User-keyword-tags"><a href="#2-7-3-User-keyword-tags" class="headerlink" title="2.7.3   User keyword tags"></a>2.7.3   User keyword tags</h3><h3 id="2-7-4-User-keyword-arguments"><a href="#2-7-4-User-keyword-arguments" class="headerlink" title="2.7.4   User keyword arguments"></a>2.7.4   User keyword arguments</h3><ul>
<li>Positional</li>
<li>Default values</li>
<li><p>Variable number of arguments</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*** Test Cases ***</span><br><span class="line">Example</span><br><span class="line">	Two Arguments With Defaults    arg2=abcd</span><br><span class="line">*** Keywords ***</span><br><span class="line">One Required And One With Default</span><br><span class="line">    [Arguments]    $&#123;required&#125;    $&#123;optional&#125;=default</span><br><span class="line">Two Arguments With Defaults</span><br><span class="line">    [Arguments]    $&#123;arg1&#125;=default 1    $&#123;arg2&#125;=$&#123;VARIABLE&#125;</span><br><span class="line">Required, Default, Varargs</span><br><span class="line">    [Arguments]    $&#123;req&#125;    $&#123;opt&#125;=42    @&#123;others&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Free named arguments: like **kargs in python<br>  <code>[Arguments]    ${required}    &amp;{kargs}</code></p>
</li>
<li>Named-only arguments with user keywords<ul>
<li>New feature after 3.1</li>
<li>Specify named argument after @{varargs} or after @{}</li>
<li>With Varargs<br>  <code>[Arguments]    @{varargs}    ${named}</code></li>
<li>Without Varargs<br>  <code>[Arguments]    @{}    ${named}</code></li>
</ul>
</li>
</ul>
<h3 id="2-7-5-Embedding-arguments-into-keyword-name"><a href="#2-7-5-Embedding-arguments-into-keyword-name" class="headerlink" title="2.7.5   Embedding arguments into keyword name"></a>2.7.5   Embedding arguments into keyword name</h3><h4 id="Confused-space-with-sequential-word"><a href="#Confused-space-with-sequential-word" class="headerlink" title="Confused space with sequential word"></a>Confused space with sequential word</h4><ul>
<li><code>Select ${city} ${name}</code></li>
<li><code>Select Los Angeles Lakers</code> will be confused</li>
<li><p>Have to use “” to wrap it</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*** Keywords ***</span><br><span class="line">Select &quot;$&#123;city&#125;&quot; &quot;$&#123;team&#125;&quot; from list</span><br><span class="line">    Log    $&#123;city&#125; $&#123;team&#125;</span><br><span class="line">	</span><br><span class="line">Select &quot;Los Angeles&quot; &quot;Lakers&quot; from list</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Embedded-arguments-matching-rule"><a href="#Embedded-arguments-matching-rule" class="headerlink" title="Embedded arguments matching rule"></a>Embedded arguments matching rule</h4><ul>
<li><p>Regular expressions: every argument in the name is replaced with a pattern .*? that basically matches any string. </p>
<ul>
<li><p>Example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I execute &quot;ls&quot; with &quot;-lh&quot;, will match both</span><br><span class="line">	I execute &quot;$&#123;cmd&#125;&quot;</span><br><span class="line">	I execute &quot;$&#123;cmd&#125;&quot; with &quot;$&#123;opts&#125;&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Solution<br>  <code>I execute &quot;${cmd:[^&quot;]+}&quot;</code></p>
</li>
</ul>
</li>
</ul>
<h4 id="Escaping-special-characters"><a href="#Escaping-special-characters" class="headerlink" title="Escaping special characters"></a>Escaping special characters</h4><p>like }, \</p>
<h3 id="2-7-6-User-keyword-return-values"><a href="#2-7-6-User-keyword-return-values" class="headerlink" title="2.7.6   User keyword return values"></a>2.7.6   User keyword return values</h3><ul>
<li><p>Using [Return] setting</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;a&#125;    $&#123;b&#125;    $&#123;c&#125; =    Return Three Values</span><br><span class="line">@&#123;list&#125; =    Return Three Values</span><br><span class="line">$&#123;scalar&#125;    @&#123;rest&#125; =    Return Three Values</span><br><span class="line"></span><br><span class="line">Return Three Values</span><br><span class="line">	[Return]    foo    bar    zap</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Using special keywords to return<ul>
<li><code>Return From Keyword</code></li>
<li><code>Return From Keyword If</code></li>
</ul>
</li>
</ul>
<h3 id="2-7-7-User-keyword-teardown"><a href="#2-7-7-User-keyword-teardown" class="headerlink" title="2.7.7   User keyword teardown"></a>2.7.7   User keyword teardown</h3><h2 id="2-8-Resource-and-variable-files"><a href="#2-8-Resource-and-variable-files" class="headerlink" title="2.8   Resource and variable files"></a>2.8   Resource and variable files</h2><p>User <strong>keywords</strong> and <strong>variables</strong> in test case files and test suite initialization files can <strong>only be used</strong> in files where they are created</p>
<h3 id="2-8-1-Resource-files"><a href="#2-8-1-Resource-files" class="headerlink" title="2.8.1   Resource files"></a>2.8.1   Resource files</h3><ul>
<li>Searching path<ul>
<li>Absolute path</li>
<li>Otherwise<ul>
<li>Relatively to the directory</li>
<li>PYTHONPATH</li>
</ul>
</li>
</ul>
</li>
<li>Resource file structure<ul>
<li>Settings can only have Library, Resource, Variables<br>Same keywords name from different resource file</li>
</ul>
</li>
<li>Distinguish by file name without extension<ul>
<li>myresources.Keyword</li>
<li>common.Keyword</li>
</ul>
</li>
</ul>
<h3 id="2-8-2-Variable-files"><a href="#2-8-2-Variable-files" class="headerlink" title="2.8.2   Variable files"></a>2.8.2   Variable files</h3><h4 id="Taking-variable-files-into-use"><a href="#Taking-variable-files-into-use" class="headerlink" title="Taking variable files into use"></a>Taking variable files into use</h4><ul>
<li><p>Settings</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*** Settings ***</span><br><span class="line">Variables    myvariables.py</span><br></pre></td></tr></table></figure>
</li>
<li><p>Command lines</p>
<p>  <code>---variablefile myvariables.py</code></p>
</li>
<li><p>Creating variables in python</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VAR = &quot;abcde&quot;</span><br><span class="line">VAR2 = method()</span><br><span class="line">def method():</span><br><span class="line">	return xxxxx</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Selecting-which-variables-to-include"><a href="#Selecting-which-variables-to-include" class="headerlink" title="Selecting which variables to include"></a>Selecting which variables to include</h4><ul>
<li>all variables not start with _ will be include as variables<ul>
<li>even <code>import math as _math</code> <code>def get_area()</code></li>
</ul>
</li>
<li>Or we can specify __all__ = [‘VARNAME2’, ‘VARNAME2’]. Only variables in __all__ can be used</li>
</ul>
<h4 id="Getting-variables-from-a-special-function"><a href="#Getting-variables-from-a-special-function" class="headerlink" title="Getting variables from a special function"></a>Getting variables from a special function</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def get_variables(arg):</span><br><span class="line">    if arg == &apos;a&apos;:</span><br><span class="line">        variables = &#123;&quot;BAR&quot;: 7&#125;</span><br><span class="line">    else:</span><br><span class="line">        variables = &#123;&quot;BAR&quot;: 77&#125;</span><br><span class="line">    return variables</span><br></pre></td></tr></table></figure>
<p><code>robot --variablefile ./varfile.py:a test.robot</code></p>
<h4 id="Implementing-variable-file-as-Python-or-Java-class-weird"><a href="#Implementing-variable-file-as-Python-or-Java-class-weird" class="headerlink" title="Implementing variable file as Python or Java class: weird"></a>Implementing variable file as Python or Java class: weird</h4><h4 id="Variable-file-as-YAML-weird"><a href="#Variable-file-as-YAML-weird" class="headerlink" title="Variable file as YAML: weird"></a>Variable file as YAML: weird</h4><h3 id="2-9-1-Handling-keywords-with-same-names"><a href="#2-9-1-Handling-keywords-with-same-names" class="headerlink" title="2.9.1   Handling keywords with same names"></a>2.9.1   Handling keywords with same names</h3><ul>
<li>Two kinds of keywords:<ol>
<li>Library keywords (from standard/external libraries)</li>
<li>User keywords (user created/resourced)</li>
</ol>
</li>
<li>Priority:<ul>
<li>Highest - Keywords created in current file</li>
<li>Second  - Resourced</li>
<li>Third   - External library</li>
<li>Lowest  - Standard library</li>
</ul>
</li>
<li>Solution:<ul>
<li>Specifying a keyword explicitly. e.g. <code>Libraryname.Run</code></li>
<li>Specifying explicit priority using keyword. e.g. <code>Set Library Search Order</code></li>
</ul>
</li>
</ul>
<h3 id="2-9-2-Timeouts"><a href="#2-9-2-Timeouts" class="headerlink" title="2.9.2   Timeouts"></a>2.9.2   Timeouts</h3><p>We can set [Timeout] in Settings(default timeout for all test cases), Test Cases, Keywords</p>
<h3 id="2-9-3-For-loops"><a href="#2-9-3-For-loops" class="headerlink" title="2.9.3   For loops"></a>2.9.3   For loops</h3><ul>
<li>Simple for loop</li>
<li>Nested for loops<ul>
<li>implemente by keyword</li>
</ul>
</li>
<li><p>Using several loop variables</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FOR    $&#123;index&#125;    $&#123;english&#125;    $&#123;finnish&#125;    IN</span><br><span class="line">   ...     1           cat           kissa</span><br><span class="line">   ...     2           dog           koira</span><br><span class="line">   ...     3           horse         hevonen</span><br><span class="line">FOR    $&#123;index&#125;    $&#123;english&#125;    $&#123;finnish&#125;    IN</span><br></pre></td></tr></table></figure>
</li>
<li><p>For-in-range loop: </p>
<p>   <code>for i in range(xx, xx):</code></p>
</li>
<li><p>For-in-enumerate loop</p>
<p>   <code>for index, item in enumerate(my_list):</code></p>
</li>
<li><p>For-in-zip loop</p>
<p>   <code>for i, j in zip(list1, list2):</code></p>
</li>
<li><p>Exiting for loop</p>
<ul>
<li>Exit For Loop<ul>
<li>Exit For Loo If</li>
</ul>
</li>
</ul>
</li>
<li>Continuing for loop<ul>
<li>Continue For Loop</li>
<li>Continue For Loop If</li>
</ul>
</li>
</ul>
<h4 id="Removing-unnecessary-keywords-from-outputs"><a href="#Removing-unnecessary-keywords-from-outputs" class="headerlink" title="Removing unnecessary keywords from outputs"></a>Removing unnecessary keywords from outputs</h4><p>Using command line option: –RemoveKeywords FOR</p>
<h4 id="Repeating-single-keyword"><a href="#Repeating-single-keyword" class="headerlink" title="Repeating single keyword"></a>Repeating single keyword</h4><p><code>Repeat Keyword    5    Some Keyword    arg1    arg2</code></p>
<h3 id="2-9-4-Conditional-execution"><a href="#2-9-4-Conditional-execution" class="headerlink" title="2.9.4   Conditional execution"></a>2.9.4   Conditional execution</h3><ul>
<li>Do not use if statement in Test Cases</li>
<li>Run Keyword: can set variable dynamically</li>
<li><p>If statement:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Run Keyword If    &apos;$&#123;status&#125;&apos; == &apos;good&apos;    action</span><br><span class="line">Run Keyword Unless    &apos;$&#123;status&#125;&apos; == &apos;good&apos;    another action</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p> or</p>
<p>  <code>Run Keyword If    &#39;${status}&#39; == &#39;good&#39;    action    ELSE    another action</code></p>
<h3 id="2-9-5-Parallel-execution-of-keywords"><a href="#2-9-5-Parallel-execution-of-keywords" class="headerlink" title="2.9.5   Parallel execution of keywords"></a>2.9.5   Parallel execution of keywords</h3><ul>
<li>Start Process</li>
<li>Read Process Output</li>
</ul>
<h1 id="3-Executing-test-cases"><a href="#3-Executing-test-cases" class="headerlink" title="3   Executing test cases"></a>3   Executing test cases</h1><h2 id="3-1-Basic-usage"><a href="#3-1-Basic-usage" class="headerlink" title="3.1   Basic usage"></a>3.1   Basic usage</h2><h3 id="3-1-1-Starting-test-execution"><a href="#3-1-1-Starting-test-execution" class="headerlink" title="3.1.1   Starting test execution"></a>3.1.1   Starting test execution</h3><h3 id="3-1-2-Using-command-line-options"><a href="#3-1-2-Using-command-line-options" class="headerlink" title="3.1.2   Using command line options"></a>3.1.2   Using command line options</h3><ul>
<li>Short and long options<ul>
<li><code>robot --name test.robot</code></li>
<li><code>robot -N test.robot</code></li>
</ul>
</li>
<li>Setting option values<ul>
<li><code>robot --include tag</code></li>
<li><code>robot -i tag</code></li>
<li><code>robot --include=tag</code></li>
<li><code>robot -itag</code></li>
</ul>
</li>
<li>Disabling options accepting no values<ul>
<li><code>robot --dryrun</code></li>
<li><code>robot --nodryrun</code></li>
</ul>
</li>
<li>Simple patterns<ul>
<li>pattern: *, ?</li>
<li><code>robot --include f??</code></li>
</ul>
</li>
<li>Tag patterns<ul>
<li>AND, &amp;<ul>
<li><code>robot --include xx&amp;yy</code></li>
<li><code>robot --include xxANDyy</code></li>
</ul>
</li>
<li>OR<ul>
<li><code>robot --include xxORyy</code></li>
</ul>
</li>
<li>NOT<ul>
<li><code>robot --include xxNOTyy</code></li>
</ul>
</li>
<li>priority: AND &gt; OR &gt; NOT</li>
</ul>
</li>
<li>ROBOT_OPTIONS and REBOT_OPTIONS environment variables<ul>
<li>ROBOT_OPTIONS: default option for test execution</li>
<li>REBOT_OPTIONS: default option for result post-processing</li>
</ul>
</li>
</ul>
<h3 id="3-1-3-Test-results"><a href="#3-1-3-Test-results" class="headerlink" title="3.1.3   Test results"></a>3.1.3   Test results</h3><ul>
<li>Command line output</li>
<li>Generated output files</li>
<li>Return codes<ul>
<li>Return code can be access by ‘echo $?’</li>
<li><code>--NoStatusRC</code>: can set return code to be 0</li>
</ul>
</li>
<li>Errors and warnings during execution</li>
</ul>
<h3 id="3-1-4-Argument-files"><a href="#3-1-4-Argument-files" class="headerlink" title="3.1.4   Argument files"></a>3.1.4   Argument files</h3><p>Extract all options and arguments into an external file</p>
<ul>
<li><p><code>--argumentfile xxxx</code></p>
</li>
<li><p><code>--argumentfile STDIN</code>: we are able to read argumentfile from standard input, so we can</p>
<ul>
<li><code>generate_argument.sh | robot --argumentfile STDIN</code></li>
</ul>
</li>
</ul>
<h3 id="3-1-5-Getting-help-and-version-information"><a href="#3-1-5-Getting-help-and-version-information" class="headerlink" title="3.1.5   Getting help and version information"></a>3.1.5   Getting help and version information</h3><h3 id="3-1-6-Creating-start-up-scripts"><a href="#3-1-6-Creating-start-up-scripts" class="headerlink" title="3.1.6   Creating start-up scripts"></a>3.1.6   Creating start-up scripts</h3><p>Modifying Java startup parameters</p>
<h3 id="3-1-7-Debugging-problems"><a href="#3-1-7-Debugging-problems" class="headerlink" title="3.1.7   Debugging problems"></a>3.1.7   Debugging problems</h3><ol>
<li>command line output</li>
<li>log file<ul>
<li>decrease loglevel, which shows in log.html</li>
<li>FAIL, WARN, INFO, DEBUG, TRACE</li>
<li><code>--loglevel DEBUG:INFO</code><br>add Log, Log Variables in BuiltIn Keyword</li>
</ul>
</li>
<li>Robot Framework bug: set env ROBOT_INTERNAL_TRACES to anything</li>
<li>Enable syslog</li>
<li>Using the Python debugger (pdb): never mind</li>
<li>Using Pycharm debugger. Edit configuration<ul>
<li>Script Path: /Users/xxx/.pyenv/versions/3.7.2/lib/python3.7/site-packages/robot/run.py</li>
<li>Parameters: we can also add other parameters here like <ul>
<li>e.g. –loglevel DEBUG /xxx/xxx/xxx.robot</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="3-2-1-Execution-flow"><a href="#3-2-1-Execution-flow" class="headerlink" title="3.2.1   Execution flow"></a>3.2.1   Execution flow</h3><p>Select test: <code>--test</code>, <code>--suite</code>, <code>--include</code>, <code>--exclude</code></p>
<h4 id="Suite-setup"><a href="#Suite-setup" class="headerlink" title="Suite setup:"></a>Suite setup:</h4><ul>
<li>if fail, all testcases, child suites won’t execute and will be marked failed as fail</li>
<li>Run before all tests and child suites</li>
</ul>
<h4 id="Suite-teardown"><a href="#Suite-teardown" class="headerlink" title="Suite teardown:"></a>Suite teardown:</h4><ul>
<li>if fail, all testcase marked failed. </li>
<li>Run even suite setup fail</li>
<li><p>Run all keywords in it, even some keywords in it failed</p>
</li>
<li><p>Test setup, Test teardown</p>
</li>
<li>Keyword teardown, <strong>No</strong> Keyword setup</li>
</ul>
<h4 id="Execution-order"><a href="#Execution-order" class="headerlink" title="Execution order:"></a>Execution order:</h4><ul>
<li>by filename </li>
<li>depth-first</li>
<li>if specify several tests, executed in the order they are given</li>
<li>add prefix to specify order<ul>
<li>01__my_suite.html -&gt; My Suite</li>
<li>02__another_suite.html -&gt; Another Suite</li>
</ul>
</li>
<li>randomize: –randomize</li>
</ul>
<h4 id="Passing-execution"><a href="#Passing-execution" class="headerlink" title="Passing execution:"></a>Passing execution:</h4><ul>
<li>Pass Execution/Pass Execution If<ul>
<li>Pass execution of testcases directly</li>
<li>Better to set testcase non-critical</li>
</ul>
</li>
</ul>
<h3 id="3-2-2-Continue-on-failure"><a href="#3-2-2-Continue-on-failure" class="headerlink" title="3.2.2   Continue on failure"></a>3.2.2   Continue on failure</h3><ul>
<li>Continue by keywords<ul>
<li><code>Run Keyword And Ignore Error</code></li>
<li><code>Run Keyword And Expect Error</code></li>
<li>Run Keyword And Continue On Failure</li>
</ul>
</li>
<li>Special failures<ul>
<li>by creating exception</li>
</ul>
</li>
<li>Execution continues on teardowns automatically</li>
<li>Execution continues on all data in templates</li>
</ul>
<h3 id="3-2-3-Stopping-test-execution-gracefully"><a href="#3-2-3-Stopping-test-execution-gracefully" class="headerlink" title="3.2.3   Stopping test execution gracefully"></a>3.2.3   Stopping test execution gracefully</h3><ul>
<li>Pressing Ctrl-C</li>
<li>Using signals: kill INT or kill TERM</li>
<li>Using keywords: Fatal Error or fatal exceptions</li>
<li>Stopping when first test case fails or execution error<ul>
<li>–exitonfailure: if any case fail, execution stop</li>
<li>–exitonerror: if any error, execution stop</li>
</ul>
</li>
<li>Handling teardowns<ul>
<li>–skipteardownonexit can skip teardown if execution stoped by above</li>
</ul>
</li>
</ul>
<h2 id="3-3-Task-execution"><a href="#3-3-Task-execution" class="headerlink" title="3.3   Task execution"></a>3.3   Task execution</h2><h2 id="3-4-Post-processing-outputs"><a href="#3-4-Post-processing-outputs" class="headerlink" title="3.4   Post-processing outputs"></a>3.4   Post-processing outputs</h2><ul>
<li>Integral part of Robot Framework for handling output files</li>
<li>command: rebot</li>
</ul>
<h2 id="3-5-Configuring-execution"><a href="#3-5-Configuring-execution" class="headerlink" title="3.5   Configuring execution"></a>3.5   Configuring execution</h2><h3 id="3-5-1-Selecting-files-to-parse"><a href="#3-5-1-Selecting-files-to-parse" class="headerlink" title="3.5.1   Selecting files to parse"></a>3.5.1   Selecting files to parse</h3><pre><code>--extension robot:text
</code></pre><h3 id="3-5-2-Selecting-test-cases"><a href="#3-5-2-Selecting-test-cases" class="headerlink" title="3.5.2   Selecting test cases"></a>3.5.2   Selecting test cases</h3><h4 id="Select-robot-files-to-run"><a href="#Select-robot-files-to-run" class="headerlink" title="Select robot files to run"></a>Select robot files to run</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--test *test</span><br><span class="line">--suite *test.xx</span><br><span class="line">--include test*</span><br><span class="line">--exclude test*</span><br></pre></td></tr></table></figure>
<h4 id="Re-executing-failed-test-suites"><a href="#Re-executing-failed-test-suites" class="headerlink" title="Re-executing failed test suites"></a>Re-executing failed test suites</h4><p>Grab failed test and run them again</p>
<ul>
<li><code>robot --rerunfailed output.xml tests</code></li>
<li><code>robot --rerunfailedsuites</code></li>
</ul>
<h4 id="When-no-tests-match-selection"><a href="#When-no-tests-match-selection" class="headerlink" title="When no tests match selection"></a>When no tests match selection</h4><p>Usually, we are given an error, but we can also run it by</p>
<ul>
<li>–RunEmptySuite</li>
<li>–ProcessEmptySuite</li>
</ul>
<h3 id="3-5-3-Setting-criticality"><a href="#3-5-3-Setting-criticality" class="headerlink" title="3.5.3   Setting criticality"></a>3.5.3   Setting criticality</h3><ul>
<li>All testcase are critical by default</li>
<li>Failed noncritical test case will not affect overall status<ul>
<li>–critical</li>
<li>–noncritical</li>
</ul>
</li>
</ul>
<h3 id="3-5-4-Setting-metadata"><a href="#3-5-4-Setting-metadata" class="headerlink" title="3.5.4   Setting metadata"></a>3.5.4   Setting metadata</h3><h3 id="3-5-5-Configuring-where-to-search-libraries-and-other-extensions"><a href="#3-5-5-Configuring-where-to-search-libraries-and-other-extensions" class="headerlink" title="3.5.5   Configuring where to search libraries and other extensions"></a>3.5.5   Configuring where to search libraries and other extensions</h3><ul>
<li>PYTHONPATH, JYTHONPATH and IRONPYTHONPATH</li>
<li>Using –pythonpath option</li>
<li>Configuring sys.path in program</li>
<li>Java classpath</li>
</ul>
<h3 id="3-5-6-Setting-variables"><a href="#3-5-6-Setting-variables" class="headerlink" title="3.5.6   Setting variables"></a>3.5.6   Setting variables</h3><h3 id="3-5-7-Dry-run"><a href="#3-5-7-Dry-run" class="headerlink" title="3.5.7   Dry run"></a>3.5.7   Dry run</h3><p><strong>For validating syntax</strong></p>
<h3 id="3-5-8-Randomizing-execution-order"><a href="#3-5-8-Randomizing-execution-order" class="headerlink" title="3.5.8   Randomizing execution order"></a>3.5.8   Randomizing execution order</h3><p><code>--randomize &lt;what&gt;[:&lt;seed&gt;]</code></p>
<h3 id="3-5-9-Programmatic-modification-of-test-data"><a href="#3-5-9-Programmatic-modification-of-test-data" class="headerlink" title="3.5.9   Programmatic modification of test data"></a>3.5.9   Programmatic modification of test data</h3><blockquote>
<p>If the provided built-in features to modify test data before execution are not enough, Robot Framework 2.9 and newer makes it possible to do custom modifications programmatically</p>
</blockquote>
<ul>
<li>A python class extends SuiteVisitor</li>
<li><code>--prerebotmodifier xxx.py:arg1:arg2</code></li>
</ul>
<h3 id="3-5-10-Controlling-console-output"><a href="#3-5-10-Controlling-console-output" class="headerlink" title="3.5.10   Controlling console output"></a>3.5.10   Controlling console output</h3><ul>
<li>Console output type</li>
<li>Console width</li>
<li>Console colors</li>
</ul>
<h3 id="3-5-11-Setting-listeners"><a href="#3-5-11-Setting-listeners" class="headerlink" title="3.5.11   Setting listeners"></a>3.5.11   Setting listeners</h3><p><strong>For monitoring the test execution</strong></p>
<ul>
<li>–listener xxx</li>
<li>Listener interface</li>
</ul>
<h2 id="3-6-Created-outputs"><a href="#3-6-Created-outputs" class="headerlink" title="3.6   Created outputs"></a>3.6   Created outputs</h2><h1 id="4-Extending-Robot-Framework"><a href="#4-Extending-Robot-Framework" class="headerlink" title="4    Extending Robot Framework"></a>4    Extending Robot Framework</h1><h2 id="4-1-Creating-test-libraries"><a href="#4-1-Creating-test-libraries" class="headerlink" title="4.1   Creating test libraries"></a>4.1   Creating test libraries</h2><h3 id="4-1-1-Introduction"><a href="#4-1-1-Introduction" class="headerlink" title="4.1.1   Introduction"></a>4.1.1   Introduction</h3><h3 id="4-1-2-Creating-test-library-class-or-module"><a href="#4-1-2-Creating-test-library-class-or-module" class="headerlink" title="4.1.2   Creating test library class or module"></a>4.1.2   Creating test library class or module</h3><h4 id="Test-library-names"><a href="#Test-library-names" class="headerlink" title="Test library names"></a>Test library names</h4><pre><code>When libraring a library, if classname == filename:
    Library    filename
else:
    Library    filename.classname
</code></pre><h4 id="Test-library-scope"><a href="#Test-library-scope" class="headerlink" title="Test library scope"></a>Test library scope</h4><ul>
<li>ROBOT_LIBRARY_SCOPE: TEST CASE; TEST SUITE; GLOBAL</li>
<li><code>ROBOT_LIBRARY_SCOPE = &#39;TEST SUITE&#39;</code></li>
<li>Global and Test are for sharing state between tests</li>
</ul>
<h4 id="Specifying-library-version"><a href="#Specifying-library-version" class="headerlink" title="Specifying library version"></a>Specifying library version</h4><ul>
<li><code>ROBOT_LIBRARY_VERSION = &#39;0.1&#39;</code></li>
<li>or <code>__version__ = 0.1</code></li>
<li>They will be written into the syslog</li>
</ul>
<h3 id="4-1-3-Creating-static-keywords"><a href="#4-1-3-Creating-static-keywords" class="headerlink" title="4.1.3   Creating static keywords"></a>4.1.3   Creating static keywords</h3><p><strong>Create keyword in python file !</strong></p>
<ul>
<li>ignore methods begin with _</li>
</ul>
<h4 id="Keyword-names"><a href="#Keyword-names" class="headerlink" title="Keyword names"></a>Keyword names</h4><ul>
<li>ignore space, underscore, case insensitive</li>
<li>custom keyword name by @keyword(‘Login As User’)</li>
</ul>
<h4 id="Keyword-tags"><a href="#Keyword-tags" class="headerlink" title="Keyword tags"></a>Keyword tags</h4><ul>
<li><code>@keyword(tags=[&#39;tag1&#39;, &#39;tag2&#39;])</code></li>
</ul>
<h4 id="Argument-types"><a href="#Argument-types" class="headerlink" title="Argument types"></a>Argument types</h4><ol>
<li>Manually: int(port)</li>
<li>Decorator<br> <code>@keyword(types={&#39;count&#39;: int, &#39;case_insensitive&#39;: bool})</code></li>
<li>Implicit argument type<br> <code>def example_keyword(count=-1, case_insensitive=True)</code></li>
</ol>
<p>If we specify as 2 and 3, argument type will be automatically converted.</p>
<h4 id="Embedding-arguments-into-keyword-names"><a href="#Embedding-arguments-into-keyword-names" class="headerlink" title="Embedding arguments into keyword names"></a>Embedding arguments into keyword names</h4><p><strong>Awesome!!</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@keyword(&apos;Add $&#123;quantity:\d+&#125; copies of $&#123;item&#125; to cart&apos;)</span><br><span class="line">def add_copies_to_cart(quantity, item):</span><br></pre></td></tr></table></figure>
<h3 id="4-1-4-Communicating-with-Robot-Framework"><a href="#4-1-4-Communicating-with-Robot-Framework" class="headerlink" title="4.1.4   Communicating with Robot Framework"></a>4.1.4   Communicating with Robot Framework</h3><h4 id="Reporting-keyword-status"><a href="#Reporting-keyword-status" class="headerlink" title="Reporting keyword status"></a>Reporting keyword status</h4><ul>
<li>Only AssertionError, Exception, RuntimeError shows exception messages</li>
<li>Self created Error should specify<ul>
<li><code>ROBOT_SUPPRESS_NAME = True</code></li>
</ul>
</li>
<li>Stopping/Continue test execution in exception class<ul>
<li><code>ROBOT_EXIT_ON_FAILURE = TRUE</code></li>
<li><code>ROBOT_CONTINUE_ON_FAILURE = TRUE</code></li>
</ul>
</li>
<li><p>Logging information into console</p>
<ol>
<li>ERROR and WARN will be written in console<br> <code>print(&#39;*WARN*&#39;, ...)</code></li>
<li>stderr will be written in console<ul>
<li><code>print(&#39;aaa&#39;, file=sys.stderr)</code></li>
<li><code>sys.__stdout__.write(&#39;Got arg %s\n&#39; % arg)</code></li>
</ul>
</li>
<li><p>use robot logging API</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from robot.api import logger</span><br><span class="line">logger.console(&apos;Got arg %s&apos; % arg)</span><br><span class="line">logger.info(&apos;Got arg %s&apos; % arg, also_console=True)</span><br></pre></td></tr></table></figure>
</li>
<li><p>use python logging API</p>
<ul>
<li><code>import logging</code></li>
<li><code>logging.info(&#39;&#39;)</code></li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="Communication-when-using-threads"><a href="#Communication-when-using-threads" class="headerlink" title="Communication when using threads"></a>Communication when using threads</h4><ul>
<li>Supposed only main thread talk with robotframework</li>
<li>BackgroundLogger helps with not-main thread</li>
</ul>
<h3 id="4-1-5-Distributing-test-libraries"><a href="#4-1-5-Distributing-test-libraries" class="headerlink" title="4.1.5   Distributing test libraries"></a>4.1.5   Distributing test libraries</h3><h3 id="4-1-6-Dynamic-library-API"><a href="#4-1-6-Dynamic-library-API" class="headerlink" title="4.1.6   Dynamic library API"></a>4.1.6   Dynamic library API</h3><pre><code>@keyword
get_keyword_names(self):
    return [name for name in dir(self) if hasattr(getattr(self, name), &apos;robot_name&apos;)]
run_keyword(self, name, args)
get_keyword_arguments 
get_keyword_documentation 
get_keyword_tags
get_keyword_types
</code></pre><h3 id="4-1-7-Hybrid-library-API"><a href="#4-1-7-Hybrid-library-API" class="headerlink" title="4.1.7   Hybrid library API"></a>4.1.7   Hybrid library API</h3><p>Getting keyword names<br>Running keywords<br>Getting keyword arguments and documentation</p>
<h3 id="4-1-8-Using-Robot-Framework’s-internal-modules"><a href="#4-1-8-Using-Robot-Framework’s-internal-modules" class="headerlink" title="4.1.8   Using Robot Framework’s internal modules"></a>4.1.8   Using Robot Framework’s internal modules</h3><p>Available APIs: <a href="https://robot-framework.readthedocs.io/en/v3.1.1/" target="_blank" rel="noopener">https://robot-framework.readthedocs.io/en/v3.1.1/</a><br>Using BuiltIn library</p>
<h3 id="4-1-9-Extending-existing-test-libraries"><a href="#4-1-9-Extending-existing-test-libraries" class="headerlink" title="4.1.9   Extending existing test libraries"></a>4.1.9   Extending existing test libraries</h3><ul>
<li>Modifying original source code: don’t do this</li>
<li>Using inheritance: cool</li>
<li>Using other libraries directly</li>
<li><p>Getting active library instance from Robot Framework</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from robot.libraries.BuiltIn import BuiltIn</span><br><span class="line"></span><br><span class="line">def title_should_start_with(expected):</span><br><span class="line">    seleniumlib = BuiltIn().get_library_instance(&apos;SeleniumLibrary&apos;)</span><br><span class="line">    title = seleniumlib.get_title()</span><br><span class="line">    if not title.startswith(expected):</span><br><span class="line">        raise AssertionError(&quot;Title &apos;%s&apos; did not start with &apos;%s&apos;&quot;</span><br><span class="line">                             % (title, expected))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>Libraries using dynamic or hybrid API</li>
</ul>
<h2 id="4-2-Remote-library"><a href="#4-2-Remote-library" class="headerlink" title="4.2.   Remote library"></a>4.2.   Remote library</h2><h3 id="4-2-1-Introduction"><a href="#4-2-1-Introduction" class="headerlink" title="4.2.1   Introduction"></a>4.2.1   Introduction</h3><p>Allows distributed testing: have test library on different machine</p>
<h3 id="4-2-2-Putting-Remote-library-to-use"><a href="#4-2-2-Putting-Remote-library-to-use" class="headerlink" title="4.2.2   Putting Remote library to use"></a>4.2.2   Putting Remote library to use</h3><ul>
<li>Importing Remote library<br>  <code>Library    Remote    http://10.0.0.2/example    1 minute    WITH NAME    Example3</code></li>
<li>Starting and stopping remote servers<ul>
<li>start: by Process or SSH library</li>
<li>stop: remote server should supply Stop Remote Server keyword<pre><code>* ctrl-c on server
* kill
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="4-2-3-Supported-argument-and-return-value-types"><a href="#4-2-3-Supported-argument-and-return-value-types" class="headerlink" title="4.2.3   Supported argument and return value types"></a>4.2.3   Supported argument and return value types</h3><p>XML-RPC protocol does not support all possible object types</p>
<h3 id="4-2-4-Remote-protocol"><a href="#4-2-4-Remote-protocol" class="headerlink" title="4.2.4   Remote protocol"></a>4.2.4   Remote protocol</h3><p>Executing remote keywords: it is just make a server</p>
<ol>
<li>Server side: <code>RobotRemoteServer(Library(), host=xx, port=xx)</code></li>
<li>Client side: <code>Library    Remote    http://10.0.0.2/example    1 minute    WITH NAME    Example3</code></li>
<li>So Robot framework is able to use it directly</li>
</ol>
<h3 id="4-3-1-Taking-listeners-into-use"><a href="#4-3-1-Taking-listeners-into-use" class="headerlink" title="4.3.1   Taking listeners into use"></a>4.3.1   Taking listeners into use</h3><p><code>robot --listener listener.py:arg1:arg2 tests.robot</code></p>
<h3 id="4-3-2-Listener-interface-versions"><a href="#4-3-2-Listener-interface-versions" class="headerlink" title="4.3.2   Listener interface versions"></a>4.3.2   Listener interface versions</h3><ul>
<li><code>ROBOT_LISTENER_API_VERSION = 2</code>: only gets information about the execution but cannot directly affect it</li>
<li><code>ROBOT_LISTENER_API_VERSION = 3</code>: gets data and is able to alter execution</li>
</ul>
<h3 id="4-3-3-Listener-interface-methods"><a href="#4-3-3-Listener-interface-methods" class="headerlink" title="4.3.3   Listener interface methods"></a>4.3.3   Listener interface methods</h3><ul>
<li>During the test execution different listener methods are called when test suites, test cases and keywords start and end</li>
<li>Listener version 2<ul>
<li>start_suite, end_suite, start_test, end_test, start_keyword, end_keyword, log_message, message, output_file, log_file, report_file, debug_file</li>
</ul>
</li>
<li>Listener version 3<ul>
<li>library_import, resource_import, variables_import, xunit_file, close</li>
</ul>
</li>
</ul>
<h3 id="4-3-4-Listeners-logging"><a href="#4-3-4-Listeners-logging" class="headerlink" title="4.3.4   Listeners logging"></a>4.3.4   Listeners logging</h3><h3 id="4-3-5-Listener-examples"><a href="#4-3-5-Listener-examples" class="headerlink" title="4.3.5   Listener examples"></a>4.3.5   Listener examples</h3><h3 id="4-3-6-Test-libraries-as-listeners"><a href="#4-3-6-Test-libraries-as-listeners" class="headerlink" title="4.3.6   Test libraries as listeners"></a>4.3.6   Test libraries as listeners</h3><p>It is like combine library with listener</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class PythonLibraryAsListenerItself(object):</span><br><span class="line">    ROBOT_LIBRARY_SCOPE = <span class="string">'TEST SUITE'</span></span><br><span class="line">    ROBOT_LISTENER_API_VERSION = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="function">def <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="function">        self.ROBOT_LIBRARY_LISTENER </span>= self</span><br><span class="line"></span><br><span class="line">    <span class="function">def <span class="title">_end_suite</span><span class="params">(self, name, attrs)</span>:</span></span><br><span class="line"><span class="function">        print 'Suite %<span class="title">s</span> <span class="params">(%s)</span> ending.' % <span class="params">(name, attrs[<span class="string">'id'</span>])</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    # actual library code here ...</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/13/Flask-1-Decorator/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/13/Flask-1-Decorator/" class="post-title-link" itemprop="url">Flask<1>--Decorator</1></a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-13 15:26:05 / Modified: 17:21:10" itemprop="dateCreated datePublished" datetime="2019-01-13T15:26:05-06:00">2019-01-13</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Since Flask uses route() decorator to bind a function to a URL (Routing), this blog gives naive decorators and its corresponding code without decorator.</p>
<h3 id="Level-1-no-parameters"><a href="#Level-1-no-parameters" class="headerlink" title="Level 1 (no parameters)"></a>Level 1 (no parameters)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"start"</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">"end"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"logging"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log = wrapper(log)</span><br><span class="line">log()</span><br></pre></td></tr></table></figure>
<p>Corresponding decorator    :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"start"</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">"end"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@wrapper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"logging"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>output:<br>start<br>logging<br>end  </p>
</blockquote>
<h3 id="Level-2-require-parameter-for-log"><a href="#Level-2-require-parameter-for-log" class="headerlink" title="Level 2 (require parameter for log)"></a>Level 2 (require parameter for log)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(file_name)</span>:</span></span><br><span class="line">        print(<span class="string">"start"</span>)</span><br><span class="line">        func(file_name)</span><br><span class="line">        print(<span class="string">"end"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    print(<span class="string">"logging "</span> + file_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log = wrapper(log)</span><br><span class="line">log(<span class="string">'file'</span>)</span><br></pre></td></tr></table></figure>
<p>Corresponding decorator    :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(file_name)</span>:</span></span><br><span class="line">        print(<span class="string">"start"</span>)</span><br><span class="line">        func(file_name)</span><br><span class="line">        print(<span class="string">"end"</span>)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">@wrapper</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    print(<span class="string">"logging "</span> + file_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">'file'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>output:<br>start<br>logging file<br>end  </p>
</blockquote>
<h3 id="Level-3-Require-parameter-for-decorator"><a href="#Level-3-Require-parameter-for-decorator" class="headerlink" title="Level 3 (Require parameter for decorator)"></a>Level 3 (Require parameter for decorator)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(path_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">            print(<span class="string">"start logging in "</span> + path_name)</span><br><span class="line">            func()</span><br><span class="line">            print(<span class="string">"end"</span>)</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"logging"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log = wrapper(<span class="string">'path'</span>)(log)</span><br><span class="line">log()</span><br></pre></td></tr></table></figure>
<p>Corresponding decorator:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(path_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">            print(<span class="string">"start logging in "</span> + path_name)</span><br><span class="line">            func()</span><br><span class="line">            print(<span class="string">"end"</span>)</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper("path")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"logging"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>output:<br>start logging in path<br>logging<br>end  </p>
</blockquote>
<h3 id="Level-4-Require-parameter-for-decorator-amp-log"><a href="#Level-4-Require-parameter-for-decorator-amp-log" class="headerlink" title="Level 4 (Require parameter for decorator&amp;log)"></a>Level 4 (Require parameter for decorator&amp;log)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(path_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(file_name)</span>:</span></span><br><span class="line">            print(<span class="string">"start logging in "</span> + path_name)</span><br><span class="line">            func(file_name)</span><br><span class="line">            print(<span class="string">"end"</span>)</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    print(<span class="string">"logging "</span> + file_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log = wrapper(<span class="string">'path'</span>)(log)</span><br><span class="line">log(<span class="string">'file'</span>)</span><br></pre></td></tr></table></figure>
<p>Corresponding decorator    :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(path_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(file_name)</span>:</span></span><br><span class="line">            print(<span class="string">"start logging in "</span> + path_name)</span><br><span class="line">            func(file_name)</span><br><span class="line">            print(<span class="string">"end"</span>)</span><br><span class="line">        <span class="keyword">return</span> inner</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper('path')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(file_name)</span>:</span></span><br><span class="line">    print(<span class="string">"logging "</span> + file_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log(<span class="string">'file'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>output:<br>start logging in path<br>logging file<br>end</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/31/Vagrantfile-4-Configure-GUI-in-VM-for-Mac/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/31/Vagrantfile-4-Configure-GUI-in-VM-for-Mac/" class="post-title-link" itemprop="url">Vagrantfile<4>--Configure GUI inside of VM for Mac</4></a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-31 16:57:34" itemprop="dateCreated datePublished" datetime="2018-12-31T16:57:34-06:00">2018-12-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-01 23:04:42" itemprop="dateModified" datetime="2019-01-01T23:04:42-06:00">2019-01-01</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>When using Vagrant for a project, we have two options.</p>
<ol>
<li>Using all development tools including IDE to <strong>edit code and compile in host, then run in VM</strong>.<ul>
<li><ul>
<li>better performance</li>
</ul>
</li>
<li><ul>
<li>synced_folder allows us to synchronize codes between VM and local.</li>
</ul>
</li>
<li><ul>
<li>hard to fix once mess up local development environment (like me !!!)</li>
</ul>
</li>
</ul>
</li>
<li>Having another set of development tools in VM, developer <strong>writes code, compile and deploy in VM</strong>.<ul>
<li><ul>
<li>consistency: ensure the same development environment </li>
</ul>
</li>
<li><ul>
<li>lantency: GUI and Compiling. In SED, if I wanna use developer machine (like a high performance desktop), I have to ssh into server then vagrant ssh into VMs. We are now suffering high GUI latency when using IntelliJ in this situation (5 seconds for searching panel to show up). It is 2 X Forwarding, boss said it is an existing official bug.</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>In this blog, I will introduce these two methods.</p>
<h2 id="IDE-in-host"><a href="#IDE-in-host" class="headerlink" title="IDE in host"></a>IDE in host</h2><p>This is achieved by a <a href="https://www.vagrantup.com/docs/synced-folders/" target="_blank" rel="noopener">synced folder</a> functionality of Vagrant. Introduced in <a href="https://yuhan19.github.io/2018/12/15/Vagrantfile-2-Vagrantfile/" target="_blank" rel="noopener">Vagrantfile<2>–Vagrantfile</2></a><br>It synchronizes folder between VM and host.</p>
<p>Demo:<br><img src="/2018/12/31/Vagrantfile-4-Configure-GUI-in-VM-for-Mac/synced_folder.gif" alt=""></p>
<h2 id="IDE-in-VM-Mac"><a href="#IDE-in-VM-Mac" class="headerlink" title="IDE in VM (Mac)"></a>IDE in VM (Mac)</h2><p>Relates keyword: DISPLAY, xhost, XForwarding, X Server,  X Client</p>
<p>It is a little bit more complicated.<br>Basically, when running intelliJ, we should have a GUI window pop up. What we have to do now is to forward this window from VM to our host. </p>
<h3 id="Some-notations"><a href="#Some-notations" class="headerlink" title="Some notations:"></a>Some notations:</h3><ul>
<li>DISPLAY: an environment variable that indicates where to show this window.<ul>
<li>Format: DISPLAY=IP:displaynumber.screennumber</li>
<li>e.g. DISPLAY=:0.0 show window in local</li>
</ul>
</li>
<li>xhost: a list that is allowed to make connections to the X server</li>
<li>X Forwarding: Using X forwarding in an SSH session on your personal computer allows you to securely run graphical applications </li>
<li>X Server: e.g. host. It supplies screen for VM</li>
<li>X Client: e.g. VM. It uses the screen supplied by host.</li>
</ul>
<h3 id="Steps-in-theory"><a href="#Steps-in-theory" class="headerlink" title="Steps in theory"></a>Steps in theory</h3><ol>
<li>Run a X Server in host (XQuartz for mac)</li>
<li>Use X forwarding when ssh into VM</li>
<li>Set proper DISPLAY in VM </li>
<li>Run idea in VM</li>
</ol>
<h3 id="In-Mac"><a href="#In-Mac" class="headerlink" title="In Mac"></a>In Mac</h3><ol>
<li>Install <code>XQuartz</code>, an Mac version of X Server.<code>brew cask install xquartz</code></li>
<li>Mac DISPLAY should already be set to DISPLAY=/private/tmp/com.apple.launchd.GxQDyjI1Mr/org.macosforge.xquartz:0</li>
<li><code>vagrant ssh vm -- -X</code>, -X relates to X forwarding.</li>
<li>Run idea in VM</li>
</ol>
<h3 id="Common-errors"><a href="#Common-errors" class="headerlink" title="Common errors"></a>Common errors</h3><ul>
<li><p>Without X Server set.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vagrant@ui:/synced_folder/idea-IC-183.4588.61/bin$ ./idea.sh</span><br><span class="line">Startup Error: Unable to detect graphics environment</span><br></pre></td></tr></table></figure>
</li>
<li><p>Set DISPLAY in VM wihout X Server set.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">vagrant@ui:/synced_folder/idea-IC-183.4588.61/bin$ ./idea.sh</span><br><span class="line"></span><br><span class="line">Start Failed: Failed to initialize graphics environment</span><br><span class="line"></span><br><span class="line">java.awt.AWTError: Can&apos;t connect to X11 window server using &apos;:0.0&apos; as the value of the DISPLAY variable.</span><br><span class="line"> at sun.awt.X11GraphicsEnvironment.initDisplay(Native Method)</span><br><span class="line"> at sun.awt.X11GraphicsEnvironment.access$200(X11GraphicsEnvironment.java:65)</span><br><span class="line"> at sun.awt.X11GraphicsEnvironment$1.run(X11GraphicsEnvironment.java:115)</span><br><span class="line"> at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line"> at sun.awt.X11GraphicsEnvironment.&lt;clinit&gt;(X11GraphicsEnvironment.java:74)</span><br><span class="line"> at java.lang.Class.forName0(Native Method)</span><br><span class="line"> at java.lang.Class.forName(Class.java:264)</span><br><span class="line"> at java.awt.GraphicsEnvironment.createGE(GraphicsEnvironment.java:103)</span><br><span class="line"> at java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment(GraphicsEnvironment.java:82)</span><br><span class="line"> at sun.awt.X11.XToolkit.&lt;clinit&gt;(XToolkit.java:128)</span><br><span class="line"> at java.lang.Class.forName0(Native Method)</span><br><span class="line"> at java.lang.Class.forName(Class.java:264)</span><br><span class="line"> at java.awt.Toolkit$2.run(Toolkit.java:860)</span><br><span class="line"> at java.awt.Toolkit$2.run(Toolkit.java:855)</span><br><span class="line"> at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line"> at java.awt.Toolkit.getDefaultToolkit(Toolkit.java:854)</span><br><span class="line"> at com.intellij.ui.AppUIUtil.updateFrameClass(AppUIUtil.java:161)</span><br><span class="line"> at com.intellij.idea.StartupUtil.prepareAndStart(StartupUtil.java:94)</span><br><span class="line"> at com.intellij.idea.MainImpl.start(MainImpl.java:20)</span><br><span class="line"> at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line"> at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line"> at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line"> at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line"> at com.intellij.ide.plugins.PluginManager.lambda$start$0(PluginManager.java:75)</span><br><span class="line"> at java.lang.Thread.run(Thread.java:745)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ul>
<li><a href="https://stackoverflow.com/questions/17625421/vagrant-for-a-java-project-should-you-compile-in-the-vm-or-on-the-host" target="_blank" rel="noopener">https://stackoverflow.com/questions/17625421/vagrant-for-a-java-project-should-you-compile-in-the-vm-or-on-the-host</a></li>
<li><a href="https://blog.csdn.net/jlds123/article/details/6834287" target="_blank" rel="noopener">https://blog.csdn.net/jlds123/article/details/6834287</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/15/Vagrantfile-2-Vagrantfile/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/15/Vagrantfile-2-Vagrantfile/" class="post-title-link" itemprop="url">Vagrantfile<2>--Vagrantfile</2></a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-15 12:32:43 / Modified: 21:18:51" itemprop="dateCreated datePublished" datetime="2018-12-15T12:32:43-06:00">2018-12-15</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Vagrantfile is a configuration file:</p>
<ul>
<li>It describe and how to configure and provision these VMs.</li>
<li>The syntax of Vagrantfiles is Ruby</li>
<li>Use version control to share environment with team members.</li>
</ul>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  config.vm.define <span class="symbol">:ui</span> <span class="keyword">do</span> <span class="params">|ui|</span></span><br><span class="line">    ui.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> <span class="params">|vb|</span></span><br><span class="line">      vb.memory = <span class="string">"1024"</span></span><br><span class="line">      vb.name = <span class="string">"ui"</span></span><br><span class="line">      vb.cpus = <span class="string">"4"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    ui.vm.box = <span class="string">"centos/7"</span></span><br><span class="line">    ui.vm.hostname = <span class="string">"ui"</span></span><br><span class="line">    ui.vm.network <span class="string">"private_network"</span>, <span class="symbol">ip:</span> <span class="string">"192.168.50.4"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line">  config.vm.define <span class="symbol">:server</span> <span class="keyword">do</span> <span class="params">|server|</span></span><br><span class="line">    server.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> <span class="params">|vb|</span></span><br><span class="line">      vb.memory = <span class="string">"1024"</span></span><br><span class="line">      vb.name = <span class="string">"ui"</span></span><br><span class="line">      vb.cpus = <span class="string">"4"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    server.vm.box = <span class="string">"centos/7"</span></span><br><span class="line">    server.vm.hostname = <span class="string">"server"</span></span><br><span class="line">    server.vm.network <span class="string">"private_network"</span>, <span class="symbol">ip:</span> <span class="string">"192.168.50.5"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="box"><a href="#box" class="headerlink" title="box"></a>box</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.vm.box = <span class="string">"centos/7"</span></span><br></pre></td></tr></table></figure>
<p>It defines what box(system) for this VM. Find a box here <a href="https://app.vagrantup.com/boxes/search" target="_blank" rel="noopener">public Vagrant box catalog</a></p>
<h2 id="provider"><a href="#provider" class="headerlink" title="provider"></a>provider</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ui.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> <span class="params">|vb|</span></span><br><span class="line">  vb.memory = <span class="string">"1024"</span></span><br><span class="line">  vb.name = <span class="string">"ui"</span></span><br><span class="line">  vb.cpus = <span class="string">"4"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Used to modify settings which are specific to a certain provider</p>
<h2 id="hostname"><a href="#hostname" class="headerlink" title="hostname"></a>hostname</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.vm.hostname = <span class="string">"server"</span></span><br></pre></td></tr></table></figure>
<p>Set hostname of this VM</p>
<h2 id="network"><a href="#network" class="headerlink" title="network"></a>network</h2><p>How VM connect to the network. This one use private_network with a static IP. Options:</p>
<ol>
<li><p>private_network</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.vm.network <span class="string">"private_network"</span>, <span class="symbol">ip:</span> <span class="string">"192.168.50.5"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>public_network</p>
</li>
<li><p>forwarded_port</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">80</span>, <span class="symbol">host:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>We can then open browser to localhost:8080 and browse the website, while all actual network data is being sent to the guest.</p>
<h2 id="provision"><a href="#provision" class="headerlink" title="provision"></a>provision</h2><ul>
<li>Install and configure software automatically</li>
<li>It happens when <code>vagrant up</code> <code>vagrant provision</code> <code>vagrant reload --provision</code></li>
</ul>
<ol>
<li><p>file</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.provision <span class="string">"file"</span>, <span class="symbol">source:</span> <span class="string">"~/.gitconfig"</span>, <span class="symbol">destination:</span> <span class="string">".gitconfig"</span></span><br></pre></td></tr></table></figure>
<p> It upload this file/directory to new VM. So I don’t need to <code>git config --global</code> every time!!</p>
</li>
<li><p>shell</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.provision <span class="string">"shell"</span>, <span class="symbol">inline:</span> <span class="string">"echo Hello, World"</span></span><br></pre></td></tr></table></figure>
<p> Run inline script</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.provision <span class="string">"shell"</span>, <span class="symbol">path:</span> <span class="string">"script.sh"</span></span><br></pre></td></tr></table></figure>
<p> Run external script</p>
</li>
</ol>
<h2 id="synced-folder"><a href="#synced-folder" class="headerlink" title="synced_folder"></a>synced_folder</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.synced_folder <span class="string">"src/"</span>, <span class="string">"/srv/website"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Didn’t use it in example because VirtualBox has its own share folder setting. This folders on your host machine can be synced to and from the guest machine</li>
<li>So useful!!!!!! Some personal setting can be sent to all VM. So I don’t need to worry about changing an alias at one VM, then have to edit all others</li>
</ul>
<h2 id="others"><a href="#others" class="headerlink" title="others"></a>others</h2><ul>
<li><p>push</p>
<ul>
<li>As of version 1.7, Vagrant is capable of deploying or “pushing” application code in the same directory as your Vagrantfile to a remote such as an FTP server.</li>
</ul>
</li>
<li><p>plugin</p>
<ul>
<li>we only have one called <code>vagrant-libvirt</code></li>
</ul>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/13/Vagrantfile-1-Introduction-Commands/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/12/13/Vagrantfile-1-Introduction-Commands/" class="post-title-link" itemprop="url">Vagrantfile<1>--Introduction&Commands</1></a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-12-13 22:12:16" itemprop="dateCreated datePublished" datetime="2018-12-13T22:12:16-06:00">2018-12-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-12-15 12:30:27" itemprop="dateModified" datetime="2018-12-15T12:30:27-06:00">2018-12-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Vagrant is a tool for building and managing virtual machine environments.</p>
<p>Why do I use it?<br><br>To keep my local machine clean!!!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(▰˘◡˘▰)&gt; </p>
<p><a href="https://www.vagrantup.com/" target="_blank" rel="noopener">Home Page</a></p>
<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><ol>
<li><p>Install Homebrew</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://	raw.githubusercontent.com/Homebrew/install/master/	install)&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install Virtualbox</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install virtualbox</span><br></pre></td></tr></table></figure>
</li>
<li><p>Install Vagrant</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install vagrant</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><h2 id="Basic-Commands"><a href="#Basic-Commands" class="headerlink" title="Basic Commands"></a>Basic Commands</h2><table>
<thead>
<tr>
<th>Command</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>vagrant</td>
<td>display all available subcommands</td>
</tr>
<tr>
<td>vagrant {subcommand} -h</td>
<td>display usage for subcommands</td>
</tr>
<tr>
<td>vagrant box add</td>
<td>add vagrant box</td>
</tr>
<tr>
<td>vagrant destroy</td>
<td>destroys all resources that were created (doesn’t remove box installed during vagrant up)</td>
</tr>
<tr>
<td>vagrant halt</td>
<td>shuts down the running machine Vagrant is managing</td>
</tr>
<tr>
<td>vagrant init</td>
<td>init current directory by creating Vagrantfile</td>
</tr>
<tr>
<td>vagrant ssh</td>
<td>ssh into vm</td>
</tr>
<tr>
<td>vagrant status</td>
<td>display state of vms in this directory</td>
</tr>
<tr>
<td>vagrant up</td>
<td>creates and configures guest machines according to your Vagrantfile</td>
</tr>
</tbody>
</table>
<h2 id="Common-Commands"><a href="#Common-Commands" class="headerlink" title="Common Commands"></a>Common Commands</h2><table>
<thead>
<tr>
<th>Command</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>vagrant box list</td>
<td>list all boxes</td>
</tr>
<tr>
<td>vagrant box remove</td>
<td>remove a box</td>
</tr>
<tr>
<td>vagrant global-status</td>
<td>show state of created machines for current user (vagrant status is only for current）</td>
</tr>
<tr>
<td>vagrant provision</td>
<td>runs any configured provisioners against the running VM</td>
</tr>
<tr>
<td>vagrant reload</td>
<td>vagrant halt; vagrant up. It can apply changes of Vagrantfile</td>
</tr>
<tr>
<td>vagrant resume</td>
<td>resume machine that is vagrant suspend</td>
</tr>
<tr>
<td>vagrant snapshot</td>
<td>similar as git stash, pop. Useful to try things and restore state</td>
</tr>
<tr>
<td>vagrant suspend</td>
<td>suspend a VM instead of halt it. It no longer consume RAM.</td>
</tr>
<tr>
<td>vagrant validate</td>
<td>validate Vagrantfile</td>
</tr>
</tbody>
</table>
<h2 id="Cloud-amp-Share-Commands"><a href="#Cloud-amp-Share-Commands" class="headerlink" title="Cloud&amp;Share Commands"></a>Cloud&amp;Share Commands</h2><table>
<thead>
<tr>
<th>Command</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>vagrant cloud</td>
<td>manage things related to Vagrant Cloud</td>
</tr>
<tr>
<td>vagrant connect</td>
<td>enabling access to shared environments by vagrant share</td>
</tr>
<tr>
<td>vagrant login</td>
<td>authenticate with protected boxes in HashiCorp’s Vagrant Cloud or using vagrant share</td>
</tr>
<tr>
<td>vagrant share</td>
<td>share vagrant environment with anyone else in world</td>
</tr>
</tbody>
</table>
<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><table>
<thead>
<tr>
<th>Command</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>vagrant package</td>
<td>package into a re-usable box</td>
</tr>
<tr>
<td>vagrant plugin</td>
<td>manage plugins (we have a vagrant-libvirt plugin)</td>
</tr>
<tr>
<td>vagrant port</td>
<td>displays the full list of guest ports mapped to the host machine ports</td>
</tr>
<tr>
<td>vagrant powershell</td>
<td>this is only available for windows</td>
</tr>
<tr>
<td>vagrant rdp</td>
<td>this is only available for windows</td>
</tr>
<tr>
<td>vagrant ssh-config</td>
<td>This will output valid configuration for an SSH config file</td>
</tr>
<tr>
<td>vagrant version</td>
<td>display version info</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/19/Learning-Note-iOS/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="呆阿呆阿呆">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="呆呆窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/11/19/Learning-Note-iOS/" class="post-title-link" itemprop="url">Learning Note iOS</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-11-19 23:20:00 / Modified: 23:47:20" itemprop="dateCreated datePublished" datetime="2018-11-19T23:20:00-06:00">2018-11-19</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Cocoapods-setup"><a href="#Cocoapods-setup" class="headerlink" title="Cocoapods setup"></a>Cocoapods setup</h1><ol>
<li><p>Install</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install cocoapods</span><br></pre></td></tr></table></figure>
</li>
<li><p>Setup</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod setup --verbose</span><br></pre></td></tr></table></figure>
</li>
<li><p>Init</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd $PROJECT</span><br><span class="line">$ pod init</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>$ vi Podfile</code></p>
<ul>
<li>uncomment lines as instruction</li>
<li>add pod<br><img src="/2018/11/19/Learning-Note-iOS/podfile.png" alt=""></li>
</ul>
</li>
<li><p>Install</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod install</span><br></pre></td></tr></table></figure>
</li>
<li><p>Open with Xcode</p>
<p> open $PROJECT.xcworkspace instead of $PROJECT.xcodeproj</p>
</li>
</ol>
<p>Now, we are able to <code>import SwiftyJSON</code> in swift files</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="呆阿呆阿呆">
            
              <p class="site-author-name" itemprop="name">呆阿呆阿呆</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">呆阿呆阿呆</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
